---
title: "cq-directory-rebuilder.ts"
---

## High-level description
This code defines a function `createCqDirectoryRebuilder` that creates a scheduled Lambda function for rebuilding the Carequality directory. It sets up the Lambda with specific configurations, including memory, timeout, and schedule expressions, and integrates it with other AWS services like VPC and CloudWatch alarms.

## Code Structure
The main function `createCqDirectoryRebuilder` uses helper functions and types from imported modules to create and configure the Lambda function. It relies on configuration settings from `getConfig()` and uses the `createScheduledLambda` function to set up the scheduled execution.

## Symbols

### `createCqDirectoryRebuilder`
#### Description
This function creates a scheduled Lambda function for rebuilding the Carequality directory.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | CqDirectoryRebuilderProps | Configuration properties for the Lambda function |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| lambda | Lambda \| undefined | The created Lambda function, or undefined if not configured |

#### Internal Logic
1. Retrieves configuration using `getConfig()`
2. If `cqDirectoryRebuilder` is not configured, returns undefined
3. Calls `getSettings` to prepare Lambda settings
4. Uses `createScheduledLambda` to create the Lambda function with the prepared settings

### `getSettings`
#### Description
A helper function that prepares the settings for the Lambda function based on the provided props and configuration.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| props | CqDirectoryRebuilderProps | Input properties for the Lambda |
| config | NonNullable&lt;EnvConfig["cqDirectoryRebuilder"]&gt; | Configuration for the Carequality directory rebuilder |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| settings | Object | Prepared settings for the Lambda function |

#### Internal Logic
Combines the input props with specific settings for the Lambda, including name, memory, timeout, schedule expressions, and URL.

## Dependencies
- aws-cdk-lib
- ../../config/env-config
- ../shared/config
- ../shared/lambda-layers
- ../shared/lambda-scheduled

## Configuration
The Lambda function's behavior can be configured through the `EnvConfig` object, specifically the `cqDirectoryRebuilder` property. This includes schedule expressions for when the Lambda should run.

## Error Handling
The code doesn't implement specific error handling mechanisms beyond basic checks (e.g., returning undefined if `cqDirectoryRebuilder` is not configured).

## Logging
No explicit logging is implemented in this code. Logging would typically be handled within the Lambda function itself.

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.