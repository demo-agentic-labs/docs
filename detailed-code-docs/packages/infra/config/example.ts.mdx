---
title: "example.ts"
---

## High-level description
This code defines a configuration object for a production environment of a health application infrastructure. It specifies various settings for AWS services, API endpoints, databases, and third-party integrations, providing a comprehensive setup for deploying and managing the application's infrastructure.

## Code Structure
The main symbol in this code is the `config` object, which is an instance of `EnvConfigNonSandbox`. This object contains multiple nested configurations for different aspects of the infrastructure, including database settings, authentication, API endpoints, and various service integrations.

## References
This code references the following external symbols:
- `Duration` from "aws-cdk-lib"
- `EbsDeviceVolumeType` from "aws-cdk-lib/aws-ec2"
- `EnvType` from "../lib/env-type"
- `EnvConfigNonSandbox` from "./env-config"

## Symbols

### `config`
#### Description
The `config` object is an instance of `EnvConfigNonSandbox` that contains all the configuration settings for the production environment of the health application infrastructure.

#### Internal Logic
The `config` object is structured with the following main sections:
1. General stack and environment settings
2. API and database configurations
3. Authentication and security settings
4. Third-party service integrations (PropelAuth, Carequality, CommonWell)
5. AWS service configurations (OpenSearch, S3 buckets)
6. Provider-specific secret names

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| aws-cdk-lib | Provides AWS CDK constructs and utilities |
| aws-cdk-lib/aws-ec2 | Provides EC2-specific constructs |

## Configuration
The `config` object contains numerous configuration options. Here are some key ones:

| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| stackName | string | "MetriportInfraStack" | Name of the main infrastructure stack |
| environmentType | EnvType | EnvType.production | Specifies the environment type |
| region | string | "us-east-1" | AWS region for deployment |
| host | string | "myhealthapp.com" | Main host domain |
| apiDatabase | object | \{...\} | Database configuration including name, username, and performance settings |
| propelAuth | object | \{...\} | PropelAuth configuration for authentication |
| openSearch | object | \{...\} | OpenSearch configuration for search functionality |

## Side Effects
This configuration file doesn't have direct side effects, but it defines settings that will affect the behavior and deployment of the entire infrastructure when used.

## Performance Considerations
The configuration includes several performance-related settings, particularly for the API database:
- `minCapacity` and `maxCapacity` for database scaling
- `poolSettings` for connection pool management
- `alarmThresholds` for monitoring and alerting on database performance

Additionally, the OpenSearch configuration specifies capacity and instance types, which will affect search performance.

## Error Handling
This configuration file doesn't implement error handling directly, but it defines several secret names and API keys that should be handled securely in the actual implementation.

## API/Interface Reference
While this file doesn't define an API directly, it configures several endpoints and subdomains that will be part of the application's API:

| Endpoint | Description |
|:---------|:------------|
| api.myhealthapp.com | Main API endpoint |
| auth.myhealthapp.com | Authentication endpoint |
| connect.myhealthapp.com | Connect widget endpoint |

## TODOs
There is one TODO comment in the code:
- TODO move this under `commonwell` (referring to the `cwSecretNames` configuration)

This suggests that there's a planned refactoring to move the CommonWell secret names under the `commonwell` configuration object.
