---
title: "ihe-gateway-v2-outbound-document-retrieval.ts"
---

## High-level description
This code defines an AWS Lambda function handler for outbound document retrieval in an IHE Gateway V2 system. It processes document retrieval requests, signs them, sends them, and handles the responses for a specific patient and customer.

## Code Structure
The main handler function is wrapped with Sentry for error tracking. It uses various imported functions and utilities to process document retrieval requests, including SAML certificate handling and environment variable management.

## References
- `@metriport/core/external/carequality/ihe-gateway-v2/outbound/ihe-gateway-v2`
- `@metriport/core/external/carequality/ihe-gateway-v2/outbound/ihe-gateway-v2-logic`
- `@metriport/core/util/env-var`
- `@metriport/core/util/log`
- `./shared/secrets`
- `./shared/capture`

## Symbols

### `handler`
#### Description
This is the main Lambda function handler, wrapped with Sentry for error tracking. It processes document retrieval requests for a specific patient and customer.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patientId | string | The ID of the patient |
| cxId | string | The customer ID |
| requestId | string | The ID of the request |
| drRequestsGatewayV2 | array | An array of document retrieval requests |

#### Internal Logic
1. Logs the environment type, request ID, number of gateways, customer ID, and patient ID.
2. Retrieves SAML certificates and keys.
3. Calls `createSignSendProcessDrRequests` with the necessary parameters to process the document retrieval requests.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @sentry/serverless | For error tracking and monitoring |
| @metriport/core | For various utility functions and types |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| API_URL | string | N/A | The API URL for document retrieval responses |

## Error Handling
The function is wrapped with Sentry's AWSLambda handler, which captures and reports any unhandled exceptions.

## Logging
The code uses a custom logging utility (`out`) to log information about the Lambda execution.

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.