---
title: "ihe-gateway-v2-outbound-patient-discovery.ts"
---

## High-level description
This code defines a Lambda function handler for outbound patient discovery in the IHE Gateway V2 system. It processes patient discovery requests, signs and sends XCPD (Cross-Community Patient Discovery) requests, and handles the responses.

## Code Structure
The main handler function is wrapped with Sentry for error tracking. It uses various imported functions and utilities to process the patient discovery request, retrieve SAML certificates and keys, and create and send the XCPD request.

## Symbols

### `handler`
#### Description
This is the main Lambda function handler, wrapped with Sentry for error tracking. It processes patient discovery requests for the IHE Gateway V2 system.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cxId | string | Customer ID |
| patientId | string | Patient ID |
| pdRequestGatewayV2 | object | Patient Discovery request object for Gateway V2 |

#### Internal Logic
1. Logs the environment type, request ID, number of gateways, customer ID, and patient ID.
2. Retrieves SAML certificates and keys.
3. Creates, signs, and sends the XCPD request using the `createSignSendProcessXCPDRequest` function.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @sentry/serverless | Error tracking and monitoring |
| @metriport/core | Core functionality and utilities |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| API_URL | string | N/A | API URL for patient discovery response |

## Error Handling
The function uses Sentry for error tracking and monitoring. Errors are captured and sent to Sentry for analysis.

## Logging
The code uses a custom logging utility (`out`) to log information about the request being processed.

## API/Interface Reference
This Lambda function is triggered by an event containing customer ID, patient ID, and patient discovery request details for Gateway V2.

## TODOs
None present in the provided code.