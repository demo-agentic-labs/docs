---
title: "index.js"
---

## High-level description
This code implements a `pump` function that pipes multiple streams together and handles error propagation and cleanup. It's designed to work with various types of streams, including file streams and HTTP request streams, and ensures proper closing of streams when errors occur or the pipeline completes.

## Code Structure
The main function `pump` uses helper functions like `destroyer`, `isFS`, and `isRequest` to handle different stream types. The code also includes utility functions such as `once`, `eos`, and `isFn` for various checks and operations.

## References
This code references the following external modules:
- `once`: Used for ensuring a function is only called once.
- `end-of-stream`: Used to detect when a stream has ended or closed.
- `fs`: Used to check if a stream is a file stream.

## Symbols

### `pump`
#### Description
The main function that pipes multiple streams together and handles error propagation and cleanup.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ...streams | Stream | Variable number of streams to be piped together |
| callback | Function | Optional callback function to be called when pumping is complete or an error occurs |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Stream | The last stream in the pipeline |

#### Internal Logic
1. Processes input arguments to extract streams and callback.
2. Validates that there are at least two streams.
3. Creates destroyer functions for each stream.
4. Pipes the streams together using `reduce`.
5. Handles errors and cleanup using the destroyer functions.

### `destroyer`
#### Description
Creates a function that safely destroys a stream, handling different stream types.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| stream | Stream | The stream to be destroyed |
| reading | Boolean | Indicates if the stream is being read from |
| writing | Boolean | Indicates if the stream is being written to |
| callback | Function | Callback to be called when the stream is destroyed or an error occurs |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| destroyFunction | Function | A function that, when called, destroys the stream |

#### Internal Logic
1. Sets up error handling and stream end detection using `eos`.
2. Returns a function that destroys the stream based on its type (FS, Request, or generic).

### `isFS`
#### Description
Checks if a stream is a file system stream (ReadStream or WriteStream).

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| stream | Stream | The stream to check |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Boolean | True if the stream is a file system stream, false otherwise |

### `isRequest`
#### Description
Checks if a stream is an HTTP request stream.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| stream | Stream | The stream to check |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Boolean | True if the stream is an HTTP request stream, false otherwise |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| once | Ensures a function is only called once |
| end-of-stream | Detects when a stream has ended or closed |
| fs | Used to check if a stream is a file stream |

## Error Handling
The code implements robust error handling:
- It uses the `eos` function to detect stream errors and end events.
- The `destroyer` function is used to safely close streams in case of errors.
- Errors are propagated through the pipeline and passed to the callback function.

## Performance Considerations
- The code uses `once` to ensure callbacks are only called once, preventing potential memory leaks.
- It handles different stream types efficiently, using appropriate methods for closing each type.
- The `pump` function uses `reduce` to pipe streams together, which is an efficient way to handle multiple streams.