---
title: "_stream_writable.js"
---

## High-level description
This file implements the Writable stream class, which is part of Node.js's stream module. It provides functionality for writing data to a destination, handling buffering, backpressure, and various stream states.

## Code Structure
The main symbols in this code are the `Writable` class and its prototype methods, along with helper functions and the `WritableState` class. The `Writable` class inherits from `Stream` and uses `WritableState` to manage its internal state.

## Symbols

### `Writable`
#### Description
The `Writable` class is a constructor for writable stream instances. It initializes the stream's state and sets up various properties and methods.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| options | Object | Configuration options for the writable stream |

#### Internal Logic
- Initializes a new `WritableState` instance
- Sets up default properties and methods
- Handles options for custom `write`, `writev`, `destroy`, and `final` methods

### `Writable.prototype.write`
#### Description
Writes data to the stream, buffering it if necessary.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| chunk | string/Buffer/Uint8Array | The data to write |
| encoding | string | The encoding of the chunk (if string) |
| cb | function | Callback function |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return | boolean | Indicates if more data can be written immediately |

#### Internal Logic
- Validates the chunk
- Handles buffering if the stream is currently writing
- Calls `writeOrBuffer` to process the write operation

### `writeOrBuffer`
#### Description
Internal function to either write data immediately or buffer it for later.

#### Internal Logic
- Decodes the chunk if necessary
- Updates the stream's length
- Either buffers the write request or calls `doWrite` to perform the write

### `doWrite`
#### Description
Performs the actual write operation by calling the stream's `_write` or `_writev` method.

#### Internal Logic
- Sets up the write state
- Calls the appropriate write method (`_write` or `_writev`)
- Handles synchronous and asynchronous write completions

### `finishMaybe`
#### Description
Checks if the stream is finished and emits the 'finish' event if necessary.

#### Internal Logic
- Checks if all data has been written and the stream is ending
- Calls `prefinish` if needed
- Emits the 'finish' event and potentially destroys the stream

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| util-deprecate | For deprecation warnings |
| buffer | For Buffer operations |
| inherits | For inheritance |
| ./internal/streams/stream | Base Stream class |
| ./internal/streams/destroy | Stream destruction utilities |
| ./internal/streams/state | Stream state utilities |
| ../errors | Error codes and classes |

## Error Handling
The code implements various error checks and uses the `errorOrDestroy` function to handle errors, which either emits an error event or destroys the stream.

## Performance Considerations
The implementation includes optimizations for buffering writes, handling high water marks, and efficient memory usage through the use of linked lists for buffered requests.

This documentation provides an overview of the key components and functionality of the Writable stream implementation. The code includes many more methods and intricacies that handle various edge cases and stream states.