---
title: "Overview"
---

## High-level description
The `chownr` package is a Node.js module that implements functionality similar to the Unix command `chown -R`, which recursively changes the owner of files and directories. It provides both synchronous and asynchronous versions of the operation, handling various edge cases and ensuring compatibility across different Node.js versions.

## What does it do?
The `chownr` package allows developers to change the ownership of a directory and all its contents recursively. This is useful in scenarios where you need to modify file permissions or ownership in bulk, such as when setting up a file system for a specific user or application. The package provides two main functions:

1. `chownr`: An asynchronous function that recursively changes ownership of a directory and its contents.
2. `chownrSync`: A synchronous version of the same functionality.

These functions traverse through the directory structure, changing the ownership of each file and subdirectory to the specified user ID (uid) and group ID (gid). The package handles various error cases, such as non-existent files or directories, and provides compatibility with different Node.js versions.

## Key Files

1. `chownr.js`: This is the main file containing the implementation of the `chownr` and `chownrSync` functions, along with several utility functions for handling file system operations and error cases.

2. `package.json`: This file contains the metadata and configuration for the npm package, including version information, dependencies, and scripts for testing and publishing.

## Dependencies
The `chownr` package primarily relies on Node.js built-in modules:

- `fs`: Used for file system operations
- `path`: Used for handling file paths

For development and testing, the package uses the following dependencies:

- `mkdirp` (version 0.3): Used for creating directories during testing
- `rimraf` (version ^2.7.1): Used for recursive directory removal during testing
- `tap` (version ^14.10.6): Used as the test framework

## Configuration
The package doesn't require any specific configuration to use. However, the `package.json` file includes some configuration for development and testing:

- `tap.check-coverage`: Set to `true`, enabling coverage checking for the tap test framework
- Various npm scripts for testing, versioning, and publishing the package

## Code Structure and Functionality

The main functionality is implemented in `chownr.js`, which includes several key functions:

1. Utility functions:
   - `lchownSync` and `chownSync`: Wrapper functions for `fs.lchownSync` and `fs.chownSync` that ignore ENOENT errors
   - `handleEISDIR` and `handleEISDirSync`: Functions to handle EISDIR errors for Node.js versions prior to v10
   - `chown`: A wrapper function for `fs[LCHOWN]` that handles EISDIR errors and ignores ENOENT errors

2. Main functions:
   - `chownr`: The asynchronous function for recursive ownership change
   - `chownrSync`: The synchronous version of the recursive ownership change

3. Helper functions:
   - `chownrKid` and `chownrKidSync`: Functions to recursively change ownership of child items (files or directories)

The code implements specific error handling for various cases:
- ENOENT (file or directory not found): generally ignored
- EISDIR (is a directory): handled differently for older Node.js versions
- ENOTDIR (not a directory) and ENOTSUP (operation not supported): handled in main functions

Here's an example of how the `chownr` function works:

```javascript
chownr(p, uid, gid, cb) {
  fs[READDIR](p, (er, children) =&gt; {
    // Error handling...
    
    let len = children.length
    if (len === 0)
      return chown(p, uid, gid, cb)

    let errState = null
    const done = (er) =&gt; {
      // Error handling and completion logic...
    }

    children.forEach(child =&gt; {
      chownrKid(p, child, uid, gid, done)
    })
  })
}
```

This function reads the contents of a directory, processes each child item recursively, and then changes the ownership of the directory itself.

The package uses asynchronous operations where possible to avoid blocking the event loop, but also provides synchronous versions of the functions for cases where blocking is acceptable or necessary.

In summary, the `chownr` package provides a robust and flexible solution for recursively changing file and directory ownership in Node.js applications, with careful attention to error handling and cross-version compatibility.