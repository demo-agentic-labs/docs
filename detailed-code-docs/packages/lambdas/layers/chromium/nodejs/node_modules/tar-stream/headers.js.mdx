---
title: "headers.js"
---

## High-level description
This code is part of a tar-stream library and provides functionality for encoding and decoding tar file headers. It includes utility functions for handling various aspects of tar headers, such as parsing octal values, encoding/decoding strings, and managing file types and attributes.

## Code Structure
The code defines several constants, utility functions, and main export functions for encoding and decoding tar headers. The functions work together to handle different aspects of tar header manipulation, including checksum calculation, type conversion, and data parsing.

## Symbols

### `clamp`
#### Description
A utility function that clamps an index value within a specified range.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| index | number | The index to clamp |
| len | number | The maximum length |
| defaultValue | any | The default value to return if index is not a number |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | number | The clamped index value |

### `toType`
#### Description
Converts a numeric flag to a corresponding file type string.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| flag | number | The numeric flag representing a file type |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | string | The corresponding file type string, or null if not recognized |

### `toTypeflag`
#### Description
Converts a file type string to its corresponding numeric flag.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| flag | string | The file type string |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | number | The corresponding numeric flag, or 0 if not recognized |

### `cksum`
#### Description
Calculates the checksum of a tar header block.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| block | Buffer | The tar header block |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sum | number | The calculated checksum |

### `encodeOct`
#### Description
Encodes a number as an octal string with padding.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| val | number | The value to encode |
| n | number | The desired length of the output string |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | string | The encoded octal string |

### `parse256`
#### Description
Parses a base-256 encoded number from a buffer.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| buf | Buffer | The buffer containing the encoded number |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | number | The parsed number, or null if invalid |

### `decodeOct`
#### Description
Decodes an octal or base-256 encoded number from a buffer.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| val | Buffer | The buffer containing the encoded number |
| offset | number | The starting offset in the buffer |
| length | number | The length of the encoded number |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | number | The decoded number |

### `exports.encode`
#### Description
Encodes tar header information into a buffer.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| opts | Object | An object containing tar header options |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Buffer | The encoded tar header, or null if encoding fails |

### `exports.decode`
#### Description
Decodes a tar header buffer into an object with header information.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| buf | Buffer | The tar header buffer to decode |
| filenameEncoding | string | The encoding used for filenames |
| allowUnknownFormat | boolean | Whether to allow unknown tar formats |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Object | An object containing the decoded tar header information, or null if the header is invalid |

## Dependencies
This code relies on the Node.js `Buffer` class for working with binary data.

## Error Handling
The code includes basic error handling, such as throwing an error for invalid tar headers or unknown formats. It also returns null in some cases where encoding or decoding fails.

## Performance Considerations
The code uses bitwise operations and efficient buffer manipulations to optimize performance when working with tar headers.