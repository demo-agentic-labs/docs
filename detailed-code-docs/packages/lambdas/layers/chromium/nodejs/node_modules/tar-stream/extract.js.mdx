---
title: "extract.js"
---

## High-level description
This code defines an `Extract` class that implements a streaming TAR file extractor. It's designed to parse TAR archives, extract file entries, and emit events for each entry found in the archive.

## Code Structure
The main `Extract` class extends the `Writable` stream, with several helper functions and internal methods to handle the parsing and extraction process. It uses a `Source` class (which extends `PassThrough`) to represent individual file streams within the archive.

## Symbols

### `Extract`
#### Description
The main class responsible for extracting TAR archives. It inherits from `Writable` stream and implements the core logic for parsing TAR headers and file contents.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| opts | Object | Optional configuration options |

#### Internal Logic
1. Initializes internal state variables
2. Sets up event handlers for different parsing stages (headers, PAX headers, GNU long paths)
3. Implements the main parsing loop in the `_write` method
4. Emits 'entry' events for each file or directory found in the archive

### `Source`
#### Description
A helper class representing individual file streams within the TAR archive. It extends the `PassThrough` stream.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| self | Extract | Reference to the parent Extract instance |
| offset | Number | Offset of the file within the archive |

### `mixinPax`
#### Description
A helper function to merge PAX extended header information into the standard header object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| header | Object | The standard header object |
| pax | Object | The PAX extended header information |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| header | Object | The merged header object |

### `emptyStream`
#### Description
Creates an empty stream for directory entries or zero-sized files.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| self | Extract | Reference to the Extract instance |
| offset | Number | Offset within the archive |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| s | Source | An ended Source stream |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| util | For inheriting from stream classes |
| bl | Buffer list implementation for handling partial data |
| ./headers | For decoding TAR headers and PAX headers |
| readable-stream | For Writable and PassThrough stream implementations |

## Error Handling
The code implements basic error handling by emitting 'error' events and destroying the stream when errors occur. It also checks for unexpected end of data in the `_final` method.

## API/Interface Reference
| Event | Payload | Description |
|:------|:--------|:------------|
| 'entry' | (header, stream, callback) | Emitted for each file or directory entry in the archive |
| 'error' | (error) | Emitted when an error occurs during extraction |
| 'close' | None | Emitted when the extractor is destroyed |

The `Extract` class is the main interface, which can be used as a writable stream to process TAR archive data.