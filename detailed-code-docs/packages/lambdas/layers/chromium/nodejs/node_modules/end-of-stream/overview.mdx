---
title: "Overview"
---

## High-level description
The `end-of-stream` directory contains a Node.js package that provides functionality to detect when a stream has ended, finished, or encountered an error. This package is particularly useful for handling the completion or failure of various types of streams, including writable, readable, and child process streams.

## What does it do?
The `end-of-stream` package offers a simple way to attach event listeners to a stream and execute a callback when the stream has completed its operation or encountered an error. This is particularly useful in scenarios where you need to perform actions after a stream has finished processing data or if you need to handle errors that occur during stream operations.

Here's a simplified explanation of how it works:

1. You provide a stream (like a file read stream or a network connection) to the `end-of-stream` function.
2. You also provide a callback function that you want to be executed when the stream ends or encounters an error.
3. The package then attaches various event listeners to the stream, depending on its type (readable, writable, or duplex).
4. When the stream completes successfully or encounters an error, your callback function is called.
5. The package also provides a cleanup function that removes all the attached event listeners, helping to prevent memory leaks.

This functionality is particularly useful in scenarios like file processing, network communications, or any other operations involving data streams where you need to perform actions after the stream has completed or handle potential errors.

## Key Files

1. `index.js`: This is the main file of the package, containing the core functionality.

   The `index.js` file exports a main function `eos` (end-of-stream) that sets up event listeners on a given stream to detect its completion or failure. Here's a brief overview of its key components:

   - `eos(stream, opts, callback)`: The main function that attaches event listeners to the provided stream.
   - `isRequest(stream)`: A helper function to determine if the given stream is a request object.
   - `isChildProcess(stream)`: A helper function to check if the given stream is a child process.

   The `eos` function handles different types of streams (readable, writable, duplex) and sets up appropriate event listeners based on the stream type. It also provides error handling by attaching an 'error' event listener to the stream (unless explicitly disabled in options).

2. `package.json`: This file contains the metadata for the npm package, including its version, dependencies, and scripts.

   Key information from `package.json`:
   - Package name: "end-of-stream"
   - Version: "1.4.4"
   - Main entry point: "index.js"
   - Runtime dependency: "once" (version "^1.4.0")
   - Development dependency: "tape" (version "^4.11.0")
   - Test script: "node test.js"

## Dependencies
The package has one runtime dependency:

1. `once` (version ^1.4.0): This package ensures that a function is only called once. It's used in the `eos` function to guarantee that the callback is not executed multiple times for the same stream event.

The choice of the `once` package is likely due to its simplicity and focused functionality, which aligns well with the single-responsibility principle of the `end-of-stream` package.

For development and testing, the package uses:

1. `tape` (version ^4.11.0): A lightweight testing framework for Node.js, used for running the package's tests.

## Configuration
The `end-of-stream` package doesn't require any specific configuration files or environment variables. However, it does accept an optional `opts` object in its main function, which can be used to configure its behavior. For example:

```javascript
eos(stream, { readable: true, writable: false }, callback)
```

This configuration would set up listeners only for the readable events of the stream, ignoring writable events.

The configurable options include:
- `readable`: Boolean to indicate if the stream is readable
- `writable`: Boolean to indicate if the stream is writable
- `error`: Boolean to indicate if error events should be handled

These options allow users to fine-tune the behavior of the `end-of-stream` function based on their specific use case and the type of stream they're working with.