---
title: "index.js"
---

## High-level description
This code defines and exports a function `eos` (end-of-stream) that attaches event listeners to a stream to detect when it has ended, finished, or encountered an error. It provides a way to handle the completion or failure of various types of streams, including writable, readable, and child process streams.

## Symbols

### `eos(stream, opts, callback)`
#### Description
The main function that sets up event listeners on a given stream to detect its completion or failure.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| stream | Object | The stream to monitor |
| opts | Object | Optional configuration options |
| callback | Function | Function to call when the stream ends or encounters an error |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cleanup | Function | A function that removes all attached event listeners |

#### Internal Logic
1. Normalizes input parameters.
2. Sets up variables for stream state and options.
3. Defines event handler functions for various stream events.
4. Attaches appropriate event listeners based on the stream type and options.
5. Returns a cleanup function to remove all attached listeners.

### `isRequest(stream)`
#### Description
Determines if the given stream is a request object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| stream | Object | The stream to check |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Boolean | True if the stream is a request, false otherwise |

### `isChildProcess(stream)`
#### Description
Determines if the given stream is a child process.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| stream | Object | The stream to check |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Boolean | True if the stream is a child process, false otherwise |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| once | Ensures a function is only called once |

## Error Handling
The code handles errors by attaching an 'error' event listener to the stream (unless explicitly disabled in options) and calling the callback with the error object.

## Side Effects
The function attaches multiple event listeners to the provided stream, which may affect its behavior or performance if not properly cleaned up.

## Performance Considerations
The function uses `process.nextTick()` for the close event handling, which may have implications for the event loop in high-throughput scenarios.