---
title: "index.js"
---

## High-level description
This code provides functionality for packing and extracting tar archives. It offers two main functions: `pack` for creating tar archives from files and directories, and `extract` for extracting files from tar archives. The code handles various file types, permissions, and platform-specific considerations.

## Code Structure
The main symbols in this code are the `pack` and `extract` functions, which are exported. These functions use various helper functions and external dependencies to perform their tasks. The code also defines several utility functions used by both `pack` and `extract`.

## References
This code references various Node.js built-in modules (fs, path, os) and external dependencies (chownr, tar-stream, pump, mkdirp-classic).

## Symbols

### `exports.pack`
#### Description
Creates a tar archive from files and directories in a specified path.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cwd | string | The current working directory to pack |
| opts | object | Options for packing |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| pack | object | A tar pack stream |

#### Internal Logic
1. Sets up options and defaults
2. Creates a statNext function to iterate through files
3. Defines handlers for different file types (directory, symlink, file)
4. Recursively processes files and adds them to the tar pack

### `exports.extract`
#### Description
Extracts files from a tar archive to a specified directory.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cwd | string | The directory to extract files to |
| opts | object | Options for extraction |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| extract | object | A tar extract stream |

#### Internal Logic
1. Sets up options and defaults
2. Creates handlers for different entry types (file, directory, symlink, link)
3. Processes each entry in the tar archive
4. Handles permissions, ownership, and timestamps
5. Creates directories and writes files as needed

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| chownr | Recursive chown |
| tar-stream | Low-level tar stream creation and parsing |
| pump | Pipe streams together and close all of them if one of them closes |
| mkdirp-classic | Recursively create directories |
| fs | File system operations |
| path | Path manipulation |
| os | Operating system-related utility methods |

## Error Handling
The code includes error handling throughout, primarily by passing errors to callbacks or destroying streams when errors occur.

## Platform Considerations
The code includes special handling for Windows (win32) platforms, particularly for path normalization and skipping certain operations (like symlinks and hard links) that may not be fully supported on Windows.

## Performance Considerations
The code uses streaming operations for file reading and writing, which can be more memory-efficient for large files. It also includes options for sorting and filtering entries, which can affect performance depending on the use case.