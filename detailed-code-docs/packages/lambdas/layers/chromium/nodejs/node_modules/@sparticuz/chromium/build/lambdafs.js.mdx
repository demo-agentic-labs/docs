---
title: "lambdafs.js"
---

## High-level description
This code defines a `LambdaFS` class with a static `inflate` method that decompresses compressed files (Brotli or Gzip) and extracts tarballs. It's designed to work in a Lambda environment, handling various compression formats and providing the path to the decompressed file or folder.

## Symbols

### `LambdaFS`
#### Description
A class that provides file system operations for Lambda environments, specifically for decompressing and extracting files.

### `LambdaFS.inflate`
#### Description
A static method that decompresses and extracts compressed files, handling various formats including Brotli, Gzip, and tarballs.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| filePath | string | Path of the file to decompress |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise&lt;string&gt; | Promise | Resolves with the path to the decompressed file/folder |

#### Internal Logic
1. Determines the output path based on the input file name and whether it's a SwiftShader file.
2. Checks if the output already exists to avoid unnecessary decompression.
3. Creates read and write streams for the input and output files.
4. Handles different compression formats (Brotli, Gzip, tar) using appropriate decompression methods.
5. Sets up error handling and resolution for the decompression process.
6. Pipes the input through decompression streams to the output.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| fs | File system operations |
| os | Operating system-related utilities |
| path | File path manipulations |
| tar-fs | Handling tar archives |
| zlib | Compression/decompression utilities |

## Error Handling
The code implements basic error handling by attaching 'error' event listeners to both source and target streams. These errors are rejected through the Promise.

## Performance Considerations
- The code uses a high water mark of 2^23 bytes for reading, which may help with performance for large files.
- For Brotli and Gzip decompression, a chunk size of 2^21 bytes is used, which may be optimized for the expected file sizes.