---
title: "Overview"
---

## High-level description
This directory contains TypeScript modules that manage various aspects of local storage for a connect widget application. The modules handle user agreements, Apple-specific behavior, color modes, custom colors, provider information, and redirect URLs. These utilities are designed to work with browser local storage, providing persistence for user preferences and application state across sessions.

## What does it do?
The code in this directory performs several key functions:

1. Manages user agreement states, allowing the application to track whether a user has accepted terms and conditions.
2. Detects and persists Apple-related sessions, which may be used to customize the user experience for Apple users.
3. Stores and retrieves color mode preferences, likely for supporting light/dark themes in the application.
4. Handles custom color validation and storage, allowing users to personalize the application's appearance.
5. Manages a list of providers, including retrieval, storage, and filtering based on various parameters and device types.
6. Stores success and failure redirect URLs, which are likely used for navigation after certain processes complete.

These functions work together to create a personalized and stateful experience for users of the connect widget, ensuring that their preferences and relevant data persist across browser sessions.

## Key Files

1. `agreement.ts`: Manages the user agreement state, providing functions to set, get, and accept the agreement. It also integrates with an analytics system to track when users accept the agreement.

2. `apple.ts`: Determines if the current session is Apple-related based on URL parameters and local storage. This information can be used to customize the user experience for Apple users.

3. `color-mode.ts`: Handles the storage of color mode preferences, likely used in conjunction with Chakra UI's color mode system for theme management.

4. `custom-color.ts`: Provides functionality for managing and validating custom colors, allowing users to personalize the application's appearance.

5. `providers.ts`: Manages the list of providers for the connect widget, including retrieval, storage, and filtering based on various parameters and device types (Apple or non-Apple).

6. `redirect-url.ts`: Offers utility functions for storing success and failure redirect URLs in local storage, which are likely used for navigation after certain processes complete.

## Dependencies
The code in this directory primarily relies on browser APIs, particularly `localStorage`, for persistent storage. It also references some external modules and constants:

- `Analytics` module from "../analytics" (used in `agreement.ts`)
- `Constants` from "../constants" (used in multiple files)
- `isDemo` flag from "../api" (used in `providers.ts`)
- `DefaultProvider` type from "../../pages/connect/components/connect-providers" (used in `providers.ts`)

The code is designed to work with Chakra UI's color mode system, as evidenced by the use of the "chakra-ui-color-mode" key in `color-mode.ts`.

## Configuration
The modules use several configuration keys for local storage:

- `agreementLocalStorageKey`: "agreement-accepted-v1"
- `isAppleStorageKey`: "is-apple"
- `colorLocalStorageKey`: "custom-color"
- `providersLocalStorageKey`: "providers"
- `Constants.SUCCESS_REDIRECT_URL_PARAM` and `Constants.FAILURE_REDIRECT_URL_PARAM` for redirect URLs

These keys are used consistently across the modules to ensure proper storage and retrieval of data.

The code also considers a `isDemo` flag, which, when true, prevents certain data from being stored in local storage. This is likely used for demonstration or testing purposes.

In summary, this directory provides a comprehensive set of utilities for managing local storage in a connect widget application, handling various aspects of user preferences, session information, and application state. The modular structure allows for easy maintenance and extension of functionality as needed.