---
title: "connect.test.e2e.ts"
---

## High-level description
This code is an end-to-end (e2e) test for the Metriport Connect widget. It verifies that the widget renders the agreement page correctly when accessed with a valid token. The test uses Playwright for browser automation and the Metriport Devices API SDK for interacting with the Metriport API.

## Code Structure
The test file imports necessary dependencies, sets up configuration variables, and defines a single test case. The test case creates a new user, obtains a connect token, navigates to the widget URL with the token, and checks for the presence of a specific heading.

## Symbols

### `test("check if renders agreement", async ({ page }) =&gt; { ... })`
#### Description
This is the main test function that checks if the Metriport Connect widget renders the agreement page correctly.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| page | Page | Playwright's Page object for interacting with the browser |

#### Internal Logic
1. Generate a unique `appUserId` using UUID.
2. Get a Metriport user ID for the generated `appUserId`.
3. Obtain a connect token for the Metriport user ID.
4. Navigate to the widget URL with the token as a query parameter.
5. Assert that the expected heading is visible on the page.
6. Clean up by deleting the created user.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @playwright/test | Provides testing utilities for browser automation |
| @metriport/api-sdk | Metriport API SDK for interacting with the Metriport API |
| uuid | Generates unique identifiers |
| ./shared | Contains utility functions for test configuration |

## Configuration
The test uses the following configuration options:
| Option | Type | Description |
|:-------|:-----|:------------|
| widgetUrl | string | URL of the Metriport Connect widget |
| apiUrl | string | URL of the Metriport API |
| testApiKey | string | API key for authentication with Metriport API |

These configuration options are obtained from the `getTestConfig()` function imported from the `./shared` module.

## Error Handling
The test doesn't implement explicit error handling. It relies on Playwright's built-in error handling and assertion mechanisms.

## Notes
- The test creates a new user for each run and deletes it afterward, ensuring a clean state for each test execution.
- The test uses the Metriport Devices API SDK to interact with the Metriport API, demonstrating how the SDK can be used in a real-world scenario.
- The test is designed to run in an end-to-end testing environment, likely as part of a continuous integration pipeline.