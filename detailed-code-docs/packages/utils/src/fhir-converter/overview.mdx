---
title: "Overview"
---

## High-level description
This directory contains utilities for converting and validating FHIR (Fast Healthcare Interoperability Resources) data, specifically focusing on converting C-CDA XML files to FHIR JSON format and validating the results. The tools provided include scripts for conversion, resource counting, pattern analysis, and end-to-end testing of the conversion process.

## What does it do?
The utilities in this directory perform several key functions:

1. Convert C-CDA XML files to FHIR JSON format.
2. Count and analyze FHIR resources within converted bundles.
3. Validate converted FHIR bundles against a schema.
4. Perform end-to-end testing of the conversion process, including optional insertion into a FHIR server.
5. Analyze HTML patterns within FHIR resources.
6. Generate summaries and statistics about the converted data.

These tools are essential for healthcare data interoperability, ensuring that converted data adheres to FHIR standards and providing insights into the composition and quality of the converted data.

## Entry points
The main entry points for this utility set are:

1. `convert-and-generate-mr.ts`: Converts C-CDA XML files to FHIR JSON and generates a Medical Record summary.
2. `e2e-test.ts`: Performs end-to-end testing of the conversion process, including optional FHIR server insertion.
3. `count-resources.ts`: Counts FHIR resources in converted bundles.
4. `validate-fhir-bundles.ts`: Validates converted FHIR bundles and generates HTML summaries.

These scripts orchestrate the overall processes, calling upon various helper functions and modules to perform specific tasks.

## Key Files
1. `convert.ts`: Contains core functionality for converting C-CDA XML to FHIR JSON.
2. `shared.ts`: Provides utility functions for resource counting and analysis.
3. `count-bundle-refs.ts`: Analyzes and counts references within FHIR bundles.
4. `count-html-patterns.ts`: Analyzes HTML patterns within FHIR resources.
5. `validator/validate-converted-xmls.ts`: Validates converted FHIR bundles against a schema.

## Dependencies
The codebase relies on several external libraries:

| Dependency | Purpose |
|:-----------|:--------|
| @medplum/fhirtypes | FHIR type definitions |
| @metriport/core | Core utilities for FHIR conversion |
| @metriport/shared | Shared utility functions |
| axios | HTTP client for API requests |
| dayjs | Date manipulation library |
| dotenv | Environment variable management |
| commander | Command-line interface parsing |
| jsonschema | JSON schema validation |

## Configuration
Configuration is primarily managed through command-line arguments and environment variables. Key configurable aspects include:

- Paths for input XML files and output JSON files
- FHIR converter API endpoint
- FHIR server URL for data insertion
- Parallel processing settings for conversion and insertion

## Error Handling
The codebase implements error handling throughout, with a focus on:

- Logging errors during file processing and conversion
- Capturing and reporting validation errors
- Handling API request failures
- Providing detailed error messages and statistics

Error information is typically logged to the console and, in some cases, written to output files for further analysis.

In conclusion, this utility set provides a comprehensive toolkit for converting, validating, and analyzing FHIR data, with a particular focus on C-CDA to FHIR conversion. It offers flexibility in processing and analyzing large volumes of healthcare data while ensuring adherence to FHIR standards.