---
title: "enhance-coverage.ts"
---

## High-level description
This code implements a script to enhance coverage for CommonWell Health Alliance by updating patient information and querying documents. It uses various utilities and APIs to manage authentication, patient data, and document queries.

## Code Structure
The main script interacts with several modules:
- Patient loaders and updaters to manage patient data
- CommonWell Management API for interacting with CommonWell
- Document query utilities to fetch patient documents
- Authentication and session management for CommonWell portal
- Error handling and logging utilities

## Symbols

### `main`
#### Description
The main function that orchestrates the coverage enhancement process.

#### Internal Logic
1. Initializes necessary components and configurations
2. Enhances coverage for specified patients
3. Triggers document queries for patients
4. Updates enhanced coverage information

### `getConnectors`
#### Description
Creates and returns instances of `CodeChallenge` and `CookieManager` based on configuration.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| codeChallenge | CodeChallenge | Instance for handling code challenges |
| cookieManager | CookieManager | Instance for managing cookies |

### `CoverageEnhancerLocal`
#### Description
Implements the Enhanced Coverage flow with logic running in the local environment.

#### Methods
- `enhanceCoverage`: Enhances coverage for specified patients and organizations.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| dotenv | Load environment variables |
| @metriport/core | Core functionality for patient data and API interactions |
| axios | HTTP client for API requests |
| dayjs | Date and time manipulation |
| playwright | Browser automation for session management |

## Configuration
The script uses various environment variables for configuration:
- API URLs
- CommonWell credentials
- AWS region and secret ARNs

## Error Handling
The script includes error handling mechanisms, including capturing errors and optionally taking screenshots during the session management process.

## Logging
The script uses console logging for debugging and progress tracking.

## Performance Considerations
- The script processes patients in chunks to manage API rate limits
- Implements parallel document queries with a configurable number of concurrent executions

This script is designed to enhance patient coverage in CommonWell Health Alliance by updating patient information and querying documents. It handles authentication, manages sessions, and interacts with various APIs to accomplish this task.