---
title: "scoring-function-analysis.ts"
---

## High-level description
This code implements a scoring function analysis tool for patient demographics. It processes patient data from a CSV file, applies scoring functions to compare core demographics with linked demographics, and analyzes the results to understand the potential impact of these scoring functions on historical data.

## Code Structure
The main function `main()` initializes the program and reads data from a CSV file. The `loadData()` function processes this data, applying scoring functions and analyzing the results. The code uses various utility functions for data normalization and comparison, which are imported from other modules.

## Symbols

### `main()`
#### Description
The entry point of the program. It sets up the command-line interface and reads data from a CSV file.

#### Internal Logic
1. Parses command-line arguments.
2. Reads data from the specified CSV file.
3. Calls `loadData()` with the parsed results.

### `loadData(rows: Row[])`
#### Description
Processes the loaded data, applies scoring functions, and analyzes the results.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| rows | Row[] | Array of patient data rows from the CSV file |

#### Internal Logic
1. Initializes counters and data structures.
2. Iterates through each scoring function.
3. For each patient data row:
   - Normalizes core and link demographics.
   - Checks for new demographics.
   - Applies the scoring function.
   - Updates counters based on results.
4. Calculates and logs statistics for each scoring function.

### `createPercent(a: number, b: number)`
#### Description
Calculates and formats a percentage.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| a | number | Numerator |
| b | number | Denominator |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | string | Formatted percentage string |

### `createComparison()`
#### Description
Creates a formatted string comparison between core and link demographics.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| coreDemographics | LinkDemographics | Core patient demographics |
| linkDemographics | LinkDemographics | Linked demographics |
| comparison | LinkDemographicsComparison | Comparison result |
| keyword | string | Keyword for the comparison |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | string | Formatted comparison string |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| dotenv | Environment variable configuration |
| @metriport/core | Core domain models and utilities |
| @metriport/ihe-gateway-sdk | Patient discovery models |
| commander | Command-line interface |
| csv-parser | CSV file parsing |
| dayjs | Date manipulation |
| fs | File system operations |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| inputFileName | string | "/absolute/path/to/csv" | Path to the input CSV file |
| detailedNewDemo | boolean | false | Flag to enable detailed new demographics logging |
| detailedPass | boolean | false | Flag to enable detailed pass logging |

## Error Handling
The code does not implement specific error handling mechanisms beyond basic exception raising.

## Logging
The code uses the `out()` function from `@metriport/core/util/log` for logging. It logs various statistics and comparisons based on the analysis results.