---
title: "Overview"
---

## High-level description
This directory contains utility scripts and functions for handling document-related operations in the Metriport Medical API. It includes tools for document querying, uploading, and post-processing, as well as scripts for testing and populating document query progress functionality.

## What does it do?
The code in this directory performs several key functions related to medical document management:

1. Document Querying: It provides functionality to start consolidated queries and document queries for patient data, including specific resources like AllergyIntolerance.

2. Document Uploading: The code allows for creating document references and uploading medical documents to the Metriport system. It handles the process of obtaining upload URLs and sending the document files.

3. Post-processing: After a document is uploaded, there's a script to handle post-processing tasks, which involves moving the document between S3 buckets and updating metadata.

4. Testing and Validation: The directory includes scripts for creating test patients, uploading various types of documents (XML, PDF, JPEG), testing the load on the conversion status endpoint, and validating document query progress functionality.

These functionalities simulate real-world scenarios in a medical records system, helping to ensure that the Metriport Medical API can efficiently handle various operations related to patient documents.

## Entry points
The main entry points for this directory are:

1. `document-query.ts`: Demonstrates how to use the MetriportMedicalApi class to start consolidated queries and document queries.

2. `document-upload.ts`: Provides functionality for uploading medical documents, including creating document references and obtaining upload URLs.

3. `document-upload-post-process.ts`: Handles the post-processing of uploaded documents, moving them between S3 buckets and updating metadata.

4. `populate-patient-docs.ts`: Creates test patients and uploads various types of documents for testing purposes.

5. `test-conversion-load.ts`: Tests the load on the conversion status endpoint of the medical API.

6. `validate-doc-query-progress.ts`: Validates the document query progress functionality for a set of patients.

The data flow typically starts with creating or selecting a patient, then moves to uploading documents or querying existing documents. The control flow is managed within each script's main function, which orchestrates the various operations.

## Key Files
1. `document-query.ts`: Implements functionality for querying patient documents and data.

2. `document-upload.ts`: Handles the process of uploading medical documents to the Metriport system.

3. `document-upload-post-process.ts`: Manages post-processing tasks for uploaded documents.

4. `patients.ts`: Defines a list of fictional patients used for testing purposes.

5. `populate-patient-docs.ts`: Creates test patients and uploads various document types for testing.

6. `test-conversion-load.ts`: Simulates high load on the conversion status endpoint.

7. `validate-doc-query-progress.ts`: Tests the document query progress functionality.

Each file plays a crucial role in the overall document management system, from handling individual document operations to setting up test environments and validating system performance.

## Dependencies
The code in this directory relies on several external libraries and internal modules:

1. @metriport/api-sdk: Used for interacting with the Metriport Medical API.
2. @metriport/core: Provides utility functions and type definitions.
3. @metriport/shared: Offers shared utilities and constants.
4. axios: Used for making HTTP requests.
5. dotenv: Loads environment variables for configuration.
6. dayjs: Handles date and time operations.
7. @faker-js/faker: Generates fake data for testing purposes.
8. @medplum/fhirtypes: Provides FHIR type definitions.
9. fs: Used for file system operations.

These dependencies were chosen to provide robust API interaction, efficient HTTP requests, and helpful utilities for testing and data manipulation.

## Configuration
The scripts use environment variables for configuration, typically loaded using dotenv. Key configuration options include:

1. API_KEY: The Metriport API key for authentication.
2. API_URL: The base URL for the Metriport API.
3. PATIENT_ID: The ID of the patient for which operations are performed.
4. FACILITY_ID: The ID of the facility used for patient creation.
5. SOURCE_BUCKET: The source S3 bucket name for document post-processing.
6. DESTINATION_BUCKET: The destination S3 bucket name for document post-processing.
7. AWS_REGION: The AWS region where the S3 buckets are located.

These configuration options allow for flexible testing scenarios and easy adaptation to different environments or requirements.

Example usage of configuration in `document-upload.ts`:

```typescript
const API_KEY = getEnvVarOrFail("API_KEY");
const API_URL = getEnvVarOrFail("API_URL");
const PATIENT_ID = getEnvVarOrFail("PATIENT_ID");
```

This configuration setup allows for easy modification of API endpoints and patient data without changing the code.

In conclusion, this directory provides a comprehensive set of tools for managing, testing, and validating document-related operations in the Metriport Medical API. The scripts cover various aspects from document uploading and querying to load testing and progress validation, ensuring robust and reliable API performance in handling medical documents.