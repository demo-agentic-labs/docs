---
title: "document-query.ts"
---

## High-level description
This code is a script that interacts with the Metriport Medical API to perform various operations related to patient data and document queries. It demonstrates how to use the MetriportMedicalApi class to start consolidated queries, document queries, and handle API responses.

## Code Structure
The main function `main()` is an async function that performs two primary operations:
1. Starts a consolidated query for a patient's data.
2. Starts a document query for a patient.

Both operations use the `MetriportMedicalApi` class to interact with the Metriport API.

## Symbols

### `main()`
#### Description
The main function that executes the API calls and handles the responses.

#### Internal Logic
1. Initializes the Metriport API client with the provided API key and URL.
2. Starts a consolidated query for a patient's data, specifically for AllergyIntolerance resources within a date range.
3. Starts a document query for a patient.
4. Logs the responses from both operations.
5. Catches and logs any errors that occur during execution.

### `MetriportMedicalApi`
#### Description
A class from the Metriport API SDK used to interact with the Metriport Medical API.

#### Inputs
- `apiKey`: String - The API key for authentication.
- `options`: Object - Configuration options for the API client.

#### Methods Used
- `startConsolidatedQuery`: Initiates a consolidated query for patient data.
- `startDocumentQuery`: Initiates a document query for a patient.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| dotenv | To load environment variables from a .env file |
| @metriport/api-sdk | To use the MetriportMedicalApi class for API interactions |
| @metriport/core/util/env-var | To retrieve environment variables |

## Configuration
The script uses the following environment variables:
| Option | Type | Description |
|:-------|:-----|:------------|
| API_KEY | string | The API key for authenticating with the Metriport API |
| API_URL | string | The base URL for the Metriport API |
| PATIENT_ID | string | The ID of the patient for which queries are performed |
| FACILITY_ID | string | The ID of the facility associated with the document query |

## Error Handling
The main function is wrapped in a try-catch block to catch and log any errors that occur during execution.

## TODOs
- The commented out console.log for "Starting consolidated query..." could be removed or uncommented if needed.

This script serves as a demonstration of how to use the Metriport Medical API for querying patient data and documents. It's likely used for testing or as a starting point for more complex applications that interact with the Metriport API.