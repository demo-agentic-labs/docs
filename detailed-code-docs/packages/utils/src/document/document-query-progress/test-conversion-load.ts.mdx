---
title: "test-conversion-load.ts"
---

## High-level description
This code is a utility script for testing the load on the conversion status endpoint of a medical API. It simulates setting document query progress, setting conversion status for multiple requests, and then checking if the document query progress for a patient is correct.

## Code Structure
The main functionality is implemented in the `main()` function, which uses the `internalApi` and `metriportApi` instances to interact with the API. The script sets up initial document query progress, sends multiple conversion status requests, and then checks the final query status.

## Symbols

### `main()`
#### Description
The main function that orchestrates the load test for the conversion status endpoint.

#### Internal Logic
1. Sets the initial document query progress for a patient.
2. Sends multiple conversion status requests concurrently.
3. Checks the final document query status.
4. Logs the result of the load test.

### `internalApi`
#### Description
An Axios instance configured for internal API calls.

### `metriportApi`
#### Description
An instance of the MetriportMedicalApi class for making API calls.

### `docQueryProgress`
#### Description
An object representing the initial document query progress.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| dotenv | Load environment variables |
| @metriport/api-sdk | Metriport API SDK |
| @metriport/core/external/index | Medical data source enums |
| @metriport/core/util/env-var | Environment variable utilities |
| dayjs | Date manipulation |
| axios | HTTP client |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| API_KEY | string | - | API key for authentication |
| API_URL | string | - | Base URL for the API |
| CX_ID | string | - | Customer ID |
| NUM_OF_REQUESTS | number | 1000 | Number of conversion status requests to send |

## Error Handling
The script uses a try-catch block in the `main()` function to catch and log any errors that occur during the load test.

## Logging
The script logs the final query status and whether the load test was successful or not.

## Performance Considerations
The script uses `Promise.all()` to send multiple conversion status requests concurrently, which can help simulate high load on the API endpoint.

## TODOs
- The `patientId` variable is currently empty and needs to be set before running the script.