---
title: "populate-patient-docs.ts"
---

## High-level description
This utility script is designed to create patients and upload documents for testing purposes. It creates new patients based on predefined data, and then uploads a set number of XML, PDF, and JPEG documents for each patient using the Metriport Medical API.

## Code Structure
The script imports necessary dependencies, sets up configuration variables, and defines functions to create patients and upload documents. The main logic is executed in the `main()` function, which iterates through a list of patients to create, creates each patient, and then uploads documents for each patient.

## Symbols

### `main()`
#### Description
The main function that orchestrates the creation of patients and uploading of documents.

#### Internal Logic
1. Iterates through the `patientsToCreate` array.
2. Creates a new patient for each entry using the Metriport API.
3. Calls `uploadDocType` for XML, PDF, and JPEG document types concurrently for each patient.

### `uploadDocType(patient: PatientDTO, type: "xml" | "pdf" | "jpeg", count: number)`
#### Description
Uploads a specified number of documents of a given type for a patient.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patient | PatientDTO | The patient object for whom documents are being uploaded |
| type | "xml" \| "pdf" \| "jpeg" | The type of document to upload |
| count | number | The number of documents to upload |

#### Internal Logic
1. Creates a document reference for each document.
2. Obtains an upload URL from the Metriport API.
3. Uploads the file content to the provided URL.
4. Logs the success or failure of each upload.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| dotenv | Load environment variables |
| axios | Make HTTP requests |
| @metriport/api-sdk | Interact with Metriport Medical API |
| @metriport/core/util/env-var | Get environment variables |
| fs | Read local files |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| API_KEY | string | N/A | Metriport API key |
| API_URL | string | N/A | Metriport API URL |
| FACILITY_ID | string | N/A | Facility ID for patient creation |
| NUM_XML | number | 300 | Number of XML documents to upload per patient |
| NUM_PDF | number | 100 | Number of PDF documents to upload per patient |
| NUM_JPEG | number | 100 | Number of JPEG documents to upload per patient |

## Error Handling
The script uses try-catch blocks to handle errors during patient creation and document uploading. Errors are logged to the console.

## Logging
The script uses console.log for logging information about patient creation, document uploads, and any errors encountered.

## TODOs
- Update the file paths for XML, PDF, and JPEG files (currently using placeholder paths).