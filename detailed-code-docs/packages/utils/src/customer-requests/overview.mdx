---
title: "Overview"
---

## High-level description
This directory contains utility scripts and functions for handling various customer requests related to medical records and data processing. The scripts are designed to interact with APIs, process FHIR data, generate medical record summaries, and perform various data conversion and download operations.

## What does it do?
The scripts in this directory perform several key functions:

1. Convert HTML tables to CSV format, extracting patient information and structured data.
2. Download medical documents from S3 buckets for specific patients, maintaining the original folder structure.
3. Retrieve and store consolidated patient data as JSON files.
4. Generate and download Medical Records (MRs) as PDFs for a subset of patients.
5. Create Medical Record Summaries with AI-generated briefs from FHIR payloads.
6. Convert FHIR Bundles to HTML format for local testing and development.
7. Trigger the generation of consolidated medical records for multiple patients using the Metriport API.

These scripts are designed to work with medical data, FHIR resources, and various APIs to facilitate data processing, conversion, and retrieval for customer requests.

## Key Files

### convert-html-to-csv.ts
This file contains a function to convert HTML tables into CSV format, specifically targeting tables within sections and extracting patient information.

### download-docs.ts
A utility script for downloading medical documents from an S3 bucket for specific patients, creating a local folder structure that mirrors the S3 organization.

### get-consolidated.ts
This script retrieves and stores consolidated data for a subset of patients, fetching each patient's data as JSON from an API and storing it locally.

### get-exams.ts
Implements a utility for executing asynchronous operations on a collection of items in parallel, with configurable concurrency, delay, and error handling.

### medical-records-create.ts
A script for generating and downloading Medical Records (MRs) as PDFs for a subset of patients, interacting with an API to retrieve and store the records.

### medical-records-local-with-brief.ts
Generates a Medical Record Summary with an AI-generated Brief from a FHIR payload locally, with options to store the results in S3.

### medical-records-local.ts
A simple script that reads a FHIR Bundle from a JSON file, converts it to HTML format, and writes the result to a file for local testing.

### medical-records-trigger.ts
Triggers the generation of consolidated medical records for a list of patients using the Metriport API, allowing for customization of date ranges and resources to include.

## Dependencies
The scripts in this directory rely on several external libraries and frameworks:

- @medplum/fhirtypes: For FHIR type definitions
- @metriport/core: Core functionality for medical record processing
- @metriport/shared: Shared utilities and error handling
- axios: For making HTTP requests
- dayjs: For date and time manipulation
- dotenv: For loading environment variables
- fs: For file system operations
- xmldom: For parsing HTML strings into DOM objects
- base64url: For encoding customer IDs for authentication

## Configuration
The scripts use various environment variables for configuration, including:

- API_URL: The base URL for the API
- CX_ID: The customer ID
- AWS_REGION: AWS region for S3 operations
- MEDICAL_DOCUMENTS_BUCKET_NAME: S3 bucket name for medical documents
- BEDROCK_REGION: AWS Bedrock region
- BEDROCK_VERSION: AWS Bedrock version
- MR_BRIEF_MODEL_ID: Model ID for MR Brief generation

These environment variables are typically loaded using dotenv and accessed through utility functions from @metriport/core and @metriport/shared packages.

The scripts also include various configuration options within the code, such as date ranges, resources to include, and conversion types, which can be customized for specific use cases.

In summary, this directory provides a set of powerful tools for processing, converting, and retrieving medical data in various formats, catering to different customer needs and integrating with external APIs and services.