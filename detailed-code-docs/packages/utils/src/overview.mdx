---
title: "Overview"
---

## High-level description
This directory contains utility scripts and functions for various tasks related to the Metriport medical API. It includes tools for patient management, data conversion, file handling, API interactions, and testing utilities. The code is designed to work with healthcare data, FHIR resources, and various external services like AWS S3 and OpenSearch.

## What does it do?
The utilities in this directory perform a wide range of functions, including:

1. Patient data management: Creating, updating, and querying patient information.
2. Data conversion: Converting between different healthcare data formats (e.g., FHIR, CDA, XML).
3. File operations: Handling file uploads, downloads, and conversions, particularly with AWS S3.
4. API interactions: Making requests to various healthcare-related APIs and processing responses.
5. Testing and simulation: Providing mock implementations and test utilities for healthcare interoperability processes.
6. Data analysis: Analyzing and processing healthcare data, including patient demographics and medical records.
7. Queue management: Working with Amazon SQS, including handling Dead Letter Queues.
8. Search operations: Interacting with OpenSearch for indexing and querying healthcare data.

These utilities are designed to support various aspects of healthcare data management, interoperability, and analysis within the Metriport ecosystem.

## Entry points
The main entry points for this utility set are spread across multiple files, each focusing on a specific functionality. Some key entry points include:

1. `bulk-insert-patients.ts`: For inserting multiple patients into the system.
2. `bulk-query-patients.ts`: For querying data for multiple patients.
3. `document-upload.ts`: For uploading medical documents.
4. `fhir-converter/e2e-test.ts`: For end-to-end testing of FHIR conversion processes.
5. `saml/saml-server.ts`: For testing SAML-related functionality.
6. `open-search/re-populate.ts`: For re-populating OpenSearch with data from a FHIR server.

These scripts often use command-line arguments or environment variables for configuration, allowing flexible usage in different scenarios.

## Key Files
1. `patient/index.ts`: Contains functions for retrieving patient IDs.
2. `fhir-converter/convert.ts`: Handles conversion of healthcare data formats.
3. `document/document-upload.ts`: Manages document upload processes.
4. `commonwell/session-manager.ts`: Handles session management for CommonWell interactions.
5. `open-search/cleanup.ts`: Provides utilities for cleaning up XML/CDA files.
6. `sqs/populate-sqs.ts`: Handles populating SQS queues with messages.

## Dependencies
The codebase relies on several external libraries and services:

1. AWS SDK: For interacting with AWS services like S3 and SQS.
2. Axios: For making HTTP requests.
3. Express: For creating mock servers in testing scenarios.
4. Medplum FHIR types: For FHIR data structure definitions.
5. OpenSearch: For search and analytics functionality.
6. Sequelize: For database operations.
7. Various Metriport internal packages: For core functionalities and shared utilities.

## Configuration
Configuration is primarily managed through environment variables and command-line arguments. Common configurable aspects include:

1. API endpoints and keys
2. AWS credentials and region settings
3. Database connection details
4. File paths for input/output operations
5. Operational parameters like batch sizes and delay times

Many scripts use dotenv for loading environment variables, allowing for flexible configuration across different environments.

In conclusion, this utils directory provides a comprehensive set of tools for working with healthcare data in the Metriport ecosystem. It covers a wide range of functionalities from basic file operations to complex healthcare data processing and interoperability tasks. The utilities are designed to be flexible and configurable, supporting various use cases in healthcare data management and analysis.