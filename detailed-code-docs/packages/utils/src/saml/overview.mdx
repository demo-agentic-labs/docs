---
title: "Overview"
---

## High-level description
This directory contains utility scripts and mock implementations for testing and analyzing SAML (Security Assertion Markup Language) and IHE (Integrating the Healthcare Enterprise) gateway functionality in a healthcare interoperability context. The code primarily focuses on simulating and testing Cross-Community Patient Discovery (XCPD), Document Query (DQ), and Document Retrieval (DR) processes.

## What does it do?
The code in this directory provides several key functionalities:

1. It simulates an IHE gateway server for testing purposes, handling patient discovery, document query, and document retrieval requests.
2. It implements a SAML server for testing SOAP+SAML requests, creating and signing various types of healthcare interoperability requests.
3. It provides utilities for analyzing SAML responses from different healthcare vendors, calculating statistics on patient matches and errors.
4. It includes a mock implementation of S3 utilities for testing without interacting with actual AWS S3 services.
5. It offers a pre-production tester for querying and processing patient discovery, document query, and document retrieval requests through the Carequality gateway.
6. It provides a helper script for bulk testing of SOAP+SAML requests in a Metriport IHE Gateway environment.

These tools collectively enable developers to test, analyze, and simulate various aspects of healthcare interoperability processes without relying on live production systems.

## Key Files

### mock-ihe-gateway.ts
This file implements a mock IHE gateway server using Express.js. It provides endpoints for patient discovery, document query, and document retrieval, simulating the functionality of a real IHE gateway for testing and development purposes.

### saml-server.ts
This file implements a SAML server for testing SOAP+SAML requests in a healthcare interoperability context. It creates and signs XCPD, XCA DQ, and XCA DR requests, sends them to specified gateways, and processes the responses.

### saml-coverage.ts
This file provides functionality for analyzing SAML responses from various healthcare vendors. It processes a JSON file containing SAML responses, calculates statistics on patient matches and errors, and provides detailed analysis by vendor.

### mock-s3.ts
This file defines a `MockS3Utils` class that extends the `S3Utils` class, providing mock implementations for S3 operations. It's designed for testing purposes, simulating S3 functionality without actually interacting with AWS S3 services.

### pre-prod-tester.ts
This script is a test utility for querying and processing patient discovery (XCPD), document query (DQ), and document retrieval (DR) requests through the Carequality gateway. It simulates the flow of retrieving patient information, querying for documents, and retrieving those documents.

### bulk-saml.ts
This file contains a helper script for testing SOAP+SAML requests in a Metriport IHE Gateway environment. It constructs SOAP envelopes, sends them to specified gateways, and logs the results for analysis.

## Dependencies
The code in this directory relies on several key dependencies:

1. Express.js: Used for creating mock servers and handling HTTP requests.
2. @metriport/core: Provides core utilities and functions for healthcare interoperability.
3. @metriport/ihe-gateway-sdk: SDK for interacting with IHE gateways.
4. dotenv: Used for loading environment variables.
5. uuid: Used for generating unique identifiers.
6. dayjs: Used for date and time manipulation.
7. fs: Node.js file system module for reading and writing files.

## Configuration
The code uses environment variables for configuration, which are typically loaded using dotenv. Key configuration options include:

- Environment type (e.g., STAGING)
- Server ports
- SAML certificates and keys
- AWS region (for S3 operations, even though mocked)

Many files include TODO comments about removing `false &&` in `getRejectUnauthorized()` once Allscripts patches their endpoints, indicating ongoing development and potential security considerations.

In summary, this directory provides a comprehensive set of tools for testing, simulating, and analyzing various aspects of healthcare interoperability processes, with a focus on SAML and IHE gateway functionality. It's designed to be used in development and testing environments to ensure robust and reliable healthcare data exchange systems.