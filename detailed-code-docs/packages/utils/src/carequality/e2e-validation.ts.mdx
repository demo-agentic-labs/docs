---
title: "e2e-validation.ts"
---

## High-level description
This code implements an end-to-end validation process for the Carequality integration in the Metriport medical API. It creates a test patient, performs document queries and retrievals, and verifies the results, simulating the full workflow of patient data exchange through Carequality.

## Code Structure
The main function `main()` orchestrates the entire validation process. It uses the `MetriportMedicalApi` client to interact with the API and the `Sequelize` ORM to query the database directly. Various utility functions from external modules are used for polling and sleeping.

## Symbols

### `main()`
#### Description
The main function that runs the end-to-end validation process for the Carequality integration.

#### Internal Logic
1. Creates a test patient using the Metriport API
2. Waits for patient data to be populated in the database
3. Initiates a document query for the patient
4. Polls for document query results
5. Initiates document retrieval
6. Polls for document retrieval results
7. Checks the final status of the document query
8. Deletes the test patient

### `queryDbResults(tableName: string, patientId: string)`
#### Description
Queries the database for results related to a specific patient.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| tableName | string | The name of the table to query |
| patientId | string | The ID of the patient to query for |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| results | any[] | The query results |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| dotenv | Load environment variables |
| @metriport/core | Utility functions |
| @metriport/api-sdk | Metriport Medical API client |
| sequelize | Database ORM |
| @metriport/shared | Utility functions |
| dayjs | Date manipulation |
| axios | HTTP client |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| API_URL | string | - | The URL of the Metriport API |
| API_KEY | string | - | The API key for authentication |
| DB_CREDS | string | - | JSON string containing database credentials |
| CX_ID | string | - | The customer ID |

## Error Handling
The main function catches and logs any errors that occur during the validation process. Specific error checks are implemented for missing patient data in the database.

## Logging
Console logging is used throughout the script to provide information about the progress and results of the validation process.

This code is a comprehensive test suite for validating the Carequality integration in the Metriport medical API, covering patient creation, document querying, and retrieval processes.