---
title: "index.ts"
---

## High-level description
This code is a command-line tool for running Carequality certification test cases. It sets up a patient discovery process using the IHE Gateway SDK, configures the environment using command-line options and a .env file, and initiates a patient discovery request.

## Code Structure
The main function `main()` orchestrates the entire process, using the `Command` class from the `commander` library to handle command-line arguments. It then uses the `IHEGateway` class from the `@metriport/ihe-gateway-sdk` to perform the patient discovery operation.

## Symbols

### `metriportBanner()`
#### Description
Returns a string containing ASCII art and text representing the Metriport banner.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| return value | string | ASCII art banner for Metriport |

### `program`
#### Description
An instance of the `Command` class from the `commander` library, used to define and parse command-line options.

### `main()`
#### Description
The main function that orchestrates the entire process of running the Carequality certification test cases.

#### Internal Logic
1. Displays the Metriport banner
2. Parses command-line arguments
3. Loads environment variables from the specified .env file
4. Retrieves necessary configuration values from environment variables
5. Initializes an `IHEGateway` instance
6. Generates a patient payload using the `generatePatient` function
7. Initiates a patient discovery request using the `IHEGateway` instance

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/ihe-gateway-sdk | Provides the `IHEGateway` class for interacting with the IHE Gateway |
| @metriport/shared/common/env-var | Provides utility functions for handling environment variables |
| dotenv | Loads environment variables from a .env file |
| commander | Handles command-line argument parsing |

## Configuration
The tool requires a .env file with the following configuration options:
| Option | Type | Description |
|:-------|:-----|:------------|
| IHE_GATEWAY_URL | string | URL of the IHE Gateway |
| XCPD_GATEWAY_ID | string | ID of the XCPD Gateway |
| XCPD_GATEWAYS_OID | string | OID of the XCPD Gateway |
| XCPD_GATEWAYS_URL | string | URL of the XCPD Gateway |
| ORG_NAME | string | Name of the organization |
| ORG_OID | string | OID of the organization |

## TODOs
- Update the example .env file contents in the command-line help text
- Include document query and retrieval when API routes are ready

Note: The code currently only implements patient discovery. Document query and retrieval functionality is planned for future implementation.