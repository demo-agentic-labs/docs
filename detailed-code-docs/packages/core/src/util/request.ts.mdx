---
title: "request.ts"
---

## High-level description
This code provides utility functions for managing and retrieving request IDs in an asynchronous context. It offers two methods: one for safely retrieving a request ID, and another for retrieving a request ID with error handling.

## Symbols

### `getRequestIdSafe`
#### Description
This function safely retrieves the request ID from the local storage associated with the current asynchronous context.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| requestId | string \| undefined | The request ID if found, otherwise undefined |

#### Internal Logic
1. Retrieves the local storage associated with the key "reqId".
2. Gets the stored value from the local storage.
3. Returns the stored value if it exists, otherwise returns undefined.

### `getRequestId`
#### Description
This function retrieves the request ID from the local storage and throws an error if it's not found.

#### Inputs
None

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| requestId | string | The request ID |

#### Internal Logic
1. Calls `getRequestIdSafe` to retrieve the request ID.
2. If the request ID is not found (undefined), it throws an error.
3. Otherwise, it returns the request ID.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| ./local-storage | Provides the `getLocalStorage` function to access asynchronous local storage |

## Error Handling
The `getRequestId` function throws an error if the request ID is not found in the asynchronous local storage. This error handling ensures that the calling code is aware when a request ID is expected but not available.

## References
The `getRequestIdSafe` function is referenced in the related file `packages/core/src/util/log.ts`. It's used in the `log` function to include the request ID in log messages when available.

## Side Effects
These functions rely on the state of the asynchronous local storage, which is assumed to be set up elsewhere in the application. The behavior of these functions depends on whether a request ID has been properly stored in the local storage for the current asynchronous context.