---
title: "match-patient.test.ts"
---

## High-level description
This file contains unit tests for the patient matching functions in the Master Patient Index (MPI) system. It tests the `jaroWinklerSimilarity`, `matchingPersonalIdentifiersRule`, and `matchingContactDetailsRule` functions to ensure they correctly identify matching and non-matching patients based on various criteria.

## Code Structure
The code is organized into three main test suites, each focusing on a specific matching function. Each suite contains multiple test cases to cover different scenarios and edge cases.

## References
This test file references functions from "../match-patients" and types from "../shared". It also uses test data from "./test_data".

## Symbols

### `describe("jaroWinklerSimilarity", ...)`
#### Description
This test suite checks the functionality of the `jaroWinklerSimilarity` function.

#### Internal Logic
1. Tests if the function correctly identifies sample inclusions as matches.
2. Tests if the function correctly identifies sample exclusions as non-matches.

### `describe("matchingPersonalIdentifiersRule", ...)`
#### Description
This test suite verifies the `matchingPersonalIdentifiersRule` function.

#### Internal Logic
1. Tests if the function correctly identifies matching personal identifiers.
2. Tests if the function correctly identifies non-matching personal identifiers.

### `describe("matchingContactDetailsRule", ...)`
#### Description
This test suite checks the `matchingContactDetailsRule` function.

#### Internal Logic
1. Tests if the function correctly handles non-existent contact details.
2. Tests if the function correctly identifies non-matching contact details.
3. Tests if the function correctly handles cases with only phone numbers.
4. Tests if the function correctly handles cases with only email addresses.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| jaroWinklerSimilarity | Function being tested for patient similarity |
| matchingPersonalIdentifiersRule | Function being tested for matching personal identifiers |
| matchingContactDetailsRule | Function being tested for matching contact details |
| PatientMPI | Type definition for patient data in MPI |
| testPatientMPI | Test data for patient matching scenarios |

## Error Handling
The tests use Jest's `expect` function to assert the expected outcomes. If any assertion fails, the test will fail and provide details about the mismatch.

## TODOs
There are no explicit TODOs in this code.

Note: The code uses non-null assertions (`!`) in several places, which might be a point of concern for strict type checking. Consider using optional chaining or null checks instead if possible.