---
title: "normalize-patient.test.ts"
---

## High-level description
This file contains unit tests for the `normalizePatient` function, which is responsible for normalizing patient data in the Metriport system. The tests focus on email normalization, name and address normalization, and handling of various edge cases.

## Code Structure
The file is structured into two main `describe` blocks:
1. "normalizePatient email normalization": Tests specific to email normalization.
2. "normalizePatient": Tests for overall patient data normalization, including names and addresses.

Each block contains multiple test cases using the `it` function. The tests use a helper function `makePatientMPI` to create test data.

## Symbols

### `describe("normalizePatient", ...)`
#### Description
This is the main test suite for the `normalizePatient` function. It contains multiple test cases to verify the function's behavior.

### `it("should normalize email addresses to lowercase and remove leading/trailing whitespaces", ...)`
#### Description
This test case verifies that the `normalizePatient` function correctly normalizes email addresses by converting them to lowercase and removing leading/trailing whitespaces.

#### Internal Logic
1. Arrange: Create a `patientMPI` object with an email address containing uppercase letters and whitespaces.
2. Act: Call `normalizePatient` with the created `patientMPI`.
3. Assert: Check if the resulting email address is lowercase and trimmed.

### `it("should leave the email field unchanged if it is empty", ...)`
#### Description
This test case ensures that the `normalizePatient` function doesn't modify empty email fields.

#### Internal Logic
1. Arrange: Create a `patientMPI` object with an empty email address.
2. Act: Call `normalizePatient` with the created `patientMPI`.
3. Assert: Verify that the email field remains empty.

### `it("should lowercase name and address and alter street suffix", ...)`
#### Description
This test case checks if the `normalizePatient` function correctly normalizes names and addresses by converting them to lowercase.

#### Internal Logic
1. Arrange: Create a `patientMPI` object with mixed-case names and addresses.
2. Act: Call `normalizePatient` with the created `patientMPI`.
3. Assert: Verify that names and addresses are converted to lowercase.

### `makePatientMPI(overrides)`
#### Description
This is a helper function that creates a `PatientMPI` object with default values, allowing for easy customization through the `overrides` parameter.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| overrides | Partial&lt;PatientMPI&gt; | Optional. Partial patient data to override default values. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patientMPI | PatientMPI | A PatientMPI object with default or overridden values. |

#### Internal Logic
1. Define default values for address and contact information.
2. Create a default patient object.
3. Merge the default patient object with the provided overrides.
4. Carefully merge nested objects (address and contact) to preserve default values.
5. Return the merged patient object as PatientMPI.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/shared | Importing USState enum |
| ../../domain/address | Importing Address type |
| ../../domain/contact | Importing Contact type |
| ../../domain/patient | Importing GenderAtBirth type |
| ../normalize-patient | Importing normalizePatient function |
| ../shared | Importing PatientMPI type |

This test file ensures that the `normalizePatient` function correctly handles various scenarios for patient data normalization, focusing on email addresses, names, and addresses. It uses a helper function `makePatientMPI` to create test data efficiently.