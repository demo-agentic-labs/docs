---
title: "Overview"
---

## High-level description
This directory contains the core functionality for the Master Patient Index (MPI) system in the Metriport application. It includes modules for patient matching, data normalization, and API integration for patient lookup and management.

## What does it do?
The MPI system in this directory performs several key functions:

1. Patient Matching: It implements algorithms to determine if two patient records refer to the same individual. This includes comparing personal identifiers, contact details, and using similarity calculations like the Jaro-Winkler algorithm.

2. Data Normalization: It standardizes patient data by normalizing names, addresses, phone numbers, and email addresses to ensure consistent comparison and storage.

3. Patient Lookup: It provides functionality to search for patients based on demographic information, using the normalized data and matching algorithms.

4. API Integration: It includes an implementation of the MPI interface that uses the Metriport API to fetch and match patient data.

5. Data Conversion: It offers utility functions to convert between different patient data representations used in the system.

## Entry points
The main entry point for the MPI functionality is the `MPIMetriportAPI` class in `patient-mpi-metriport-api.ts`. This class implements the `MPI` interface defined in `mpi.ts` and provides the core functionality for finding matching patients using the Metriport API.

The `getPatientByDemo` function in `get-patient-by-demo.ts` is another important entry point, which retrieves a patient based on demographic information using the MPI techniques.

## Key Files

1. `match-patients.ts`: Implements the core patient matching logic, including similarity calculations and matching rules.

2. `normalize-patient.ts` and `normalize-address.ts`: Provide functions to standardize patient data and addresses.

3. `get-patient-by-demo.ts`: Implements the main patient lookup functionality based on demographic information.

4. `patient-mpi-metriport-api.ts`: Defines the `MPIMetriportAPI` class, which integrates the MPI functionality with the Metriport API.

5. `shared.ts`: Contains shared types and utility functions for patient data conversion.

## Dependencies
The MPI system relies on several external libraries and internal modules:

1. @metriport/shared: Provides utility functions for data manipulation.
2. @medplum/fhirtypes: Defines FHIR-compliant data types used in patient records.
3. jaroWinkler: Used for string similarity calculations in patient matching.
4. lodash: Utilized for various utility functions in data processing.

Internal dependencies include modules for patient data types, logging, and error handling.

## Configuration
The MPI system uses a few configurable parameters:

1. SIMILARITY_THRESHOLD: Set to 0.96, used in patient matching to determine if two records are similar enough to be considered a match.
2. API_URL: Used in the `MPIMetriportAPI` class to specify the Metriport API endpoint.

These configurations are typically set when initializing the MPI components and can be adjusted based on specific requirements or environmental needs.

In summary, this directory contains a comprehensive implementation of a Master Patient Index system, providing robust patient matching, data normalization, and API integration capabilities. The modular structure allows for easy maintenance and potential extension of the MPI functionality.