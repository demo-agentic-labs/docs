---
title: "patient-mpi-metriport-api.ts"
---

## High-level description
This code defines a class `MPIMetriportAPI` that implements the `MPI` (Master Patient Index) interface. It provides functionality to find matching patients based on given patient data by utilizing the Metriport API and applying various matching algorithms and rules.

## Code Structure
The `MPIMetriportAPI` class uses the `PatientLoaderMetriportAPI` to fetch patient data from the Metriport API. It then applies normalization, matching algorithms, and rules to find potential matching patients.

## Symbols

### MPIMetriportAPI
#### Description
A class that implements the MPI interface to find matching patients using the Metriport API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| apiUrl | string | The URL of the Metriport API |

#### Internal Logic
1. Initializes a `PatientLoaderMetriportAPI` with the provided API URL.
2. Defines a similarity threshold of 0.96 for patient matching.

### findMatchingPatient
#### Description
Finds a matching patient based on the provided patient data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patient | PatientData | The patient data to find matches for |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| matchingPatient | PatientMPI \| undefined | The matching patient, if found |

#### Internal Logic
1. Normalizes the input patient data.
2. Fetches similar patients from the Metriport API using `PatientLoaderMetriportAPI`.
3. Applies matching algorithms and rules using the `matchPatients` function.
4. Returns the first matching patient, if any.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| PatientLoaderMetriportAPI | Loads patient data from the Metriport API |
| matchPatients | Applies matching algorithms and rules to find matching patients |
| useFirstMatchingPatient | Selects the first matching patient from a list of matches |
| normalizePatient | Normalizes patient data for consistent comparison |
| patientToPatientMPI | Converts a Patient object to a PatientMPI object |

## Error Handling
The code throws an error if the normalized patient data is invalid.

This implementation provides a flexible and extensible way to find matching patients using the Metriport API, with the ability to customize matching algorithms and rules as needed.