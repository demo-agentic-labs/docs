---
title: "document-downloader-local.test.ts"
---

## High-level description
This file contains unit tests for the `DocumentDownloaderLocal` class, which is responsible for downloading and processing documents from CommonWell Health Alliance. The tests focus on the `parseXmlFile` method, which handles XML files and extracts embedded content.

## Code Structure
The test suite is organized into a single `describe` block for "document-downloader-local", with a nested `describe` block for the `parseXmlFile` method. Each test case within this block checks different scenarios for parsing XML files and handling various content types.

## Symbols

### `describe("document-downloader-local")`
#### Description
The main test suite for the DocumentDownloaderLocal class.

### `describe("parseXmlFile")`
#### Description
A nested test suite focusing on the parseXmlFile method of DocumentDownloaderLocal.

### `beforeEach`
#### Description
Sets up mocks and spies for AWS S3, S3Utils, and capture functions before each test.

### `afterEach`
#### Description
Resets all mocks after each test.

### `afterAll`
#### Description
Restores all mocks after all tests are complete.

### `it("uses the first nonXmlBody tag when more than one nonXmlBody")`
#### Description
Tests the behavior when an XML file contains multiple nonXmlBody tags.

### `it("uses the first text tag when more than one under nonXmlBody")`
#### Description
Tests the behavior when an XML file contains multiple text tags under a nonXmlBody tag.

### `it("returns original file when gets empty nonXmlBody")`
#### Description
Tests the behavior when an XML file contains an empty nonXmlBody tag.

### `it("parses b64 encoded txt and returns txt content type")`
#### Description
Tests parsing and uploading of base64 encoded text content.

### `it("parses b64 encoded tiff and returns tiff content type")`
#### Description
Tests parsing and uploading of base64 encoded TIFF content.

### `it("parses b64 encoded pdf and returns pdf content type")`
#### Description
Tests parsing and uploading of base64 encoded PDF content.

### `it("parses b64 encoded png and returns png content type")`
#### Description
Tests parsing and uploading of base64 encoded PNG content.

### `it("parses b64 encoded jpeg and returns jpeg content type")`
#### Description
Tests parsing and uploading of base64 encoded JPEG content.

### `it("parses b64 encoded octet and returns octet content type")`
#### Description
Tests parsing and uploading of base64 encoded octet-stream content.

## Dependencies
- @faker-js/faker
- @metriport/commonwell-sdk
- aws-sdk
- Various utility functions and constants from the project

## Error Handling
The tests use Jest's expect assertions to verify the behavior of the `parseXmlFile` method in different scenarios, including error cases.

## Performance Considerations
These are unit tests, so performance is not a primary concern. However, the tests mock external dependencies to ensure fast execution.