---
title: "Overview"
---

## High-level description
This directory contains the implementation of a FHIR (Fast Healthcare Interoperability Resources) API client and related utilities for the Metriport medical data integration platform. It provides functionality for interacting with FHIR servers, processing FHIR resources, and handling various aspects of FHIR data management, including custom extensions, resource references, and data consolidation.

## What does it do?
The code in this directory enables the Metriport platform to:

1. Interact with HAPI FHIR servers, including standard FHIR operations and administrative functions.
2. Retrieve and consolidate patient data from FHIR servers, handling pagination, resource hydration, and error scenarios.
3. Process FHIR DocumentReference resources, including creation, retrieval, and filtering.
4. Map between Metriport's internal patient representation and FHIR patient resources.
5. Handle custom FHIR extensions specific to Metriport's needs.
6. Provide utilities for working with FHIR bundles, references, and various resource types.
7. Implement optimized methods for fetching and processing large amounts of FHIR data.

These functionalities allow Metriport to seamlessly integrate with FHIR-compliant systems, process medical data from various sources, and maintain data integrity and traceability throughout the platform.

## Entry points
The main entry points for this FHIR implementation are:

1. `api/api-factory.ts`: Provides factory functions for creating FHIR API client instances.
2. `consolidated/consolidated.ts`: Contains the `getConsolidatedFhirBundle` function for retrieving and consolidating patient data.
3. `document/get-documents.ts`: Offers the `getDocuments` function for retrieving FHIR DocumentReference resources.
4. `patient/index.ts`: Provides functions for mapping between Metriport and FHIR patient data.
5. `shared/index.ts`: Exports a wide range of utility functions for FHIR data processing.

## Key Files

1. `api/api-hapi.ts`: Implements the HAPI FHIR client classes for standard and administrative operations.
2. `consolidated/consolidated.ts`: Contains the core functionality for retrieving and consolidating FHIR resources.
3. `document/document-reference.ts` and `document/get-documents.ts`: Handle FHIR DocumentReference resources.
4. `patient/index.ts` and `patient/resource-filter.ts`: Manage patient data mapping and resource filtering.
5. `shared/bundle.ts`: Provides utilities for working with FHIR bundles.
6. `shared/references.ts`: Implements optimized methods for fetching FHIR resources based on references.
7. `shared/extensions/`: Contains definitions and utilities for custom FHIR extensions.

## Dependencies
The main external dependencies for this FHIR implementation include:

1. `@medplum/core` and `@medplum/fhirtypes`: Provide core FHIR functionalities and type definitions.
2. `@metriport/shared`: Contains shared utilities and types specific to Metriport.
3. `lodash`: Used for various utility functions.
4. `dayjs`: Handles date manipulation and formatting.
5. `uuid`: Generates unique identifiers.
6. `@faker-js/faker`: Used in tests for generating mock data.

## Configuration
Key configuration elements include:

1. `FHIR_SERVER_URL`: The base URL of the FHIR server, typically set as an environment variable.
2. `DEFAULT_TENANT`: A constant set to "DEFAULT", used as the default tenant ID for admin operations.
3. `BASE_EXTENSION_URL`: The base URL for Metriport FHIR extensions.
4. Performance optimizations in `references.ts`:
   - `MAX_IDS_PER_REQUEST`: Maximum number of IDs to include in a single FHIR request.
   - `queriesInParallel`: Number of parallel queries to execute when fetching resources.

These configuration options allow the FHIR implementation to be flexible and work with different FHIR server setups, while also optimizing performance for large-scale data processing.

In conclusion, this directory provides a comprehensive set of tools and utilities for working with FHIR data within the Metriport platform. It enables efficient interaction with FHIR servers, robust data processing, and seamless integration of medical data from various sources, while maintaining data integrity and traceability.