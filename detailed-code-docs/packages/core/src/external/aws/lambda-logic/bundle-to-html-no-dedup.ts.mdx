---
title: "bundle-to-html-no-dedup.ts"
---

## High-level description
This code defines a function `bundleToHtml` that converts a FHIR Bundle into an HTML representation of a medical record summary. It extracts various types of medical information from the bundle, organizes it into sections, and generates a structured HTML document with tables for each type of medical data.

## Code Structure
The main function `bundleToHtml` orchestrates the process of converting the FHIR Bundle to HTML. It calls several helper functions to extract and format different types of medical information (e.g., medications, conditions, allergies) into HTML sections. These sections are then combined into a complete HTML document.

## Symbols

### `bundleToHtml`
#### Description
The main function that converts a FHIR Bundle to an HTML representation of a medical record summary.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| fhirBundle | Bundle | The FHIR Bundle containing medical data |
| brief | Brief (optional) | An optional AI-generated brief summary |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| htmlPage | string | The generated HTML page as a string |

#### Internal Logic
1. Extracts various types of medical data from the FHIR Bundle.
2. Generates HTML sections for each type of medical data.
3. Combines all sections into a complete HTML document with styling and structure.

### Helper Functions
The code includes numerous helper functions for creating specific sections of the HTML document, such as:
- `createMRHeader`
- `createBrief`
- `createAWESection`
- `createMedicationSection`
- `createDiagnosticReportsSection`
- `createConditionSection`
- `createAllergySection`
- `createProcedureSection`
- `createObservationSocialHistorySection`
- `createObservationVitalsSection`
- `createObservationLaboratorySection`
- `createOtherObservationsSection`
- `createImmunizationSection`
- `createFamilyHistorySection`
- `createRelatedPersonSection`
- `createTaskSection`
- `createCoverageSection`
- `createEncountersSection`

Each of these functions processes a specific type of medical data and generates an HTML table or section for it.

## Dependencies
The code relies on several external libraries and types:
- Various FHIR types from "@medplum/fhirtypes"
- dayjs for date manipulation
- lodash for utility functions

## Error Handling
The code includes basic error handling, such as checking for the presence of a patient in the bundle and throwing an error if not found.

## Performance Considerations
The code processes potentially large amounts of medical data, so performance could be a concern for very large bundles. The code uses sorting and filtering operations which could be optimized if needed.

## TODOs
There are several TODO comments in the code, indicating areas for potential improvement or features to be added:
- Using a version from another file for `extractFhirTypesFromBundle`
- Implementing FHIR deduplication algorithm
- Implementing a filter for including inputs within a certain time frame
- Implementing pre-filter using a RAG model

This code provides a comprehensive way to convert FHIR data into a human-readable HTML format, suitable for displaying a patient's medical record summary.