---
title: "Overview"
---

## High-level description
This directory contains code for processing inbound Cross-Community Access (XCA) requests in the context of a Carequality IHE (Integrating the Healthcare Enterprise) Gateway. It specifically handles Document Query (DQ) and Document Retrieval (DR) requests, which correspond to ITI-38 and ITI-39 transactions respectively. The code is responsible for parsing XML requests, extracting relevant information, validating the structure, and creating standardized objects for further processing within the system.

## What does it do?
The code in this directory performs the following main functions:

1. Parses incoming XML requests for Document Query (DQ) and Document Retrieval (DR) operations.
2. Extracts important information from these requests, such as patient data, document references, and SAML attributes.
3. Validates the structure of the incoming requests against predefined schemas to ensure they conform to the expected format.
4. Transforms the parsed and validated data into standardized objects that can be easily processed by other parts of the system.
5. Stores the processed requests for monitoring and auditing purposes.
6. Handles errors that may occur during the processing of these requests, logging them appropriately.

This process allows the IHE Gateway to receive and interpret requests from external systems in a standardized way, facilitating interoperability in healthcare information exchange.

## Key Files

### dq-request.ts
This file handles the processing of inbound Document Query (DQ) requests. Its main function, `processInboundDqRequest`, takes an XML string as input, parses it, extracts relevant information (including patient data and SAML attributes), and returns a structured object representing the inbound request.

### dr-request.ts
This file is responsible for processing inbound Document Retrieval (DR) requests. The main function `processInboundDrRequest` parses the XML request, extracts document references and other metadata, and returns a standardized object representing the inbound DR request.

### schema.ts
This file defines Zod schemas for validating the structure of ITI-38 (Cross Gateway Query) and ITI-39 (Cross Gateway Retrieve) requests. It also exports TypeScript types inferred from these schemas, which are used throughout the other files to ensure type safety and consistency.

## Dependencies
The code in this directory relies on several external libraries and internal modules:

1. @metriport/ihe-gateway-sdk: Provides types and utilities specific to IHE Gateway operations.
2. @metriport/shared: Offers utility functions for error handling, array manipulation, etc.
3. fast-xml-parser: Used for parsing XML into JavaScript objects.
4. zod: Employed for schema definition and validation.

Internal dependencies include various utility modules for logging, URN manipulation, and request storage.

## Configuration
While there are no explicit configuration files mentioned, the code does interact with other parts of the system for logging and request storage. These interactions might be configurable in other parts of the application.

The schemas defined in `schema.ts` act as a form of configuration, specifying the expected structure of incoming requests. Any changes to the expected request format would need to be reflected in these schemas.

In summary, this directory contains crucial code for handling inbound XCA requests in a Carequality IHE Gateway, ensuring that these requests are properly parsed, validated, and transformed into a format that can be easily processed by the rest of the system. This plays a vital role in enabling interoperable health information exchange across different healthcare communities.