---
title: "saml-full-signing.test.ts"
---

## High-level description
This file contains unit tests for SAML (Security Assertion Markup Language) envelope signing and verification in the context of healthcare interoperability protocols. It tests the creation, signing, and verification of SOAP envelopes for three different IHE (Integrating the Healthcare Enterprise) transactions: XCPD (Cross-Community Patient Discovery), ITI-38 (Cross Gateway Query), and ITI-39 (Cross Gateway Retrieve).

## Code Structure
The test suite consists of three test cases, each following a similar pattern: creating a SOAP envelope, signing it with a timestamp, verifying the signature, then signing the entire envelope, and verifying again.

## Symbols

### `describe("Full Saml Envelope Signing", () =&gt; { ... })`
#### Description
This is the main test suite that groups all the tests related to SAML envelope signing.

### `it("should sign and verify the XCPD SOAP envelope successfully", () =&gt; { ... })`
#### Description
This test case verifies the signing and verification process for an XCPD (Cross-Community Patient Discovery) SOAP envelope.

#### Internal Logic
1. Creates an ITI-55 SOAP envelope using test data.
2. Signs the envelope with a timestamp.
3. Verifies the signed envelope.
4. Signs the entire envelope.
5. Verifies the fully signed envelope.

### `it("should sign and verify the ITI38 envelope successfully", () =&gt; { ... })`
#### Description
This test case verifies the signing and verification process for an ITI-38 (Cross Gateway Query) SOAP envelope.

#### Internal Logic
Similar to the XCPD test case, but uses ITI-38 specific envelope creation and test data.

### `it("should sign and verify the ITI39 envelope successfully", () =&gt; { ... })`
#### Description
This test case verifies the signing and verification process for an ITI-39 (Cross Gateway Retrieve) SOAP envelope.

#### Internal Logic
Similar to the XCPD and ITI-38 test cases, but uses ITI-39 specific envelope creation and test data.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| createITI5SoapEnvelope | Creates SOAP envelope for XCPD (ITI-55) transaction |
| createITI38SoapEnvelope | Creates SOAP envelope for ITI-38 transaction |
| createITI39SoapEnvelope | Creates SOAP envelope for ITI-39 transaction |
| verifySaml | Verifies SAML signatures |
| signTimestamp | Signs the timestamp in the SOAP envelope |
| signEnvelope | Signs the entire SOAP envelope |
| TEST_CERT, TEST_KEY | Test certificate and private key for signing and verification |
| outboundXcpdRequest, outboundDqRequest, outboundDrRequest | Test data for different transaction types |

## Error Handling
The tests use Jest's `expect` function to assert that the verification process returns `true`. If any of these assertions fail, the test will fail, indicating an issue with the signing or verification process.