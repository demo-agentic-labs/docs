---
title: "Overview"
---

## High-level description
This directory contains the implementation of the Carequality IHE Gateway V2, which facilitates secure healthcare information exchange using standardized protocols. It includes modules for handling inbound and outbound requests, patient discovery, document query and retrieval, SAML-based security, and monitoring of IHE transactions.

## What does it do?
The Carequality IHE Gateway V2 implementation provides the following key functionalities:

1. Patient Discovery (XCPD): Allows searching for patient information across different healthcare communities.
2. Document Query (XCA ITI-38): Enables querying for available medical documents for a specific patient.
3. Document Retrieval (XCA ITI-39): Facilitates the retrieval of specific medical documents.
4. SAML-based Security: Implements secure communication using SAML assertions and digital signatures.
5. Inbound Request Handling: Processes incoming requests for patient discovery, document query, and document retrieval.
6. Outbound Request Handling: Creates and sends outbound requests to other healthcare communities.
7. Monitoring and Logging: Stores and monitors IHE transactions for auditing and debugging purposes.

The gateway ensures interoperability between different healthcare systems by adhering to IHE (Integrating the Healthcare Enterprise) standards and Carequality implementation guidelines.

## Entry points
The main entry points for this implementation are:

1. `ihe-gateway-v2.ts`: Defines the abstract `IHEGatewayV2` class, which serves as the interface for IHE Gateway V2 operations.
2. `ihe-gateway-v2-async.ts`: Implements the `IHEGatewayV2Async` class, extending `IHEGatewayV2` to provide asynchronous processing capabilities.
3. `ihe-gateway-v2-logic.ts`: Contains the core logic for sending and processing patient discovery, document query, and document retrieval requests.

The data flow typically follows this pattern:
1. Inbound requests are received and processed by the respective handlers in the `inbound` directory.
2. Outbound requests are created and sent using the functionality in the `outbound` directory.
3. SAML-based security is applied using the modules in the `saml` directory.
4. Monitoring and logging of transactions are handled by the `monitor` directory.

## Key Files
1. `constants.ts`: Defines constants used throughout the implementation, including XML namespaces.
2. `gateways.ts`: Contains functions for handling gateway-specific behaviors and configurations.
3. `patient.ts`: Provides functionality for converting patient data between different formats.
4. `schema.ts`: Defines Zod schemas for validating various data structures used in the implementation.
5. `shared.ts`: Contains shared utilities and configurations used across the implementation.
6. `utils.ts`: Provides utility functions for timestamp handling and text extraction.

## Dependencies
The implementation relies on several external libraries and internal modules:

1. @metriport/ihe-gateway-sdk: Provides types, schemas, and constants for IHE Gateway operations.
2. @metriport/shared: Offers utility functions used across the codebase.
3. aws-sdk: Used for interacting with AWS services, particularly Lambda and S3.
4. axios: Used for making HTTP requests.
5. dayjs: Used for date and time manipulation.
6. fast-xml-parser: Employed for XML parsing and building.
7. zod: Used for schema definition and validation.
8. xml-crypto: Used for XML digital signature creation, manipulation, and verification.

## Configuration
The implementation uses various configuration options and environment variables, including:

1. AWS configurations for S3 and Lambda.
2. SAML certificates and keys for secure communication.
3. Gateway-specific configurations for different healthcare communities.
4. XML namespaces and constants for IHE standards.

These configurations allow for flexibility in deploying the gateway in different environments and connecting to various healthcare communities.

In conclusion, the Carequality IHE Gateway V2 implementation provides a comprehensive solution for secure and standardized healthcare information exchange. It handles complex operations such as patient discovery, document query and retrieval, and ensures secure communication using SAML-based authentication. The modular structure of the codebase allows for easy maintenance and extensibility to support future healthcare interoperability requirements.