---
title: "Overview"
---

## High-level description
This directory contains code for processing outbound Cross-Community Patient Discovery (XCPD) requests and responses in the context of an IHE (Integrating the Healthcare Enterprise) gateway implementation. It provides functionality for handling various aspects of the XCPD process, including error handling, schema validation, and response processing.

## What does it do?
The code in this directory performs several key functions in the XCPD process:

1. Error Handling: It defines functions to handle different types of errors that may occur during the XCPD process, such as HTTP errors, patient-related errors, and schema validation errors. These functions create standardized error responses.

2. Schema Validation: It defines Zod schemas for validating and parsing patient registry profile data and ITI-55 responses. These schemas ensure the integrity and type safety of the data being processed.

3. XCPD Response Processing: It includes functionality to process XCPD responses, converting XML responses into structured data, handling patient matching, and creating standardized response objects for patient discovery operations.

These components work together to facilitate the outbound XCPD process, ensuring that patient discovery requests are properly handled, responses are correctly parsed and validated, and any errors are appropriately managed and reported.

## Key Files

1. `error.ts`: This file contains functions for handling various types of errors that may occur during the XCPD process. It includes:
   - `handleHttpErrorResponse`: Creates standardized error responses for HTTP errors.
   - `handlePatientErrorResponse`: Handles patient-related errors.
   - `handleSchemaErrorResponse`: Manages schema validation errors.
   - `isRetryable`: Determines if a response should be retried (currently always returns false).

2. `schema.ts`: This file defines Zod schemas for validating and parsing patient registry profile data and ITI-55 responses. Key components include:
   - `patientRegistryProfileSchema`: Defines the structure for a patient registry profile.
   - `iti55ResponseSchema`: Defines the structure for the entire ITI-55 response.

3. `xcpd-response.ts`: This file contains the main logic for processing XCPD responses. Key functions include:
   - `processXCPDResponse`: Orchestrates the processing of XCPD responses, handling both successful and error cases.
   - `handlePatientMatchResponse`: Processes successful patient match responses.
   - `handlePatientNoMatchResponse`: Handles cases where no patient match is found.

## Dependencies
The code in this directory relies on several external libraries and internal modules:

1. `@metriport/ihe-gateway-sdk`: Provides types and schemas for IHE gateway operations.
2. `zod`: Used for creating and composing schemas for data validation and parsing.
3. `fast-xml-parser`: Used for XML parsing in XCPD response processing.
4. `@metriport/shared`: Provides utility functions used across the codebase.

## Configuration
There are no explicit configuration files or environment variables mentioned in the provided summaries. However, the code likely relies on configurations set at a higher level in the project structure, particularly for aspects like gateway information and request handling.

The code makes use of various schemas and types defined in other parts of the project, indicating a reliance on the overall project structure and shared definitions.

In summary, this directory contains crucial components for handling the outbound XCPD process in an IHE gateway implementation. It provides robust error handling, strict data validation, and comprehensive response processing, ensuring reliable and type-safe patient discovery operations.