---
title: "file-searcher-direct.ts"
---

## High-level description
This code defines an `OpenSearchFileSearcherDirect` class that implements the `OpenSearchFileSearcher` interface. It provides functionality to search for files in an OpenSearch index using direct authentication. The class uses the OpenSearch client to perform searches based on given criteria and returns the results in a structured format.

## Code Structure
The main class `OpenSearchFileSearcherDirect` implements the `OpenSearchFileSearcher` interface. It has a constructor that takes a configuration object and a `search` method that performs the actual search operation. The class also includes a private `mapResult` method to transform the OpenSearch response into the desired output format.

## References
This code references the following external symbols:
- `Client` from "@opensearch-project/opensearch"
- `contentFieldName` from the local index file
- Various types and interfaces from "./file-searcher"

## Symbols

### OpenSearchFileSearcherDirectConfig
#### Description
An interface that extends `OpenSearchFileSearcherConfig` with additional properties for direct authentication.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| endpoint | string | The OpenSearch endpoint URL |
| username | string | The username for authentication |
| password | string | The password for authentication |

### OpenSearchFileSearcherDirect
#### Description
A class that implements the `OpenSearchFileSearcher` interface for direct OpenSearch querying.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| config | OpenSearchFileSearcherDirectConfig | Configuration object for the searcher |

### search
#### Description
Performs a search operation on the OpenSearch index using the provided search request.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req | SearchRequest | The search request containing cxId, patientId, and query |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| results | SearchResult[] | An array of search results |

#### Internal Logic
1. Extracts configuration and request parameters
2. Creates an OpenSearch client with the provided authentication
3. Constructs a query payload using the search parameters
4. Executes the search request using the OpenSearch client
5. Logs the search process and response
6. Maps the response to the desired output format using `mapResult`

### mapResult (private)
#### Description
Transforms the OpenSearch response into an array of `SearchResult` objects.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| input | OpenSearchResponse | The response from OpenSearch |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| results | SearchResult[] | An array of mapped search results |

#### Internal Logic
1. Checks if the input has hits and hit data
2. Maps each hit to a `SearchResult` object, extracting relevant fields

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @opensearch-project/opensearch | Provides the OpenSearch client for querying |

## Error Handling
The code does not implement explicit error handling. Errors from the OpenSearch client or during the search process will propagate up the call stack.

## Logging
The code uses `console.log` for basic logging of the search process and response.