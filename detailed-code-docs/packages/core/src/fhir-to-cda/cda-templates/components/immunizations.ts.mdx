---
title: "immunizations.ts"
---

## High-level description
This code defines a function `buildImmunizations` that transforms FHIR Immunization resources into a CDA (Clinical Document Architecture) Immunizations Section. It processes immunization data from a FHIR Bundle, creates table rows and entries for each immunization, and structures the information according to CDA specifications.

## Code Structure
The main function `buildImmunizations` uses helper functions to process the FHIR data and create CDA-compliant structures. It relies on utility functions from other modules for data transformation and formatting. The `AugmentedImmunization` class is used to enhance the FHIR Immunization resource with additional context.

## Symbols

### `buildImmunizations`
#### Description
This function takes a FHIR Bundle as input and returns a CDA-compliant Immunizations Section.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| fhirBundle | Bundle | A FHIR Bundle containing immunization and related resources |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| immunizationsSection | ImmunizationsSection | A CDA-compliant Immunizations Section |

#### Internal Logic
1. Extracts Immunization resources from the FHIR Bundle
2. Creates AugmentedImmunization objects for each Immunization
3. Generates table rows and entries for each immunization
4. Constructs the CDA Immunizations Section with the generated data

### `createAugmentedImmunizations`
#### Description
Creates AugmentedImmunization objects from FHIR Immunization resources, including location information if available.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| immunizations | Immunization[] | Array of FHIR Immunization resources |
| fhirBundle | Bundle | The FHIR Bundle containing all resources |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| augmentedImmunizations | AugmentedImmunization[] | Array of AugmentedImmunization objects |

### `createTableRowFromImmunization`
#### Description
Generates a table row for a single immunization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| immunization | AugmentedImmunization | An AugmentedImmunization object |
| referenceId | string | A unique identifier for the table row |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| tableRow | ObservationTableRow[] | An array containing a single table row for the immunization |

### `createEntryFromImmunization`
#### Description
Creates a CDA-compliant entry for a single immunization.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| immunization | AugmentedImmunization | An AugmentedImmunization object |
| referenceId | string | A unique identifier for the entry |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| entry | SubstanceAdministationEntry | A CDA-compliant entry for the immunization |

## Dependencies
The code relies on several external libraries and modules:
| Dependency | Purpose |
|:-----------|:--------|
| @medplum/fhirtypes | Provides TypeScript types for FHIR resources |
| ../../../external/fhir/shared | Utility functions for working with FHIR resources |
| ../../cda-types/sections | Types for CDA sections |
| ../../cda-types/shared-types | Shared types for CDA structures |
| ../commons | Utility functions for CDA generation |
| ../constants | Constant values used in CDA generation |
| ../create-table-rows-and-entries | Helper function for creating table rows and entries |
| ../table | Function for initiating section tables |
| ./augmented-resources | Definition of AugmentedImmunization class |

## Error Handling
The code does not implement explicit error handling. It relies on optional chaining and default values to handle potential undefined or null values.

This code is part of a larger system for converting FHIR resources to CDA format, specifically focusing on the Immunizations section of a clinical document.