---
title: "social-history.ts"
---

## High-level description
This code defines a function `buildSocialHistory` that transforms FHIR Bundle data into a CDA (Clinical Document Architecture) Social History Section. It processes social history observations from the FHIR Bundle and creates a structured CDA representation, including a table with the social history information.

## Code Structure
The main function `buildSocialHistory` uses helper functions and types from imported modules to process the FHIR data and construct the CDA structure. It filters social history observations, creates table rows and entries, and assembles the final CDA Social History Section.

## Symbols

### `buildSocialHistory`
#### Description
This function takes a FHIR Bundle as input and returns a CDA Social History Section. It processes social history observations from the bundle and constructs the CDA representation.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| fhirBundle | Bundle | A FHIR Bundle containing patient data |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| socialHistorySection | SocialHistorySection | A CDA Social History Section |

#### Internal Logic
1. Initialize the `socialHistorySection` with template ID, code, and title.
2. Filter social history observations from the FHIR Bundle.
3. If no social history observations are found, return the empty section.
4. Create augmented observations for each social history observation.
5. Generate table rows and entries using `createTableRowsAndEntries`.
6. Construct the CDA table structure with headers and rows.
7. Add the table and entries to the `socialHistorySection`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @medplum/fhirtypes | Provides TypeScript types for FHIR resources |
| dayjs | Date manipulation library |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| sectionName | string | "socialhistory" | Name used for section identifiers |
| tableHeaders | string[] | ["Question / Observation", "Answer / Status", "Score", "Date Recorded"] | Headers for the social history table |

## TODOs
- Potentially need to create separate text tables for different questionnaires (commented in the code)

This code is part of a larger system for converting FHIR data to CDA format, focusing specifically on the Social History section of a clinical document.