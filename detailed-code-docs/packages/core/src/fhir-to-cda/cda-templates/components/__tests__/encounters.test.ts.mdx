---
title: "encounters.test.ts"
---

## High-level description
This file contains unit tests for the `buildEncounters` function, which is responsible for mapping FHIR Encounter resources to CDA (Clinical Document Architecture) XML format. The tests verify the correct mapping of single and multiple encounters, including scenarios with multiple practitioners.

## Code Structure
The file is structured as a Jest test suite, with setup functions (`beforeAll` and `beforeEach`) and test cases. It uses faker for generating random data, and imports various helper functions and example data from other files.

## Symbols

### `beforeAll`
#### Description
This function sets up the initial test data, including creating an encounter, practitioner, and location with unique IDs.

#### Internal Logic
1. Generates unique IDs for encounter, practitioner, and location.
2. Creates an encounter object using the `makeEncounter` function.
3. Creates a practitioner object using the `makePractitioner` function.
4. Creates a location object using the `makeLocation` function.

### `beforeEach`
#### Description
This function resets the test bundle before each test case.

#### Internal Logic
1. Creates an empty bundle using the `createEmptyBundle` function.
2. Adds the encounter, practitioner, and location resources to the bundle.

### `describe.skip("buildEncounters")`
#### Description
This is the main test suite for the `buildEncounters` function. It contains three test cases, but the suite is currently skipped.

#### Internal Logic
1. Test case 1: Verifies correct mapping of a single Encounter.
2. Test case 2: Checks mapping of a single Encounter with two practitioners.
3. Test case 3: Ensures correct mapping of two Encounters.

Each test case follows this general structure:
1. Arrange: Set up the test data and expected output.
2. Act: Call the `buildEncounters` function with the test bundle.
3. Assert: Compare the generated XML with the expected XML content.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @faker-js/faker | Generating random test data |
| @medplum/fhirtypes | TypeScript types for FHIR resources |
| lodash | Utility functions |
| path | Handling file paths |
| xmlBuilder | Converting JSON to XML |

## Error Handling
The code doesn't implement specific error handling mechanisms. It relies on Jest's assertion functions to catch and report any discrepancies between expected and actual results.

## Performance Considerations
The tests use `removeEmptyFields` function to clean up the generated JSON before converting it to XML. This may have performance implications for large datasets.

## TODOs
The entire test suite is currently skipped (`describe.skip`), indicating that these tests are not being run. This might be intentional if the `buildEncounters` function is still under development or if there are known issues that need to be addressed before enabling the tests.