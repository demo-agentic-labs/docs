---
title: "encompassing-enc.test.ts"
---

## High-level description
This file contains unit tests for the `buildEncompassingEncounter` function, which is responsible for creating the Encompassing Encounter section of a CDA (Clinical Document Architecture) document from a FHIR (Fast Healthcare Interoperability Resources) Bundle. The tests are currently skipped and focus on verifying the correct mapping of FHIR Encounter data to CDA XML format.

## Code Structure
The file sets up test data using faker and custom helper functions to create FHIR resources. It then defines a test suite for the `buildEncompassingEncounter` function, which is currently skipped.

## Symbols

### `beforeAll` function
#### Description
Sets up the test data by creating FHIR resources (Encounter, Practitioner, Location, and Composition) with specific IDs and properties.

#### Internal Logic
1. Generates UUIDs for Encounter, Practitioner, and Location.
2. Creates an Encounter resource with specific properties.
3. Creates Practitioner and Location resources.
4. Creates a Composition resource.

### `beforeEach` function
#### Description
Prepares a FHIR Bundle before each test by adding the created resources to it.

#### Internal Logic
1. Creates an empty Bundle.
2. Adds Composition, Encounter, Practitioner, and Location resources to the Bundle.

### `describe.skip` block
#### Description
Contains a skipped test case for the `buildEncompassingEncounter` function.

#### Internal Logic
1. Reads an XML template file.
2. Calls `buildEncompassingEncounter` with the prepared Bundle.
3. Cleans the result and converts it to XML.
4. Compares the generated XML with the expected XML content.

## Dependencies
- @faker-js/faker: For generating random test data.
- @medplum/fhirtypes: For FHIR resource type definitions.
- lodash: For utility functions.
- path: For file path operations.
- Various imported functions from local modules for CDA generation and testing utilities.

## Notes
- The test is currently skipped (`describe.skip`), indicating that it's not being run as part of the test suite.
- The test focuses on comparing the generated XML with a pre-defined XML template, ensuring the correct mapping of FHIR data to CDA format.
- The use of faker allows for generating realistic test data consistently across test runs.