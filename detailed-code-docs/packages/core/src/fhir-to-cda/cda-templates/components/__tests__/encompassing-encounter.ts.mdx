---
title: "encompassing-encounter.ts"
---

## High-level description
This file contains unit tests for the `buildEncounters` function, which is responsible for mapping FHIR Encounter resources to CDA (Clinical Document Architecture) XML format. The tests verify the correct mapping of single and multiple encounters, including scenarios with multiple practitioners.

## Code Structure
The file is structured as a Jest test suite, with setup functions (`beforeAll` and `beforeEach`) and multiple test cases. It imports necessary dependencies, mock data, and utility functions from other files.

## Symbols

### `beforeAll`
#### Description
Sets up the initial test data, including IDs and resources for an encounter, practitioner, and location.

#### Internal Logic
1. Generates UUIDs for encounter, practitioner, and location.
2. Creates mock Encounter, Practitioner, and Location resources using utility functions.

### `beforeEach`
#### Description
Resets the test bundle before each test case.

#### Internal Logic
Creates an empty bundle and adds the encounter, practitioner, and location resources to it.

### `describe("buildEncounters")`
#### Description
Groups test cases for the `buildEncounters` function.

#### Test Cases

1. "correctly maps a single Encounter"
   - Arranges: Prepares test data and expected XML output.
   - Acts: Calls `buildEncounters` with the test bundle.
   - Asserts: Compares the generated XML with the expected XML.

2. "correctly maps a single Encounter with two practitioners"
   - Arranges: Adds a second practitioner to the encounter and bundle.
   - Acts: Calls `buildEncounters` with the modified bundle.
   - Asserts: Checks for the presence of both practitioners in the generated XML.

3. "correctly maps two Encounters"
   - Arranges: Adds a second encounter, practitioner, and location to the bundle.
   - Acts: Calls `buildEncounters` with the modified bundle.
   - Asserts: Compares the generated XML with the expected XML containing two encounters.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @faker-js/faker | Generating mock data |
| @medplum/fhirtypes | TypeScript types for FHIR resources |
| lodash | Utility functions |
| path | File path operations |
| xmlBuilder | XML generation |

## Error Handling
The tests don't explicitly handle errors but rely on Jest's assertion mechanisms to catch any unexpected behavior or mismatches between generated and expected XML.

## Performance Considerations
These tests are not performance-critical, but they do involve XML parsing and generation, which could be resource-intensive for large datasets.