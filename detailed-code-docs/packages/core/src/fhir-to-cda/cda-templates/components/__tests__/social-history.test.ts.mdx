---
title: "social-history.test.ts"
---

## High-level description
This file contains unit tests for the `buildSocialHistory` function, which is responsible for constructing the social history section of a CDA (Clinical Document Architecture) document from FHIR (Fast Healthcare Interoperability Resources) data. The tests verify that the function correctly processes social history observations and generates the expected XML output.

## Code Structure
The test file imports necessary dependencies and defines setup functions (`beforeAll` and `beforeEach`) to create test data. It then contains a `describe` block with two test cases, both of which are currently skipped (`describe.skip`).

## Symbols

### `beforeAll`
#### Description
This function sets up the test environment by creating a mock observation with a unique ID and social history data.

#### Internal Logic
1. Generates a unique ID using `faker.string.uuid()`.
2. Creates a mock observation using `makeObservation` function with the generated ID and predefined social history data.

### `beforeEach`
#### Description
This function resets the test bundle before each test case.

#### Internal Logic
1. Creates an empty bundle using `createEmptyBundle()`.
2. Adds the previously created observation to the bundle.

### `describe.skip("buildSocialHistory")`
#### Description
This is a skipped test suite for the `buildSocialHistory` function.

#### Internal Logic
Contains two test cases:
1. Verifies that non-social-history observations are not included in the output.
2. Checks if a single social-history survey observation is correctly mapped to the expected XML output.

### Test: "does not pick up non-social-history Observations"
#### Description
This test ensures that the `buildSocialHistory` function only processes social history observations and ignores others.

#### Internal Logic
1. Creates a non-social-history observation.
2. Adds both social history and non-social-history observations to the bundle.
3. Calls `buildSocialHistory` with the bundle.
4. Verifies that the resulting XML contains the social history observation ID but not the non-social-history observation ID.

### Test: "correctly maps a single social-history survey Observation"
#### Description
This test verifies that a single social history observation is correctly transformed into the expected XML format.

#### Internal Logic
1. Loads an expected XML template from a file.
2. Calls `buildSocialHistory` with the bundle containing a single social history observation.
3. Compares the generated XML with the expected XML template.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @faker-js/faker | Generating mock data |
| @medplum/fhirtypes | FHIR type definitions |
| path | Handling file paths |
| lodash | Utility functions |

## TODOs
The test suite is currently skipped (`describe.skip`), indicating that these tests are not being run. This might be due to ongoing development or refactoring. The tests should be enabled once the `buildSocialHistory` function is ready for testing.