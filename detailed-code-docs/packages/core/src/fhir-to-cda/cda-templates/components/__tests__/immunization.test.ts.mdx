---
title: "immunization.test.ts"
---

## High-level description
This file contains unit tests for the `buildImmunizations` function, which is responsible for converting FHIR Immunization resources to CDA (Clinical Document Architecture) format. The tests focus on verifying the correct mapping of a single Immunization resource to its CDA representation.

## Code Structure
The test file imports necessary dependencies, sets up test data, and defines a single test case within a skipped describe block. The test case creates a bundle with an immunization and location resource, then compares the output of `buildImmunizations` with an expected XML template.

## Symbols

### `beforeEach`
#### Description
This function sets up the test environment before each test case runs. It initializes test data including immunization and location resources.

#### Internal Logic
1. Generates unique IDs for immunization and location
2. Creates an immunization object using `makeImmunization`
3. Creates a location object using `makeLocation`
4. Initializes an empty FHIR bundle

### `describe.skip("buildImmunizations", ...)`
#### Description
This is a skipped test suite for the `buildImmunizations` function. It contains a single test case that verifies the correct mapping of a single Immunization resource.

#### Internal Logic
1. Adds immunization and location resources to the bundle
2. Loads an XML template from a file
3. Calls `buildImmunizations` with the bundle
4. Removes empty fields from the result
5. Converts the result to XML
6. Compares the generated XML with the expected XML template

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @faker-js/faker | Generating fake data for testing |
| @medplum/fhirtypes | TypeScript types for FHIR resources |
| lodash | Utility functions |
| path | Handling file paths |
| xmlBuilder | Converting JSON to XML |

## TODOs
The test suite is currently skipped (`describe.skip`), indicating that it may need to be updated or fixed before being re-enabled.

## Notes
1. The test file uses helper functions like `makeImmunization`, `makeLocation`, and `createEmptyBundle`, which are likely defined in other test utility files.
2. The test compares the generated XML with a pre-defined XML template, which allows for precise verification of the output structure.
3. The use of `faker` for generating UUIDs suggests that the tests are designed to be repeatable with different random data each time they run.