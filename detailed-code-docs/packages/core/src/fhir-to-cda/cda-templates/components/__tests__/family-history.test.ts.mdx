---
title: "family-history.test.ts"
---

## High-level description
This file contains unit tests for the `buildFamilyHistory` function, which is responsible for converting FHIR FamilyMemberHistory resources into CDA (Clinical Document Architecture) XML format. The tests verify the correct mapping of family history data with various scenarios, including single and multiple family members, with and without conditions.

## Code Structure
The test file imports necessary dependencies and defines helper functions and variables. It then uses Jest's testing framework to describe and run tests for different scenarios of family history data conversion.

## Symbols

### `beforeAll()`
#### Description
This function is called once before all tests run. It initializes common variables used across multiple tests.

#### Internal Logic
- Generates a UUID for `memberHistId`
- Creates a `FamilyMemberHistory` object using `makeFamilyMemberHistory`
- Creates two `FamilyMemberHistoryCondition` objects using `makeCondition`

### `beforeEach()`
#### Description
This function is called before each test. It resets the `bundle` variable to an empty Bundle.

#### Internal Logic
- Creates an empty FHIR Bundle using `createEmptyBundle()`

### `describe.skip("buildMedications", () =&gt; {...})`
#### Description
This is the main test suite for the `buildFamilyHistory` function. It contains multiple test cases for different scenarios.

#### Internal Logic
The test suite is currently skipped (`describe.skip`), which means these tests won't run unless the skip is removed.

### Test: "correctly maps a single FamilyMemberHistory without Conditions"
#### Description
This test verifies that a single FamilyMemberHistory resource without any conditions is correctly mapped to CDA format.

#### Internal Logic
1. Adds a FamilyMemberHistory resource to the bundle
2. Loads expected XML content from a file
3. Calls `buildFamilyHistory` with the bundle
4. Compares the generated XML with the expected XML

### Test: "correctly maps a single FamilyMemberHistory with two Conditions"
#### Description
This test verifies that a single FamilyMemberHistory resource with two conditions is correctly mapped to CDA format.

#### Internal Logic
Similar to the previous test, but includes two conditions in the FamilyMemberHistory resource.

### Test: "correctly maps two FamilyMemberHistories"
#### Description
This test verifies that two FamilyMemberHistory resources, each with a condition, are correctly mapped to CDA format.

#### Internal Logic
1. Adds two FamilyMemberHistory resources to the bundle, each with a condition
2. Loads expected XML content from a file
3. Calls `buildFamilyHistory` with the bundle
4. Compares the generated XML with the expected XML

## Dependencies
- @faker-js/faker: For generating fake data
- @medplum/fhirtypes: For FHIR type definitions
- lodash: For utility functions
- path: For file path operations
- Various imported functions from local modules for CDA generation and testing utilities

## Notes
- The tests are currently skipped (`describe.skip`), which means they won't run unless the skip is removed.
- The tests use template files for expected XML output, allowing for easy comparison between generated and expected results.
- The use of `faker` ensures that tests can generate unique identifiers consistently across test runs.

This test file is crucial for ensuring the correct functionality of the FHIR to CDA conversion process for family history data, covering various scenarios and edge cases.