---
title: "medications.test.ts"
---

## High-level description
This file contains unit tests for the `buildMedications` function, which is responsible for converting FHIR medication data to CDA (Clinical Document Architecture) format. The tests ensure that the function correctly handles various scenarios, including error cases and different medication configurations.

## Code Structure
The test file is organized into a single `describe` block containing multiple test cases. It uses Jest as the testing framework and includes setup code in `beforeAll` and `beforeEach` blocks to prepare test data.

## Symbols

### `beforeAll`
#### Description
This function sets up common test data used across multiple test cases.

#### Internal Logic
1. Generates UUIDs for medication statement and medication.
2. Creates past dates in different formats.
3. Creates a medication statement and medication pair using the `makeMedicationStatementPair` function.

### `beforeEach`
#### Description
This function resets the test bundle before each test case.

#### Internal Logic
1. Creates an empty FHIR bundle.
2. Adds the medication statement to the bundle.

### `describe.skip("buildMedications")`
#### Description
This describe block contains test cases for the `buildMedications` function. The `.skip` indicates that these tests are currently skipped.

#### Internal Logic
Contains four test cases:
1. Checks if an error is thrown when the bundle is missing a Medication.
2. Checks if an error is thrown when MedicationStatement incorrectly references a Medication.
3. Verifies correct mapping of a single MedicationStatement with a related Medication.
4. Verifies correct mapping of two MedicationStatements with related Medications.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @faker-js/faker | Generates fake data for testing |
| @medplum/fhirtypes | Provides TypeScript types for FHIR resources |
| lodash | Utility functions, specifically for templating |
| path | Handling file paths |
| xmlBuilder | Building XML from JSON objects |

## Error Handling
The tests check for error throwing in specific scenarios, such as missing or incorrectly referenced Medications.

## Performance Considerations
The use of `_.template` for XML content comparison might have performance implications for large XML files.

## TODOs
The `describe` block is currently skipped (`.skip`), indicating that these tests are not being run. This might be intentional during development or due to pending changes.