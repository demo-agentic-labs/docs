---
title: "Overview"
---

## High-level description
This directory contains the core functionality of the Metriport healthcare interoperability system. It includes modules for patient data management, FHIR (Fast Healthcare Interoperability Resources) processing, integration with external healthcare networks, data conversion, and various utility functions. The code is designed to handle complex healthcare data operations, including patient matching, data deduplication, and conversion between different healthcare data formats.

## What does it do?
The core functionality in this directory performs several key tasks:

1. Patient Data Management: It provides interfaces and implementations for loading, updating, and managing patient information across different data sources.

2. FHIR Data Processing: It includes functionality for handling FHIR resources, including deduplication of FHIR bundles and conversion between FHIR and other formats like CDA (Clinical Document Architecture).

3. External Integrations: It implements integrations with various external services and healthcare networks, including AWS services, Carequality, CommonWell Health Alliance, and FHIR servers.

4. Master Patient Index (MPI): It implements a system for patient matching and lookup across different healthcare systems.

5. Data Conversion: It provides tools for converting between different healthcare data formats, particularly FHIR to CDA conversion.

6. Utility Functions: It includes a wide range of utility functions for tasks such as file handling, logging, error management, and database operations.

For example, when processing patient data, the system can:
1. Retrieve patient information from various sources.
2. Deduplicate and consolidate FHIR data.
3. Convert the data to different formats as needed.
4. Match patient records across different systems.
5. Store and manage the processed data securely.

## Entry points
The main entry points vary depending on the specific functionality, but some key entry points include:

1. For patient data operations: The `PatientLoader` and `PatientUpdater` interfaces in the `command` directory.
2. For FHIR deduplication: The `deduplicateFhir` function in the `fhir-deduplication` directory.
3. For FHIR to CDA conversion: The `convertFhirBundleToCda` function in the `fhir-to-cda` directory.
4. For MPI operations: The `MPIMetriportAPI` class in the `mpi` directory.
5. For external integrations: Various API client classes and factory functions in the `external` directory.

## Key Files
While each subdirectory has its own important files, some key files across the directory include:

1. `command/consolidated-connector-factory.ts`: Factory for creating consolidated data connectors.
2. `domain/patient.ts`: Defines the core Patient model and related utilities.
3. `external/fhir/api/api-factory.ts`: Provides factory functions for creating FHIR API client instances.
4. `fhir-deduplication/deduplicate-fhir.ts`: Contains the main FHIR deduplication logic.
5. `fhir-to-cda/fhir-to-cda.ts`: Orchestrates the FHIR to CDA conversion process.
6. `mpi/patient-mpi-metriport-api.ts`: Implements the MPI functionality using the Metriport API.
7. `util/concurrency.ts`: Provides utilities for managing asynchronous operations and concurrency.

## Dependencies
The code relies on various external libraries and services, including:

1. AWS SDK for AWS service interactions
2. @medplum/core and @medplum/fhirtypes for FHIR functionalities
3. axios for HTTP requests
4. dayjs for date manipulation
5. zod for schema validation
6. sequelize for database operations
7. Various internal Metriport packages (@metriport/shared, @metriport/commonwell-sdk, etc.)

## Configuration
The implementation uses various configuration options, typically managed through environment variables or a centralized configuration system. These include:

1. API endpoints and credentials for external services
2. AWS region settings and resource identifiers
3. FHIR server URLs
4. Database connection details
5. Logging and error reporting settings

In conclusion, this `core` directory provides a comprehensive set of functionalities for healthcare data interoperability within the Metriport system. It handles complex operations such as patient data management, FHIR processing, data conversion, and integration with various healthcare networks and services. The modular structure allows for easy maintenance and extension of functionalities as needed.