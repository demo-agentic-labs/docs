---
title: "consolidated-query.ts"
---

## High-level description
This code is a Node.js script that demonstrates the usage of the Metriport Medical API. It performs various operations such as querying patient data, starting consolidated queries, and checking query statuses using the MetriportMedicalApi client.

## Code Structure
The script imports necessary dependencies, sets up environment variables, and defines a main function that executes a series of API calls using the MetriportMedicalApi client. The operations are performed sequentially, with some including sleep intervals to simulate asynchronous processes.

## Symbols

### `main`
#### Description
The main function that orchestrates the API calls to the Metriport Medical API.

#### Internal Logic
1. Initializes the MetriportMedicalApi client with the provided API token and configuration.
2. Calls `getPatientConsolidated` (deprecated) to retrieve patient data.
3. Checks the consolidated query status using `getConsolidatedQueryStatus`.
4. Starts a new consolidated query using `startConsolidatedQuery`.
5. Checks the query status again.
6. Waits for 5 seconds using the `sleep` function.
7. Checks the query status one more time.
8. Counts patient consolidated data using `countPatientConsolidated`.

### `sleep`
#### Description
A utility function that creates a promise that resolves after a specified time, simulating a delay.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| timeInMs | number | The time to sleep in milliseconds |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise&lt;void&gt; | Promise&lt;void&gt; | A promise that resolves after the specified time |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| dotenv | Load environment variables from a .env file |
| @metriport/api-sdk | Metriport Medical API SDK |
| @metriport/core/util/env-var | Utility for handling environment variables |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| API_URL | string | N/A | The URL of the Metriport API |
| API_KEY | string | N/A | The API key for authentication |
| PATIENT_ID | string | N/A | The ID of the patient to query |

## Error Handling
The script does not implement explicit error handling. Errors from API calls will propagate up and potentially crash the script.

## Logging
The script uses `console.log` to output the results of various API calls and operations.

## TODOs
- The code includes a TODO comment to remove the deprecated `getPatientConsolidated` method (issue #870).

This script serves as a demonstration of how to use the Metriport Medical API to perform various operations related to patient data and consolidated queries. It showcases the initialization of the API client, making different types of requests, and handling the responses.