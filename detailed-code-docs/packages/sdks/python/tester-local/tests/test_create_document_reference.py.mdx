---
title: "test_create_document_reference.py"
---

## High-level description
This code is a test function for creating a DocumentReference in a medical records system using the Metriport API. It demonstrates how to construct a DocumentReference object with various nested components and send it to the API for creation.

## Symbols

### `test_create_document_reference()`
#### Description
This function tests the creation of a DocumentReference using the Metriport API. It constructs a DocumentReference object with various components and sends it to the API, then prints the response.

#### Internal Logic
1. Initialize the Metriport client with API key and base URL.
2. Create a Coding object for the document type.
3. Create a CodeableConcept object using the Coding.
4. Create a facility type CodeableConcept.
5. Construct a DocumentReferenceContext with a time period and facility type.
6. Create a DocumentReferenceContent with an empty Attachment.
7. Assemble the complete DocumentReference object.
8. Send the DocumentReference to the Metriport API for creation.
9. Print the API response.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| os | Accessing environment variables |
| dotenv | Loading environment variables from a .env file |
| generated.client | Metriport API client |
| generated.resources.fhir | FHIR resource type definitions |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| API_KEY | string | None | API key for Metriport authentication |
| PATIENT_ID | string | None | ID of the patient for whom the document is being created |
| FACILITY_ID | string | None | ID of the facility associated with the document |
| BASE_URL | string | None | Base URL for the Metriport API |

## Error Handling
This test function does not implement explicit error handling. Any exceptions raised during the API call will propagate up and cause the test to fail.

## Logging
The function prints the API response to the console using `print()`, which can be considered a basic form of logging for this test case.

## TODOs
- The `FACILITY_ID` environment variable is loaded but not used in the current implementation.
- The `Attachment` object in `DocumentReferenceContent` is created empty and could be populated with actual attachment data.
- Consider adding assertions to verify the API response and ensure the test passes or fails based on expected outcomes.