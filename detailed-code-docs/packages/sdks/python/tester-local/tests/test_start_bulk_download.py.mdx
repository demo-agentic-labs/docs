---
title: "test_start_bulk_download.py"
---

## High-level description
This code is a test script for the `start_bulk_get_document_url` function of the Metriport API. It sets up the necessary environment variables, initializes the Metriport client, and tests the bulk document URL retrieval functionality for a specific patient.

## Symbols

### `test_start_doc_query`
#### Description
This function serves as a test case for the `start_bulk_get_document_url` method of the Metriport API. It initializes the Metriport client with the provided API key and base URL, then calls the method with a patient ID and metadata to start a bulk document URL retrieval process.

#### Inputs
This function doesn't take any inputs directly, but it uses environment variables loaded from a `.env` file.

#### Outputs
This function doesn't return any value, but it prints the response from the API call.

#### Internal Logic
1. Initialize the Metriport client using the `api_key` and `base_url` from environment variables.
2. Create a metadata dictionary with `docId` and `docType`.
3. Call the `start_bulk_get_document_url` method of the Metriport client's medical document resource, passing the `patient_id` and metadata.
4. Print the response from the API call.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| os | Used to access environment variables |
| dotenv | Used to load environment variables from a .env file |
| generated.client | Provides the Metriport client |
| generated.commons | Not directly used in this file, but imported |
| generated.resources.medical | Not directly used in this file, but imported |

## Configuration
The script uses environment variables for configuration:
| Option | Type | Description |
|:-------|:-----|:------------|
| API_KEY | string | API key for authenticating with the Metriport API |
| PATIENT_ID | string | ID of the patient for which to retrieve document URLs |
| FACILITY_ID | string | ID of the facility (not used in the current code) |
| BASE_URL | string | Base URL for the Metriport API |

These environment variables are loaded from a `.env` file using the `load_dotenv()` function.

## Notes
1. The `FACILITY_ID` environment variable is loaded but not used in the current implementation.
2. The script imports `generated.commons` and `generated.resources.medical`, but they are not directly used in the code.
3. Error handling is not implemented in this test function. In a production environment, it would be advisable to add try-except blocks to handle potential exceptions.
4. The test function is not using any assertion statements, which are typically used in unit tests to verify the expected behavior. It's currently just printing the response, which makes it more of a manual test or example usage rather than an automated test.