---
title: "Overview"
---

## High-level description
The `packages/api/src` directory contains the core implementation of the Metriport Medical API (MAPI). It includes various components such as route handlers, data models, external integrations, error handling, event management, and utility functions. The API is designed to handle medical data, patient information, and integrations with various health information exchanges and external providers.

## What does it do?
The Metriport API serves several key functions:

1. Medical Data Management: It handles patient demographics, document references, facilities, and organizations. This includes data normalization, matching, and augmentation.

2. Health Information Exchange Integration: The API supports integration with HIEs like Carequality and CommonWell, managing facility associations and document conversion processes.

3. External Provider Integration: It includes modules for integrating with various health and fitness data providers such as Apple Health, Fitbit, Garmin, and others.

4. Webhook Handling: The API processes incoming webhooks from various health data providers and manages outgoing webhook requests to customers.

5. Authentication and Authorization: It implements both API key-based and OAuth-based authentication for different routes.

6. Data Conversion and Mapping: The API includes functionality to convert between different healthcare data formats, particularly FHIR and CDA.

7. Database Operations: It defines models and utilities for database operations, supporting both SQL (using Sequelize) and NoSQL (using DynamoDB) databases.

8. Error Handling and Logging: The API implements comprehensive error handling and logging mechanisms, including integration with Sentry for error tracking.

9. Event Management: It includes an event system for handling various operations asynchronously.

## Entry points
The main entry point for the API is the `app.ts` file, which sets up the Express application, configures middleware, mounts routes, and initializes various components. Other key entry points include:

1. `routes/index.ts`: Sets up the main router for webhook endpoints.
2. `command/index.ts`: Contains command handlers for various API operations.
3. `models/db.ts`: Initializes database connections.
4. `external/index.ts`: Provides access to external integrations.

## Key Files
1. `app.ts`: The main application file that sets up the Express server.
2. `sentry.ts`: Initializes and configures Sentry for error tracking.
3. `models/db.ts`: Manages database connections and model initialization.
4. `routes/index.ts`: Defines API routes and webhook handlers.
5. `command/index.ts`: Contains command handlers for various API operations.
6. `external/index.ts`: Manages integrations with external services and APIs.
7. `shared/config.ts`: Centralizes configuration management.
8. `providers/index.ts`: Implements provider-specific logic for data retrieval and authentication.

## Dependencies
The API relies on several key dependencies:

1. Express.js: Web application framework
2. Sequelize: ORM for database operations
3. AWS SDK: For interacting with AWS services
4. @sentry/node: Error tracking and monitoring
5. axios: HTTP client for making API requests
6. dayjs: Date manipulation library
7. zod: Schema validation library
8. Various internal packages like @metriport/core and @metriport/shared

## Configuration
The API uses a centralized configuration management approach through the `Config` class in `shared/config.ts`. Key configuration areas include:

1. Database credentials and connection settings
2. AWS service configurations
3. API endpoints and authentication tokens
4. Feature flags and environment-specific settings
5. Sentry DSN and error tracking configurations
6. Provider-specific API credentials and endpoints

The configuration is typically loaded from environment variables, allowing for easy deployment across different environments.

In summary, the `packages/api/src` directory contains a comprehensive implementation of the Metriport Medical API, providing robust functionality for managing medical data, integrating with various health information systems, and processing health and fitness data from multiple providers. The API is designed with modularity, scalability, and security in mind, incorporating best practices for error handling, configuration management, and external integrations.