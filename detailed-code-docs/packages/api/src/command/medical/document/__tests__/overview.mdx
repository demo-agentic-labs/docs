---
title: "Overview"
---

## High-level description
This directory contains unit tests for the document query functionality in a medical API. The tests cover various aspects of document querying, including request ID generation, conversion progress calculation and updating, and webhook processing for document query progress.

## What does it do?
The tests in this directory ensure the correct behavior of several key functions related to document querying in a medical context:

1. Generation and management of request IDs for document queries.
2. Calculation and updating of document conversion progress.
3. Processing of webhook events related to document query progress.

These tests simulate different scenarios and edge cases to verify that the functions handle various situations correctly, such as:

- Generating new request IDs or reusing existing ones based on the current query progress.
- Updating conversion progress in the database and calculating the overall status of a document query.
- Handling different statuses (processing, completed, failed) for document download and conversion processes.
- Triggering appropriate actions based on the progress status, such as sending webhooks or processing patient document requests.

## Key Files

1. `document-query.test.ts`:
   - Tests the `getOrGenerateRequestId` function, which determines whether to create a new request ID or reuse an existing one for document queries.
   - Includes a placeholder test for the `queryDocumentsAcrossHIEs` function.

2. `document-query_calculateAndUpdateDocQuery.test.ts`:
   - Tests the `updateConversionProgress` function, which updates the conversion progress of documents for a patient in the database.
   - Tests the `calculateConversionProgress` function, which determines the status and progress of document conversion based on various input parameters.

3. `process-doc-query-webhook.test.ts`:
   - Tests the `processDocQueryProgressWebhook` function, which handles webhook events related to document query progress and triggers further actions based on the progress status.

## Dependencies
The tests rely on several external libraries and internal modules:

- Jest: Used as the testing framework for writing and running unit tests.
- @metriport/core: Provides utility functions and domain models used in the tests.
- Sequelize: An ORM used for database interactions, which is mocked in the tests to simulate database operations.

Internal dependencies include various models, helper functions, and domain-specific modules from the larger application structure.

## Configuration
The tests use Jest's configuration for mocking and spying on functions. They also utilize custom helper functions and mock data to set up test scenarios. Some key configurations include:

- Mocking of database transactions and model operations to isolate tests from actual database interactions.
- Creation of mock patient objects and document query progress data for testing different scenarios.
- Use of Jest's `beforeEach` hooks to set up mocks and spies before each test case.

These tests play a crucial role in ensuring the reliability and correctness of the document query functionality in the medical API, covering various aspects from request ID management to progress tracking and webhook processing.