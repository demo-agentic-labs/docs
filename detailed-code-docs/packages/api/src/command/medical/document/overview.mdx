---
title: "Overview"
---

## High-level description
This directory contains code related to medical document handling, including querying, downloading, converting, and processing documents. It provides functionality for interacting with Health Information Exchanges (HIEs), managing document references, and handling webhooks for document-related events.

## What does it do?
The code in this directory performs several key functions:

1. Document Querying: It initiates and manages document queries across multiple HIEs (like Commonwell and Carequality) for patients.

2. Document Download and Conversion: It handles the downloading of medical documents and their conversion to different formats (e.g., XML to HTML or PDF).

3. Progress Tracking: It tracks and updates the progress of document queries, downloads, and conversions.

4. Webhook Management: It processes and sends webhooks to notify clients about the status of document-related operations.

5. Bulk URL Generation: It provides functionality to generate pre-signed download URLs for multiple documents associated with a patient.

6. Document Reconversion: It allows for the re-conversion of previously downloaded documents, updating their format or content.

7. Local Document Querying: It includes a local implementation for document querying, useful for testing and development purposes.

## Entry points
The main entry points for this module are:

1. `queryDocumentsAcrossHIEs` in `document-query.ts`: Initiates document queries across multiple HIEs.

2. `processDocQueryProgressWebhook` in `process-doc-query-webhook.ts`: Handles the processing of document query progress webhooks.

3. `startBulkGetDocumentUrls` in `start-bulk-get-doc-url.ts`: Initiates the process of generating pre-signed download URLs for multiple documents.

4. `reConvertDocuments` in `document-reconvert.ts`: Starts the process of re-converting documents for a given customer or patient.

5. `TriggerAndQueryDocRefsLocal` class in `trigger-and-query-local.ts`: Provides a local implementation for triggering and querying document references.

## Key Files

1. `document-query.ts`: Contains the core logic for initiating and managing document queries across HIEs.

2. `document-download.ts`: Handles the downloading of medical documents and their conversion to different formats.

3. `document-webhook.ts`: Manages the sending of webhooks related to document operations.

4. `process-doc-query-webhook.ts`: Processes incoming webhooks related to document query progress.

5. `document-reconvert.ts`: Provides functionality for re-converting previously downloaded documents.

6. `document-status.ts`: Contains utility functions for checking the status of document processing operations.

7. `check-doc-queries.ts`: Implements logic for checking and potentially fixing the status of document queries.

## Dependencies
The module relies on several external libraries and internal modules:

- `@metriport/core`: Provides core utilities, domain models, and shared functions.
- `@medplum/fhirtypes`: Offers FHIR-related type definitions.
- `@metriport/commonwell-sdk`: Used for interacting with the Commonwell HIE.
- AWS SDK: Used for interacting with AWS services like S3 and Lambda.
- `dayjs`: Used for date and time manipulation.
- `lodash`: Provides utility functions for data manipulation.
- `uuidv7`: Used for generating unique identifiers.

Internal dependencies include various models, helper functions, and domain-specific modules from the larger application structure.

## Configuration
The module uses configuration settings from `Config` object, which likely includes:

- AWS region and S3 bucket names for document storage.
- Lambda function names for document conversion.
- Webhook URLs and settings.
- Environment-specific configurations (e.g., sandbox mode).

The `tsconfig.json` file in this directory extends the base TypeScript configuration and sets specific options for this module, such as strict type checking and exclusion of test files from compilation.

This module plays a crucial role in managing medical documents within the larger system, providing comprehensive functionality for document retrieval, processing, and status management across various health information exchanges.