---
title: "Overview"
---

## High-level description
This directory contains test files for various functions related to patient data management in a medical API. The tests cover functionalities such as appending document query progress, checking AI brief enablement, creating consolidated patient data, retrieving consolidated patient data, handling consolidated webhooks, storing query commands, initializing query storage, and validating patient data.

## What does it do?
The tests in this directory ensure the correct functioning of various patient-related operations:

1. Updating and aggregating document query progress for patients.
2. Determining if AI brief generation should be enabled for a customer.
3. Converting FHIR resource bundles into transaction bundles and uploading them to S3.
4. Retrieving and processing consolidated patient data.
5. Extracting file URLs from consolidated medical record webhooks.
6. Storing and initializing patient query data in the database.
7. Validating patient data, particularly address information.

These tests help maintain the reliability and correctness of the patient data management system by verifying that each component behaves as expected under various scenarios.

## Key Files
1. `append-doc-query-progress.test.ts`: Tests the functionality of updating a patient's document query progress in the database.

2. `check-ai-brief.test.ts`: Verifies the logic for determining if the AI Brief feature should be enabled for a given customer.

3. `consolidated-create.test.ts`: Tests the process of converting FHIR resource bundles into transaction bundles and uploading them to S3.

4. `consolidated-get.test.ts`: Contains tests for retrieving and processing consolidated patient data, including filtering and comparing resources.

5. `get-consolidated-webhook.test.ts`: Tests the extraction of file URLs from consolidated medical record webhook responses.

6. `store-query-cmd.ts`: Provides test data and helper functions for testing the storage of patient query data.

7. `store-query-init.test.ts`: Tests the initialization and storage of patient query data in the database.

8. `validate.test.ts`: Contains tests for validating patient data, focusing on address validation.

## Dependencies
The test files rely on various external libraries and internal modules:

1. Jest: Used as the testing framework for all test files.
2. @faker-js/faker: Generates fake data for testing purposes.
3. @medplum/fhirtypes: Provides FHIR data types and interfaces.
4. @metriport/core: Contains utility functions and domain-specific logic.
5. @metriport/api-sdk: Provides types for consolidation and query-related operations.
6. uuid: Used for generating unique identifiers in tests.

Internal dependencies include various models and utility functions from the `@metriport` namespace, such as `PatientModel`, `WebhookRequest`, and FHIR-related utilities.

## Configuration
The test files don't directly use configuration files, but they may indirectly rely on configurations set up for the testing environment. This could include database connections, feature flags, and other environment-specific settings.

In summary, this directory contains a comprehensive set of unit tests that ensure the correct functioning of patient-related operations in the medical API. These tests cover various aspects of patient data management, from query progress tracking to data validation, helping maintain the reliability and correctness of the system.