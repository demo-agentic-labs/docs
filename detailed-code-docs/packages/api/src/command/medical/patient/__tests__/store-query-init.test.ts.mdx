---
title: "store-query-init.test.ts"
---

## High-level description
The `store-query-init.test.ts` file contains unit tests for the `storeQueryInit` function, which is responsible for storing the initial parameters of a document or consolidated query in the patient's data within the database. The tests ensure that the function correctly updates the patient's data with the query parameters without affecting other existing data.

## Code Structure
The code defines a test suite using `describe` blocks for "documentQuery" and "consolidatedQueries" scenarios. Each scenario tests the `storeQueryInit` function with different input parameters and verifies the expected behavior using Jest assertions. The code also utilizes mocking to isolate the unit under test and control its dependencies.

## References
- `PatientModel`: Represents the patient data model.
- `storeQueryInit`: The function being tested, responsible for storing query parameters in the patient's data.
- `dqParams`, `cqParams`: Test data representing document and consolidated query parameters.
- `mockedPatientAllProgresses`: Mock data representing a patient with existing query progress.

## Symbols

### `storeQueryInit`
#### Description
This test suite verifies the behavior of the `storeQueryInit` function. It ensures that the function correctly updates the patient's data with the provided query parameters without affecting other existing data.

#### Internal Logic
The test suite uses Jest to define test cases for different scenarios:

- **documentQuery**:
    - **"has dqParams in patient when running storeQueryInit"**: This test case verifies that when `storeQueryInit` is called with `dqParams`, the patient's data is updated to include the `dqParams`.
    - **"does not clear other patient data when running storeQueryInit with dqParams"**: This test case ensures that when `storeQueryInit` is called with `dqParams`, existing data in the patient's `consolidatedQueries` field is not cleared.
- **consolidatedQueries**:
    - **"has cqParams in patient when running storeQueryInit"**: This test case verifies that when `storeQueryInit` is called with `cqParams`, the patient's data is updated to include the `cqParams`.
    - **"does not clear other patient data when running storeQueryInit with cq with cqParams"**: This test case ensures that when `storeQueryInit` is called with `cqParams`, existing data in the patient's `documentQueryProgress` field is not cleared.

Each test case follows the arrange, act, and assert pattern:

- **Arrange**: Sets up the test environment by creating mock data and spying on relevant functions.
- **Act**: Calls the `storeQueryInit` function with specific input parameters.
- **Assert**: Verifies the expected behavior by checking if the patient's data is updated correctly and if existing data is preserved.
