---
title: "Overview"
---

Here's a summary of the `packages/api/src/command/medical/patient` directory:

## High-level description
This directory contains modules for managing patient data in a medical API. It includes functions for creating, updating, retrieving, and deleting patient records, as well as handling patient-related operations such as data consolidation, document queries, and interactions with Health Information Exchanges (HIEs).

## What does it do?
The code in this directory provides functionality to:

1. Create, update, and delete patient records
2. Retrieve patient information and match patients based on demographic data
3. Manage patient facility matches and coverage assessments
4. Handle data contributions and consolidate patient data
5. Convert FHIR bundles to CDA format and vice versa
6. Manage document queries and consolidated data requests
7. Interact with external systems like Commonwell and Carequality
8. Handle webhooks for patient-related events
9. Manage medical record summaries and patient discovery across HIEs

## Entry points
The main entry points for this directory are:

1. `create-patient.ts`: Creates new patient records
2. `update-patient.ts`: Updates existing patient records
3. `delete-patient.ts`: Deletes patient records
4. `get-patient.ts`: Retrieves patient information and matches patients
5. `consolidated-get.ts`: Retrieves consolidated patient data
6. `handle-data-contributions.ts`: Processes incoming FHIR bundles for patients
7. `query-init.ts`: Initializes document queries and consolidated queries

## Key Files
1. `create-patient.ts`: Handles patient creation and initial patient discovery
2. `update-patient.ts`: Manages patient information updates and triggers patient discovery
3. `delete-patient.ts`: Handles patient deletion from the system and external sources
4. `get-patient.ts`: Provides functions for retrieving and matching patient data
5. `consolidated-get.ts`: Manages retrieval of consolidated patient data
6. `handle-data-contributions.ts`: Processes incoming FHIR data for patients
7. `convert-fhir-bundle.ts`: Converts FHIR bundles to medical record formats
8. `convert-fhir-to-cda.ts`: Converts FHIR bundles to CDA documents
9. `webhook.ts`: Manages webhook settings for patient-related events

## Dependencies
The code in this directory relies on several external libraries and internal modules:

1. `@medplum/fhirtypes`: Provides FHIR data types and interfaces
2. `@metriport/core`: Contains core domain logic and utilities
3. `@metriport/shared`: Provides shared types and utilities
4. `@metriport/commonwell-sdk`: Interfaces with Commonwell
5. `@metriport/carequality-sdk`: Interfaces with Carequality
6. `sequelize`: ORM for database interactions
7. `dayjs`: Date manipulation library
8. `lodash`: Utility library for various operations

Internal dependencies include various models, utilities, and external integrations specific to the Metriport application.

## Configuration
The code uses configuration options from the `Config` class, including:

1. AWS region and S3 bucket names
2. FHIR server configurations
3. Sandbox environment settings
4. Lambda function names for FHIR to medical record conversion

## Error Handling
The code implements error handling using try-catch blocks and custom error classes. It uses the `capture.error` function to log and report errors for monitoring and debugging purposes.

## Logging
The code utilizes a custom logging utility (`out` function) to log information about various operations, including patient creation, updates, data retrieval, and error conditions.

In summary, this directory contains a comprehensive set of functions and utilities for managing patient data in a medical API, including interactions with external systems, data consolidation, and document management. It provides a robust foundation for patient-centric operations within the larger medical data management system.