---
title: "index.ts"
---

## High-level description
This code defines the routing structure for an Express.js application. It sets up various routes for different functionalities such as activity tracking, biometrics, medical data, and user management. The code also implements middleware for authentication, error reporting, and device usage tracking.

## Code Structure
The main function exported by this module takes an Express Application object and sets up routes using the `app.use()` method. It organizes routes into different categories based on their authentication requirements and functionality.

## Symbols

### Default Export Function
#### Description
This is the main function that sets up all the routes for the Express application.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| app | Application | The Express application instance |

#### Internal Logic
1. Sets up internal routes (webhook and internal)
2. Sets up routes with API key authentication
3. Sets up medical routes with API key authentication
4. Sets up routes with API key authentication validated on the API Gateway
5. Sets up routes with session token authentication
6. Sets up routes with OAuth-based authentication

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| express | Web application framework |
| Various route modules | Handling specific route functionalities |
| Middleware functions | Authentication and usage reporting |

## References
This code references several other modules and middleware functions:
- Route handlers (activity, biometrics, body, connect, etc.)
- Middleware functions (checkMAPIAccess, processCxId, reportDeviceUsage)
- Error reporting (reportClientErrors)

## Configuration
The code defines a constant `dash` for supporting requests from the Dashboard:
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| dash | string | "/dash-oss" | Prefix for Dashboard routes |

## API/Interface Reference
This code sets up the following main API endpoints:
| Endpoint | Method | Description |
|:---------|:-------|:------------|
| /webhook | Various | Webhook routes (internal only) |
| /internal | Various | Internal routes |
| /settings | Various | Settings routes |
| /activity | Various | Activity tracking routes |
| /body | Various | Body measurement routes |
| /biometrics | Various | Biometrics routes |
| /nutrition | Various | Nutrition routes |
| /sleep | Various | Sleep tracking routes |
| /user | Various | User management routes |
| /medical/v1 | Various | Medical data routes |
| /fhir/R4 | Various | FHIR R4 proxy routes |
| /feedback | Various | Feedback routes |
| /connect | Various | Connection routes |
| /oauth | Various | OAuth routes |

Note: The specific HTTP methods and request/response formats are not detailed in this file and would be defined in the individual route handler modules.