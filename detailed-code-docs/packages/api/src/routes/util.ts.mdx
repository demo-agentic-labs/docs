---
title: "util.ts"
---

## High-level description
This file contains utility functions and middleware for handling HTTP requests in an Express.js application. It includes functions for parsing query parameters, handling asynchronous operations, and managing customer IDs and user IDs.

## Code Structure
The main symbols in this code are utility functions that are used across different routes in the API. These functions are designed to extract and validate data from HTTP requests, handle errors, and provide consistent response formats.

## Symbols

### `asyncHandler`
#### Description
A higher-order function that wraps asynchronous route handlers to catch and forward errors to the Express error handling middleware.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| f | Function | The asynchronous route handler function to be wrapped |
| logErrorDetails | boolean | Whether to log detailed error information |

#### Internal Logic
- Executes the provided function and catches any errors
- Logs errors based on the `logErrorDetails` flag
- Passes errors to the next middleware

### `httpResponseBody`
#### Description
Creates a standardized HTTP response body object.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| status | number | HTTP status code |
| title | string | Title of the response |
| detail | string (optional) | Additional details |
| name | string (optional) | Name of the error |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| HttpResponseBody | Object | Standardized response body |

### `getFromQuery`, `getFromQueryOrFail`, `getFromQueryAsArray`, `getFromQueryAsArrayOrFail`, `getFromQueryAsBoolean`, `getFromQueryAsBooleanOrFail`
#### Description
Functions to extract and parse query parameters from the request.

### `getFromParams`, `getFromParamsOrFail`
#### Description
Functions to extract and parse path parameters from the request.

### `getFromHeader`, `getFromHeaderOrFail`
#### Description
Functions to extract and parse headers from the request.

### `getCxId`, `getCxIdOrFail`, `getCxIdFromQuery`, `getCxIdFromQueryOrFail`, `getCxIdFromHeaders`
#### Description
Functions to extract and validate customer IDs from various parts of the request.

## Dependencies
- @metriport/core/util/log
- @metriport/shared
- express
- http-status
- ../errors/bad-request
- ../shared/config
- ../shared/notifications

## Error Handling
The code includes various error handling mechanisms, including throwing `BadRequestError` for invalid inputs and using the `asyncHandler` to catch and forward errors to the Express error handling middleware.

## Logging
The code uses a logging utility from `@metriport/core/util/log` for error logging.

## TODOs
- Remove or update deprecated functions (e.g., `getDate`, `getDateOrFail`)
- Consider refactoring to reduce code duplication in similar functions (e.g., the various `getFromQuery*` functions)

This utility file provides a set of functions that are likely used across multiple route handlers in the API to standardize request parsing, error handling, and response formatting.