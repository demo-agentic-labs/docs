---
title: "internal-organization.ts"
---

## High-level description
This code defines an Express router for handling internal organization-related operations. It includes a PUT endpoint to create or update an organization, register it with Health Information Exchanges (HIEs), and handle the synchronization with Carequality and CommonWell networks.

## Code Structure
The main router is defined using Express, with a single PUT endpoint. The endpoint uses middleware for request logging and error handling. It processes the incoming request, performs organization creation or update operations, and handles HIE synchronization based on the organization's status and configuration.

## Symbols

### router.put("/", ...)
#### Description
This endpoint handles the creation or update of an organization and its registration with HIEs.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req.query.cxId | string | Customer ID |
| req.body | object | Organization details |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| res | Response | HTTP response with updated organization data |

#### Internal Logic
1. Extracts customer ID and organization details from the request
2. Creates or updates the organization in the database
3. Checks if HIE synchronization is required
4. If approved, synchronizes with Carequality and CommonWell networks
5. Returns the updated organization data

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| express | Web framework for handling HTTP requests |
| http-status | HTTP status codes |
| @metriport/core | Core domain models and utilities |
| zod | Schema validation |

## Error Handling
The code uses the `asyncHandler` wrapper to catch and forward any errors to Express error handling middleware.

## Logging
The code uses a `requestLogger` middleware for logging incoming requests.

## API/Interface Reference
| Endpoint | Method | Request | Response | Description |
|:---------|:-------|:--------|:---------|:------------|
| / | PUT | Organization details in body, cxId in query | Updated organization | Creates or updates an organization and registers it with HIEs if new |

Your response should not exceed 3000 words or 4000 tokens. Focus on providing clear, concise information that can be directly inferred from the code. Include optional sections only when they provide significant value for understanding the code.