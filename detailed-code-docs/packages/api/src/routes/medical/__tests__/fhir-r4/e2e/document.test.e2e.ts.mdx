---
title: "document.test.e2e.ts"
---

## High-level description
This file contains end-to-end (e2e) tests for FHIR R4 document-related operations, including Binary and DocumentReference resources. It tests the creation, retrieval, and deletion of these resources using a REST API.

## Code Structure
The code is structured as a series of Jest test cases, organized into describe blocks for different resource types and operations. It uses helper functions from external modules to create test data and a shared API client for making HTTP requests.

## References
- `@metriport/core/external/fhir/__tests__/binary`
- `@metriport/core/external/fhir/document/__tests__/document-reference`
- `@metriport/core/external/fhir/__tests__/patient`
- `../../../../../__tests__/e2e/shared`

## Symbols

### `beforeAll`
#### Description
Sets up the test environment by creating a Patient resource.

#### Internal Logic
Makes a PUT request to create a Patient resource using the API.

### `afterAll`
#### Description
Cleans up the test environment by deleting the created Patient resource.

#### Internal Logic
Makes a DELETE request to remove the Patient resource using the API.

### `describe("Integration FHIR Document")`
#### Description
Groups all the test cases related to FHIR document operations.

### `test("Binary upload")`
#### Description
Tests the creation of a Binary resource.

#### Internal Logic
1. Makes a PUT request to create a Binary resource.
2. Validates the response status and data.

### `test("Binary download")`
#### Description
Tests the retrieval of a Binary resource.

#### Internal Logic
1. Makes a GET request to retrieve the Binary resource.
2. Validates the response status and data.

### `describe("Document Reference")`
#### Description
Groups test cases related to DocumentReference operations.

### `test("create document")`
#### Description
Tests the creation of a DocumentReference resource.

#### Internal Logic
1. Makes a PUT request to create a DocumentReference resource.
2. Validates the response status and data.

### `test("get document")`
#### Description
Tests the retrieval of a DocumentReference resource.

#### Internal Logic
1. Makes a GET request to retrieve the DocumentReference resource.
2. Validates the response status and data.

### `describe("delete")`
#### Description
Groups test cases related to deleting DocumentReference resources.

### `test("delete document")`
#### Description
Tests the deletion of a DocumentReference resource.

#### Internal Logic
1. Makes a DELETE request to remove the DocumentReference resource.
2. Validates the delete response.

### `test("sequential delete document")`
#### Description
Tests the deletion of an already deleted DocumentReference resource.

#### Internal Logic
1. Makes a DELETE request to remove an already deleted DocumentReference resource.
2. Validates the delete response for an already deleted resource.

### `describe("Binary delete")`
#### Description
Groups test cases related to deleting Binary resources.

### `test("delete binary")`
#### Description
Tests the deletion of a Binary resource.

#### Internal Logic
1. Makes a DELETE request to remove the Binary resource.
2. Validates the delete response.

### `test("sequential delete binary")`
#### Description
Tests the deletion of an already deleted Binary resource.

#### Internal Logic
1. Makes a DELETE request to remove an already deleted Binary resource.
2. Validates the delete response for an already deleted resource.

### `validateBinary(body)`
#### Description
Validates the structure and content of a Binary resource response.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| body | any | The response body to validate |

#### Internal Logic
Checks if the response body has the correct resourceType and id.

### `validateDocument(body)`
#### Description
Validates the structure and content of a DocumentReference resource response.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| body | any | The response body to validate |

#### Internal Logic
Checks if the response body has the correct resourceType, id, and identifier.

### `validateDeleteResponse(res, expectedResponse)`
#### Description
Validates the response of a delete operation.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| res | AxiosResponse | The Axios response object |
| expectedResponse | string | The expected response code |

#### Internal Logic
Checks if the response has the correct status, resourceType, and issue details.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/core/external/fhir/__tests__/binary | Provides `makeBinary` function for creating test data |
| @metriport/core/external/fhir/document/__tests__/document-reference | Provides `makeDocumentReference` function for creating test data |
| @metriport/core/external/fhir/__tests__/patient | Provides `makePatient` function for creating test data |
| axios | Used for making HTTP requests |
| ../../../../../__tests__/e2e/shared | Provides shared utilities for e2e tests |

## Configuration
| Option | Type | Default | Description |
|:-------|:-----|:--------|:------------|
| jest.setTimeout | number | 15000 | Sets the timeout for Jest tests |

## Error Handling
The code relies on Jest's built-in assertion mechanisms for error handling. It uses `expect` statements to validate responses and throw errors if the assertions fail.