---
title: "Overview"
---

## High-level description
This directory contains a collection of route handlers and schemas for managing medical data in an API. It includes functionality for handling patients, organizations, facilities, documents, and Health Information Exchange (HIE) interactions. The code is primarily built using Express.js and integrates with various external systems and databases.

## What does it do?
The code in this directory provides a comprehensive set of API endpoints and supporting functions for:

1. Patient Management: Creating, updating, retrieving, and deleting patient records, as well as managing patient links across different HIEs.

2. Organization and Facility Management: Handling the creation, update, and retrieval of organization and facility data, including synchronization with HIE systems like Carequality and CommonWell.

3. Document Handling: Managing medical documents, including uploading, downloading, and querying document metadata.

4. HIE Integration: Facilitating patient discovery, document queries, and data consolidation across different Health Information Exchanges.

5. Data Validation and Transformation: Using Zod schemas to ensure data integrity and consistency across various operations.

6. Internal Operations: Providing endpoints for administrative tasks, debugging, and system maintenance.

## Entry points
The main entry point for this module is likely the `index.ts` file, which sets up the primary router for medical-related routes. This router incorporates sub-routers for specific areas such as facilities, organizations, patients, and documents.

Key files that serve as entry points for different functionalities include:

1. `patient.ts`: Handles patient-related operations.
2. `organization.ts`: Manages organization data.
3. `facility.ts`: Deals with facility-related operations.
4. `document.ts`: Handles document management.
5. `internal-*.ts` files: Provide endpoints for internal operations and administrative tasks.

The flow of control typically starts with an incoming HTTP request, which is routed to the appropriate handler based on the URL and HTTP method. These handlers then interact with various command functions, services, and data models to perform the requested operations.

## Key Files
1. `patient.ts`: Defines routes for patient CRUD operations, consolidated data retrieval, and patient matching.

2. `organization.ts`: Handles organization creation, updates, and retrieval.

3. `facility.ts`: Manages facility-related operations, including creation, updates, and deletion.

4. `document.ts`: Provides endpoints for document listing, querying, downloading, and uploading.

5. `internal-hie.ts`: Handles internal operations related to Health Information Exchanges.

6. `internal-patient.ts`: Offers additional patient-related operations for internal use.

7. `schemas/`: Contains Zod schemas for data validation and transformation across various entities.

## Dependencies
The code relies on several external libraries and internal modules:

1. Express.js: Web application framework for handling HTTP requests.
2. Zod: Schema validation library used extensively for input validation.
3. @metriport/core: Internal module providing domain models and utility functions.
4. @metriport/api-sdk: SDK for interacting with the Metriport API.
5. Various database and external service integrations (e.g., FHIR servers, S3 for document storage).

## Configuration
The code uses environment variables and configuration objects to manage different settings:

1. HIE-related configurations (e.g., Carequality and CommonWell settings).
2. Feature flags for controlling certain functionalities.
3. Database connection settings.
4. External service URLs and credentials.

These configurations are typically accessed through a centralized `Config` object or environment variables, allowing for easy management of different environments (development, staging, production).

The medical routes module provides a comprehensive API for managing medical data, integrating with Health Information Exchanges, and handling various aspects of patient care and record management. It emphasizes data validation, error handling, and modularity to ensure robust and maintainable code.