---
title: "fhir.ts"
---

Here's a high-level description of the target file:

This file defines schemas and utility functions for handling FHIR (Fast Healthcare Interoperability Resources) data in the context of a medical API. It includes definitions for bundle types, resource types, and query parameters, as well as functions for parsing and validating FHIR-related data.

## Code Structure

The main symbols in this code are:

1. `bundleSchema`: Defines the structure of a FHIR Bundle.
2. `getResourcesQueryParam`: A function to extract and parse resource types from a request query.

These symbols are related in that they both deal with FHIR data structures, but they serve different purposes in the API.

## Symbols

### `bundleSchema`
#### Description
Defines a Zod schema for validating FHIR Bundle objects.

#### Internal Logic
- Defines the structure of a Bundle, including its resourceType, type, and entry array.
- The entry array must contain objects with a resource property.

### `getResourcesQueryParam`
#### Description
Extracts and parses the 'resources' query parameter from an Express request.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| req | Request | Express request object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | ResourceTypeForConsolidation[] | Array of parsed resource types |

#### Internal Logic
1. Extracts the 'resources' query parameter.
2. Parses the parameter, removing quotes and splitting it into an array.
3. Filters out falsy values.
4. Validates the resulting array using the `resourceSchema`.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| express | For Request type definition |
| zod | For schema validation |
| @metriport/api-sdk | For ResourceTypeForConsolidation type |
| BadRequestError | For error handling |
| filterTruthy | Utility function for filtering arrays |
| getFrom | Utility function for extracting data from request |

## Error Handling
The function `getResourcesQueryParam` throws a `BadRequestError` if the resources parameter is invalid.

This file is crucial for handling FHIR data in the API, providing both validation schemas and utility functions for processing FHIR-related requests.