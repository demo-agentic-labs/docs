---
title: "internal.ts"
---

## High-level description
This file defines an Express router for handling internal API routes related to medical data. It includes endpoints for managing patient data, document queries, consolidation, and interactions with various Health Information Exchanges (HIEs) like CommonWell and Carequality.

## Code Structure
The code is structured as a series of route handlers for different HTTP methods (GET, POST, PUT, DELETE) on various endpoints. Each handler typically extracts parameters from the request, performs some operations (often involving database queries or external API calls), and sends a response.

## Symbols

### `router`
#### Description
An Express router instance that defines all the routes in this file.

### Route Handlers
Each route handler is an asynchronous function that processes a specific API endpoint. Here are a few examples:

#### `/ids` (GET)
##### Description
Retrieves all patient IDs for a given customer.

##### Inputs
- `cxId`: Customer ID (query parameter)
- `facilityId`: Optional facility ID (query parameter)

##### Outputs
- JSON response with an array of patient IDs

#### `/duplicates` (GET)
##### Description
Retrieves a list of customers with patients that have duplicated persons.

##### Inputs
- `cxId`: Optional customer ID (query parameter)

##### Outputs
- JSON response with duplicated person information

#### `/enhance-coverage` (POST)
##### Description
Triggers a job to enhance coverage of provided patients and checks/fixes any stale enhanced coverage process.

##### Inputs
- `cxId`: Optional customer ID (query parameter)
- `patientIds`: Optional list of patient IDs (query parameter)
- `fromOrgPos`: Optional starting position for CQ Orgs (query parameter)

##### Outputs
- JSON response with processed patient IDs

## Dependencies
The file imports various functions and types from other modules in the project, including command handlers, models, and utility functions.

## Error Handling
The code uses a custom `asyncHandler` function to wrap route handlers, which catches and forwards errors to Express's error handling middleware.

## Configuration
The code relies on configuration values imported from a `Config` module, which likely manages environment-specific settings.

## Logging
The code uses a custom logging utility (`out`) for consistent logging across the application.

This file is a central part of the API's internal routes for medical data management, providing a wide range of functionality for patient data operations and interactions with external health information systems.