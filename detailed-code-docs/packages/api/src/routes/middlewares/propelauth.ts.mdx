---
title: "propelauth.ts"
---

## High-level description
This code defines authentication and authorization functionality using PropelAuth for an API. It provides methods to initialize and retrieve the authentication object, as well as utility functions to extract customer ID and role information from authenticated users.

## Code Structure
The main symbols in this code are interconnected as follows:
- `getAuth()` initializes and returns the `PropelAuth` object.
- `getCxId()`, `getRole()`, and `getOrgMemberInfo()` are utility functions that extract information from the authenticated user object.

## Symbols

### `getAuth()`
#### Description
This function initializes and returns the PropelAuth authentication object. It uses environment variables for configuration and caches the auth object for subsequent calls.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| auth | PropelAuth \| undefined | The initialized PropelAuth object or undefined if not initialized |

#### Internal Logic
1. Logs the authentication configuration (hiding sensitive information).
2. Checks if the auth object is already initialized or if required configuration is missing.
3. If not initialized and all required configs are present, initializes the PropelAuth object using `initBaseAuth()`.
4. Returns the auth object (either newly initialized or cached).

### `getCxId(user: User)`
#### Description
Extracts the customer ID from the user's organization metadata.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user | User | The authenticated user object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cxId | string \| undefined | The customer ID or undefined if not found |

### `getRole(user: User)`
#### Description
Extracts the assigned role from the user's organization information.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user | User | The authenticated user object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| role | string \| undefined | The assigned role or undefined if not found |

### `getOrgMemberInfo(user: User)`
#### Description
Retrieves the organization member information for the user.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user | User | The authenticated user object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| orgMemberInfo | OrgMemberInfo \| undefined | The organization member information or undefined if not found |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/core/util | Logging utility |
| @metriport/shared | Environment variable retrieval |
| @propelauth/express | User and OrgMemberInfo types |
| @propelauth/node | PropelAuth initialization |

## TODOs
- TODO 1986: Move the authentication configuration back to getAuth() and make them required there - getAuth() doesn't return undefined anymore