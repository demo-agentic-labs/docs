---
title: "db.ts"
---

## High-level description
This code defines the database configuration and initialization for a Node.js application using Sequelize ORM and AWS DynamoDB. It sets up various models, establishes database connections, and provides utility functions for database operations.

## Code Structure
The main file `db.ts` exports functions and types related to database initialization and access. It imports and sets up various models from different parts of the application. The `initDB` function is the core of this file, responsible for establishing database connections and initializing models.

## Symbols

### `initDB`
#### Description
This asynchronous function initializes the database connection and sets up the models.

#### Internal Logic
1. Retrieves database credentials and configuration from environment variables.
2. Establishes a connection to the SQL database using Sequelize.
3. Runs database migrations.
4. Initializes all defined models.
5. Sets up the DynamoDB document client.
6. Stores the initialized database objects for external access.

### `getDB`
#### Description
A function that returns the initialized database object.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| db | MetriportDB | The initialized database object |

### `getDbPoolSettings`
#### Description
Retrieves and parses database pool settings from environment variables.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| settings | DbPoolProps | Database pool configuration |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| aws-sdk | AWS SDK for DynamoDB operations |
| sequelize | ORM for SQL database operations |

## Configuration
The code uses various environment variables for configuration:
- `DB_CREDS`: Database credentials
- `TOKEN_TABLE_NAME`: DynamoDB token table name
- `DB_POOL_SETTINGS`: Database pool settings

## Error Handling
The code includes basic error handling, logging errors to the console when database initialization fails.

## Logging
The code uses console.log for logging important steps and errors during the database initialization process.

## TODOs
None explicitly mentioned in the code.

This code serves as the central point for database initialization and configuration in the application, setting up both SQL and NoSQL databases and providing access to them throughout the application.