---
title: "mapi-access.ts"
---

## High-level description
This code defines the `MAPIAccess` model, which represents access to the Medical API (MAPI) for customers. It extends the `BaseModel` class and sets up the database table structure for managing MAPI access.

## Code Structure
The `MAPIAccess` class extends `BaseModel` and uses Sequelize ORM to define the database model. It includes a static `setup` method for initializing the model with Sequelize.

## Symbols

### `MAPIAccess`
#### Description
A class representing the MAPI access model, extending the `BaseModel` class.

#### Internal Logic
- Defines a static `NAME` property set to "mapi_access", which is used as the table name.
- Implements a static `setup` method to initialize the model with Sequelize.
- Uses the `BaseModel.attributes()` and `BaseModel.modelOptions()` to set up the model's attributes and options.

### `MAPIAccess.setup`
#### Description
A static method that initializes the `MAPIAccess` model with Sequelize.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sequelize | Sequelize | The Sequelize instance to use for model initialization |

#### Internal Logic
- Calls `MAPIAccess.init()` to initialize the model with Sequelize.
- Uses `BaseModel.attributes()` for the model's attributes, which includes default fields like `id`, `createdAt`, and `updatedAt`.
- Sets the table name to `MAPIAccess.NAME` ("mapi_access").
- Uses `BaseModel.modelOptions()` for additional model options.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| sequelize | ORM for database interactions |
| BaseModel | Parent class providing common model functionality |
| ModelSetup | Type definition for the setup function |

## Related Information
1. The `MAPIAccess` model is used in the `allowMapiAccess`, `hasMapiAccess`, and `revokeMapiAccess` functions in the `mapi-access.ts` file.
2. Two database migrations are associated with this model:
   - `2023-02-22_00_create-mapi-access.ts`: Creates the initial table structure.
   - `2023-03-17_01_update-mapi-access-rename-id.ts`: Renames the `cx_id` column to `id`.
3. The `processCxId` middleware in `auth.ts` uses the `MAPIAccess` model to check for MAPI access.
4. The `db.ts` file includes `MAPIAccess.setup` in the list of models to be set up with Sequelize.

This model is crucial for managing access to the Medical API, allowing the system to track which customers have been granted access to the MAPI functionality.