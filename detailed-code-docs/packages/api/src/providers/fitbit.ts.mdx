---
title: "fitbit.ts"
---

## High-level description
This file defines the Fitbit class, which implements the Provider interface for interacting with the Fitbit API. It includes methods for authentication, data retrieval, and webhook subscription management for various health data types such as activity, biometrics, body, nutrition, sleep, and user information.

## Code Structure
The Fitbit class extends the Provider class and implements the OAuth2 interface. It contains methods for authentication, data retrieval, and webhook subscription management. The class uses various helper functions and models to map Fitbit API responses to standardized data structures.

## References
- Provider
- OAuth2
- ConnectedUser
- Config
- MetriportError
- Various mapping functions and models from the fitbit folder

## Symbols

### `Fitbit`
#### Description
The main class for interacting with the Fitbit API, extending Provider and implementing OAuth2.

#### Internal Logic
- Initializes with OAuth2 configuration and supported data types
- Implements methods for authentication, data retrieval, and webhook subscription management
- Uses helper functions to map Fitbit API responses to standardized data structures

### `getAccessToken`
#### Description
Retrieves the access token for a connected user.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | The connected user object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| accessToken | string | The access token for the user |

### `getAuthUri`
#### Description
Generates the authorization URI for Fitbit OAuth2 flow.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| state | string | The state parameter for OAuth2 flow |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| authUri | string | The authorization URI |

### `getTokenFromAuthCode`
#### Description
Exchanges an authorization code for an access token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| code | string | The authorization code |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| token | string | The access token |

### `revokeProviderAccess`
#### Description
Revokes the provider access for a connected user.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | The connected user object |

### `getActivityData`
#### Description
Retrieves activity data for a connected user on a specific date.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | The connected user object |
| date | string | The date for which to retrieve data |
| extraParams | DAPIParams | Additional parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| activity | Activity | The retrieved activity data |

### `getBiometricsData`
#### Description
Retrieves biometrics data for a connected user on a specific date.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | The connected user object |
| date | string | The date for which to retrieve data |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| biometrics | Biometrics | The retrieved biometrics data |

### `getBodyData`
#### Description
Retrieves body data for a connected user on a specific date.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | The connected user object |
| date | string | The date for which to retrieve data |
| extraParams | DAPIParams | Additional parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| body | Body | The retrieved body data |

### `getNutritionData`
#### Description
Retrieves nutrition data for a connected user on a specific date.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | The connected user object |
| date | string | The date for which to retrieve data |
| extraParams | DAPIParams | Additional parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| nutrition | Nutrition | The retrieved nutrition data |

### `getSleepData`
#### Description
Retrieves sleep data for a connected user on a specific date.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | The connected user object |
| date | string | The date for which to retrieve data |
| extraParams | DAPIParams | Additional parameters |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| sleep | Sleep | The retrieved sleep data |

### `getUserData`
#### Description
Retrieves user data for a connected user on a specific date.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | The connected user object |
| date | string | The date for which to retrieve data |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| user | User | The retrieved user data |

### `postAuth`
#### Description
Performs post-authentication actions, including revoking tokens and creating new webhook subscriptions.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| token | string | The Fitbit token string |
| user | ConnectedUser | The connected user object |
| throwOnError | boolean | Whether to throw an error on failure |

### `createSubscriptions`
#### Description
Creates new webhook subscriptions based on the user's selected scopes.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| token | FitbitToken | The Fitbit token object |
| throwOnError | boolean | Whether to throw an error on failure |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/api-sdk | Provides data models and types |
| http-status | HTTP status codes |
| axios | HTTP client for making API requests |
| zod | Runtime type checking and validation |

## Error Handling
The code uses custom error classes like `MetriportError` and `FitbitPostAuthError` for specific error scenarios. It also includes try-catch blocks for handling API request errors and token refresh failures.

## Logging
The code uses console.log for logging errors and important information.