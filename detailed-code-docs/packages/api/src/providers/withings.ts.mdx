---
title: "withings.ts"
---

## High-level description
This code defines the Withings class, which is a provider implementation for the Withings health data platform. It handles OAuth2 authentication, token management, and data retrieval for various health metrics such as activity, body measurements, biometrics, and sleep data.

## Code Structure
The Withings class extends the Provider class and implements the OAuth2 interface. It contains methods for authentication, token management, and data retrieval from the Withings API. The class uses various helper functions and models to process and map the retrieved data to standardized formats.

## References
- Provider class
- OAuth2 interface
- ConnectedUser model
- Config class
- Various mapping functions and models for Withings data

## Symbols

### Withings
#### Description
The main class that implements the Withings provider functionality.

#### Internal Logic
1. Initializes OAuth2 settings and supported data types.
2. Implements methods for authentication, token management, and data retrieval.
3. Uses helper functions to map Withings data to standardized formats.

### getAuthUri
#### Description
Generates the authorization URI for Withings OAuth2 flow.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| state | string | State parameter for OAuth2 flow |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| authUri | string | Authorization URI for Withings OAuth2 flow |

### getTokenFromAuthCode
#### Description
Exchanges an authorization code for an access token.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| code | string | Authorization code received from Withings |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| token | string | JSON string containing the access token and related information |

### postAuth
#### Description
Performs post-authentication actions, such as setting up webhooks.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| token | string | Access token for Withings API |

### getAccessToken
#### Description
Retrieves and refreshes the access token for a connected user.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | Connected user object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| accessToken | string | Valid access token for Withings API |

### revokeProviderAccess
#### Description
Revokes the provider access for a connected user.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | Connected user object |

### fetchActivityData, fetchWorkoutData, fetchMeasurementData, fetchDevices, fetchHeartData
#### Description
These methods fetch specific types of data from the Withings API.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| accessToken | string | Valid access token for Withings API |
| date | string | Date for which to fetch data |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | various | Fetched data in Withings-specific format |

### getActivityData, getBodyData, getBiometricsData, getSleepData
#### Description
These methods retrieve and map specific types of health data to standardized formats.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| connectedUser | ConnectedUser | Connected user object |
| date | string | Date for which to fetch data |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| data | Activity, Body, Biometrics, or Sleep | Mapped health data in standardized format |

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/api-sdk | Provides data models and types |
| crypto | Used for generating nonces |
| dayjs | Date manipulation library |
| simple-oauth2 | OAuth2 implementation |

## Error Handling
The class uses try-catch blocks and throws MetriportError instances for error handling.

## Logging
The class uses console.log for basic logging of errors.

___

This documentation provides an overview of the Withings class and its main functionalities. It handles OAuth2 authentication, token management, and data retrieval for various health metrics from the Withings API, mapping the data to standardized formats used in the application.