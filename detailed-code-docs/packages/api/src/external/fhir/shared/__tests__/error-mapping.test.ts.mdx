---
title: "error-mapping.test.ts"
---

## High-level description
This file contains unit tests for FHIR error mapping functionality. It tests the `tryDetermineFhirError` and `groupFHIRErrors` functions from the `error-mapping.ts` file, which are used to parse and group FHIR-related errors.

## Code Structure
The test suite is organized into two main describe blocks: one for `tryDetermineFhirError` and another for `groupFHIRErrors`. The `tryDetermineFhirError` tests cover various error scenarios, including FHIR-related errors, timeout errors, and other unknown errors. The `groupFHIRErrors` tests focus on the grouping functionality for FHIR error mappings.

## Symbols

### `describe("FHIR error mapping", ...)`
#### Description
This is the main test suite for FHIR error mapping functionality.

### `describe("tryDetermineMappingError", ...)`
#### Description
This describe block contains tests for the `tryDetermineFhirError` function.

#### Internal Logic
It tests various scenarios:
1. FHIR-related errors with single and multiple issues
2. Timeout errors
3. Other unknown errors

### `describe("groupFHIRErrors", ...)`
#### Description
This describe block contains tests for the `groupFHIRErrors` function.

#### Internal Logic
It tests the grouping of FHIR error mappings based on resource type and element.

### `toOperationOutcome(issue: OperationOutcomeIssue[]): OperationOutcome`
#### Description
A helper function to create an OperationOutcome object from an array of OperationOutcomeIssue.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| issue | OperationOutcomeIssue[] | An array of OperationOutcomeIssue objects |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| OperationOutcome | OperationOutcome | An OperationOutcome object |

### `toExpected(outcome: LocalOperationOutcomeIssue): FhirErrorMapping`
#### Description
A helper function to create an expected FhirErrorMapping object from a LocalOperationOutcomeIssue.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| outcome | LocalOperationOutcomeIssue | A LocalOperationOutcomeIssue object |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| FhirErrorMapping | FhirErrorMapping | An expected FhirErrorMapping object |

## Dependencies
- @medplum/core: Provides OperationOutcomeError
- @medplum/fhirtypes: Provides FHIR-related types
- uuid: Used for generating unique identifiers in tests
- @metriport/core/external/fhir/shared/index: Provides operationOutcomeIssueToString function
- ../error-mapping: Provides the functions being tested (tryDetermineFhirError and groupFHIRErrors)

## Error Handling
The tests are designed to check various error scenarios and ensure that the error mapping functions handle them correctly. This includes FHIR-specific errors, timeout errors, and unknown errors.

## Notes
- The tests use a custom `LocalOperationOutcomeIssue` interface that extends `OperationOutcomeIssue` with additional properties for testing purposes.
- The test suite covers a wide range of FHIR-related error scenarios, including different resource types and elements.
- The `groupFHIRErrors` tests demonstrate how errors are grouped based on resource type and element.

This test file is crucial for ensuring the reliability and correctness of FHIR error handling and mapping in the application.