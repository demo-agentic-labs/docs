---
title: "index-convert-to-fhir-resource.test.ts"
---

## High-level description
This file contains unit tests for the `convertToFHIRResource` function, which is responsible for converting CommonWell (CW) resources to FHIR-compliant resources. The tests focus on verifying the correct conversion of Practitioner and Patient resources, including handling of organization references and patient IDs.

## Symbols

### `convertToFHIRResource`
#### Description
This function is being tested. It converts a CommonWell resource to a FHIR-compliant resource.

### `describe("convertToFHIRResource")`
#### Description
This test suite contains two test cases for the `convertToFHIRResource` function.

### `it("returns practitioner and role when practitioner has org")`
#### Description
This test verifies that when a Practitioner resource with an organization reference is converted, it returns both a Practitioner and a PractitionerRole resource.

#### Internal Logic
1. Arranges the test data using `docRefContainedPatientWithOrg`.
2. Acts by calling `convertToFHIRResource` with the arranged data.
3. Asserts that the result contains two resources: a Practitioner and a PractitionerRole, with correct properties and references.

### `it("sets the cotanined Patient's id as the patientId when its original id matches subject.ref")`
#### Description
This test checks if the function correctly sets the Patient's ID when converting a Patient resource.

#### Internal Logic
1. Arranges test data using `makeContainedPatient` function.
2. Acts by calling `convertToFHIRResource` with the arranged data.
3. Asserts that the result contains a single Patient resource with the correct ID.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/commonwell-sdk | Provides types and utilities for working with CommonWell data |
| uuid | Generates UUIDs for test data |

## Error Handling
The tests use Jest's assertion functions to check for expected outcomes. If any assertion fails, the test will fail and provide details about the mismatch.

## Notes
- The tests use mock data (`docRefContainedPatientWithOrg` and `makeContainedPatient`) to simulate CommonWell resources.
- The `beforeEach` hook restores all mocks before each test to ensure a clean testing environment.
- There's a typo in the second test description: "cotanined" should be "contained".