---
title: "patient-updater-carequality.ts"
---

## High-level description
The `PatientUpdaterCarequality` class is responsible for updating patient data on Carequality. It retrieves patient and facility information from the system, and then calls the `discover` function to initiate the update process on Carequality.

## Code Structure
The `PatientUpdaterCarequality` class extends the abstract `PatientUpdater` class. It implements the `updateAll` method, which retrieves patients, iterates through them, and updates each patient on Carequality. The `updatePatient` function handles the logic for updating a single patient, including retrieving facility information and calling the `discover` function.

## References
- `PatientUpdater`: Abstract class defining the interface for patient updaters.
- `getPatients`: Function to retrieve patient data.
- `getFacilityIdOrFail`: Function to retrieve the facility ID associated with a patient.
- `getFacilityOrFail`: Function to retrieve facility data.
- `discover`: Function to initiate the patient update process on Carequality.

## Symbols
### `PatientUpdaterCarequality`
#### Description
This class implements the `PatientUpdater` interface and provides the logic for updating patient data on Carequality.

#### Inputs
None

#### Outputs
None

#### Internal Logic
The `updateAll` method performs the following steps:
1. Retrieves a list of patients based on the provided `cxId` and optional `patientIds`.
2. Iterates through the list of patients.
3. For each patient:
    - Retrieves the associated facility ID.
    - Retrieves the facility data using the facility ID.
    - Calls the `discover` function to initiate the patient update process on Carequality.
4. Handles any errors that occur during the update process and logs them.
5. Returns the number of failed updates.

## Side Effects
- Updates patient data on Carequality.
- Logs errors encountered during the update process.
- Sends error notifications using the `capture` function.

#### Performance Considerations
The `executeAsynchronously` function is used to update patients in parallel, which can improve performance. The `maxNumberOfParallelRequestsToCQ` constant limits the number of parallel requests to Carequality, preventing overloading the external system.
