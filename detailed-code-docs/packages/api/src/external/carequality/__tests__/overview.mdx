---
title: "Overview"
---

## High-level description
This directory contains test files for the Carequality (CQ) integration within the API. It includes unit tests for various functionalities such as creating directory entries, handling patient data, registering facilities, managing patient discovery processes, and updating patient data.

## What does it do?
The tests in this directory ensure the correct functioning of Carequality-related operations within the API. They cover scenarios such as:

1. Creating test data for Carequality Directory Entries and patient information.
2. Transforming patient resources into normalized link demographics.
3. Registering facilities with Carequality, including both non-OBO and OBO facilities.
4. Managing patient discovery processes, including scheduling and execution.
5. Updating patient discovery status and related parameters.
6. Creating or updating Carequality patient data, including handling of link demographics.

These tests help maintain the integrity and reliability of the Carequality integration by verifying that each component behaves as expected under various conditions.

## Key Files

1. **cq-directory.ts**: 
   - Defines factory functions for creating test data representing Carequality Directory Entries.
   - Uses faker.js to generate realistic-looking data for various fields.

2. **cq-patient-data.ts**:
   - Contains helper functions for creating test data related to Carequality patient information.
   - Includes functions to generate mock CQLink, LinkDemographicsHistory, CQData, and CQPatientData objects.

3. **cq.demographics.test.ts**:
   - Tests the `patientResourceToNormalizedLinkDemographics` function.
   - Verifies the correct normalization of patient demographics data from a PatientResource object to a LinkDemographics object.

4. **cq.register-facility.test.ts**:
   - Tests the `createOrUpdateFacilityInCq` function for both non-OBO and OBO facilities.
   - Verifies that the function correctly prepares and sends facility data to Carequality.

5. **cq.run-or-schedule-patient-discovery.test.ts**:
   - Tests the `runOrScheduleCqPatientDiscovery` function.
   - Verifies the logic for determining whether to run or schedule a Carequality patient discovery process.

6. **cq.set-discovery-fields.test.ts**:
   - Tests the `updatePatientDiscoveryStatus` function.
   - Covers scenarios such as setting all possible values, setting only status with previous values, and attempting to set status without previous values.

7. **cq.update-patient-data.test.ts**:
   - Tests the `createOrUpdateCQPatientData` function.
   - Covers scenarios with and without existing link demographics data.

## Dependencies
The test files rely on several external libraries and internal modules:

1. **Jest**: Used as the primary testing framework for running tests and making assertions.
2. **@faker-js/faker**: Utilized for generating realistic fake data for testing purposes.
3. **@metriport/carequality-sdk**: Provides models and types related to Carequality integration.
4. **@metriport/core**: Supplies various utility functions and domain-specific types.
5. **@metriport/ihe-gateway-sdk**: Offers types related to IHE (Integrating the Healthcare Enterprise) gateway.
6. **dayjs**: Used for date and time manipulation in tests.

Internal dependencies include various models, utilities, and domain-specific modules from the API codebase.

## Configuration
The tests do not rely on specific configuration files or environment variables. However, they do use mocking and spying techniques to isolate the tested functions from external dependencies and to control the test environment.

In summary, this directory contains a comprehensive suite of tests that ensure the reliability and correctness of the Carequality integration within the API. The tests cover various aspects of the integration, from data creation and transformation to complex operations like facility registration and patient discovery management.