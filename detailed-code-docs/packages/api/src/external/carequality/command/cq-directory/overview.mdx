---
title: "Overview"
---

## High-level description
This directory contains code for managing and interacting with the Carequality (CQ) directory within the API. It provides functionality for creating, updating, searching, and rebuilding the CQ directory entries. The code handles operations such as bulk insertion of directory entries, searching for organizations within a specific radius, and parsing CQ organization data.

## What does it do?
The code in this directory performs several key functions related to the Carequality directory:

1. Creates or updates CQ directory entries for organizations and facilities.
2. Searches the CQ directory for organizations within a specified radius of patient addresses or geographic coordinates.
3. Rebuilds the entire CQ directory by fetching data from the Carequality Management API, parsing it, and storing it in the database.
4. Provides utility functions for parsing and formatting CQ organization data.
5. Manages the database tables used for storing CQ directory entries, including temporary and backup tables during the rebuild process.

These functionalities are crucial for maintaining an up-to-date directory of healthcare organizations and facilitating patient discovery and data exchange within the Carequality network.

## Entry points
The main entry points for this directory are:

1. `createOrUpdateFacilityInCq`: Creates or updates a facility's representation in the CQ directory.
2. `createOrUpdateCQOrganization`: Creates or updates an organization in the CQ directory.
3. `searchCQDirectoriesAroundPatientAddresses`: Searches for CQ organizations within a radius of patient addresses.
4. `searchCQDirectoriesByRadius`: Searches for CQ organizations within a radius of specific coordinates.
5. `rebuildCQDirectory`: Rebuilds the entire CQ directory by fetching and processing data from the Carequality Management API.

The code is organized conceptually around these main operations, with supporting functions and utilities to handle data processing, database interactions, and error handling.

## Key Files
1. `create-or-update-cq-facility.ts`: Handles the creation or update of facilities in the CQ directory.
2. `create-or-update-cq-organization.ts`: Manages the creation or update of organizations in the CQ directory.
3. `search-cq-directory.ts`: Provides functions for searching the CQ directory based on geographic criteria.
4. `rebuild-cq-directory.ts`: Contains the logic for rebuilding the entire CQ directory.
5. `parse-cq-directory-entry.ts`: Handles parsing and formatting of CQ organization data.
6. `create-cq-directory-entry.ts`: Manages bulk insertion of CQ directory entries into the database.
7. `get-cq-directory-entry.ts`: Provides functions for retrieving CQ directory entries from the database.
8. `shared.ts`: Defines constants for database table names used in CQ directory operations.

## Dependencies
The code in this directory relies on several external libraries and internal modules:

1. `@metriport/carequality-sdk`: Provides types and utilities for interacting with the Carequality API.
2. `@metriport/core`: Offers core utilities for logging, notifications, and AWS interactions.
3. `@metriport/shared`: Provides shared utilities for error handling, URL validation, and data normalization.
4. `sequelize`: Used for database interactions and ORM functionality.
5. `convert-units`: Used for unit conversions, particularly for distance calculations.
6. `dayjs`: Provides date and time utilities.

Internal dependencies include various models, configurations, and utility functions from other parts of the API codebase.

## Configuration
The code uses several configuration settings and environment variables:

1. `CQ_URLS_TO_EXCLUDE`: An environment variable containing URLs to exclude from CQ directory searches.
2. `DEFAULT_RADIUS_IN_MILES`: A constant defining the default search radius for CQ directory searches.
3. Database configuration: The code relies on Sequelize configuration for database connections and operations.
4. Carequality API configuration: Settings for interacting with the Carequality Management API.

## Error Handling
The code implements error handling throughout its functions:

1. Custom error classes like `NotFoundError` and `BadRequestError` are used for specific error conditions.
2. The `capture.error` function is used to log and report errors.
3. Try-catch blocks are used to handle potential errors during database operations and API interactions.
4. Error messages are logged for debugging purposes.

In summary, this directory provides a comprehensive set of functions for managing and interacting with the Carequality directory within the API. It handles the creation, update, search, and rebuilding of CQ directory entries, ensuring that the system maintains an accurate and up-to-date directory of healthcare organizations for patient discovery and data exchange purposes.