---
title: "search-cq-directory.test.ts"
---

## High-level description
The `search-cq-directory.test.ts` file contains unit tests for the `searchCQDirectoriesAroundPatientAddresses` function, which is responsible for searching for CareQuality (CQ) directory entries within a specified radius of a patient's addresses. 

## Code Structure
The code defines a test suite using `describe` with nested test cases using `it`. It mocks the `searchCQDirectoriesByRadius` function to isolate the logic being tested. The tests cover scenarios with and without patient address coordinates, and verify the expected behavior and parameters passed to the mocked function.

## Symbols
### `searchCQDirectoriesAroundPatientAddresses` test suite
#### Description
This test suite verifies the functionality of the `searchCQDirectoriesAroundPatientAddresses` function.

#### Internal Logic
- **`returns empty array if no coordinates`**: Tests that an empty array is returned if the patient has no address coordinates.
  - **Arrange**: Creates a patient without coordinates and mocks `searchCQDirectoriesByRadius` to return a pre-defined result.
  - **Act**: Calls `searchCQDirectoriesAroundPatientAddresses` with the patient.
  - **Assert**: Verifies that the result is an empty array and `searchCQDirectoriesByRadius` is not called.
- **`returns search result when there are coordinates`**: Tests that the function returns search results when the patient has address coordinates.
  - **Arrange**: Creates a patient with coordinates and mocks `searchCQDirectoriesByRadius` to return a pre-defined result.
  - **Act**: Calls `searchCQDirectoriesAroundPatientAddresses` with the patient.
  - **Assert**: Verifies that the result matches the mocked result and `searchCQDirectoriesByRadius` is called.
- **`passes correct params to searchCQDirectoriesByRadius`**: Tests that the function passes the correct parameters to `searchCQDirectoriesByRadius`.
  - **Arrange**: Creates a patient with multiple addresses, defines radius and flag values, and mocks `searchCQDirectoriesByRadius`.
  - **Act**: Calls `searchCQDirectoriesAroundPatientAddresses` with the patient, radius, flag, and mocked function.
  - **Assert**: Verifies that `searchCQDirectoriesByRadius` is called with the expected coordinates, radius, and flag.

## References
- `searchCQDirectoriesByRadius`: This function is mocked and its behavior is asserted in the tests.
- `makePatient`: Used to create test patient data.
- `makeAddressWithCoordinates`: Used to create address data with coordinates.
- `makeCQDirectoryEntry`: Used to create mock CQ directory entries.
- `faker`: Used to generate random test data.
- `convert`: Used for unit conversion (miles to meters).
