---
title: "Overview"
---

## High-level description
This directory contains test files for the CareQuality (CQ) directory search functionality within the API. The tests focus on address field extraction and directory search operations based on patient addresses.

## What does it do?
The tests in this directory verify two main functionalities:

1. Address Field Extraction: It tests the `getAddressFields` function, which is responsible for extracting the most complete address information from a set of addresses. This is crucial for ensuring that the system can work with potentially incomplete or varied address data.

2. CQ Directory Search: It tests the `searchCQDirectoriesAroundPatientAddresses` function, which searches for CareQuality directory entries within a specified radius of a patient's addresses. This functionality is important for finding relevant healthcare providers or facilities near a patient's location.

These tests ensure that the address processing and directory search features work correctly, handling various scenarios such as missing data, multiple addresses, and different search parameters.

## Key Files

1. `get-address-fields.test.ts`:
   - Tests the `getAddressFields` function.
   - Verifies that the function can extract the most complete address information from an array of `Address` objects.
   - Checks the function's behavior with different input scenarios, including undefined addresses, incomplete addresses, and addresses with all required fields.

2. `search-cq-directory.test.ts`:
   - Tests the `searchCQDirectoriesAroundPatientAddresses` function.
   - Verifies the function's behavior when searching for CQ directory entries based on patient addresses.
   - Checks scenarios with and without patient address coordinates.
   - Ensures that the correct parameters are passed to the underlying `searchCQDirectoriesByRadius` function.

## Dependencies
The test files rely on several external dependencies and utility functions:

- `jest`: The testing framework used for writing and running the unit tests.
- `faker`: A library used for generating random test data, particularly for creating mock patient and address information.
- `convert`: A utility for unit conversion, specifically used for converting miles to meters in the search radius calculations.

Internal dependencies and utility functions include:
- `makePatient`: A function to create test patient data.
- `makeAddressWithCoordinates`: A function to create address data with coordinates.
- `makeCQDirectoryEntry`: A function to create mock CQ directory entries.
- `normalizeZipCode`: A function used in address field extraction to standardize zip code formats.

## Configuration
While there are no explicit configuration files in this directory, the tests use various constants and parameters that could be considered configuration:

- Search radius: The tests use a default search radius of 30 miles, which is converted to meters.
- Address fields: The tests check for specific address fields including addressLine, city, state, and zip.
- Flags: The tests include a boolean flag parameter in the directory search function, which could be used to modify search behavior.

These "configuration" values are hardcoded in the test files but represent parameters that might be configurable in the actual implementation.

In summary, this test directory ensures the robustness and correctness of the CareQuality directory search functionality, focusing on address processing and geolocation-based searches. The tests cover various scenarios and edge cases, providing confidence in the system's ability to handle real-world data and search requirements.