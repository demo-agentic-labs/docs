---
title: "update-source-conversion-progress.ts"
---

## High-level description
This code defines a function `updateSourceConversionProgress` that updates and returns the conversion progress for a specific medical data source of a patient. It uses the patient's existing data and the result of a conversion operation to calculate and return the updated progress.

## Code Structure
The main function `updateSourceConversionProgress` uses the `tallyDocQueryProgress` function from the related file to calculate the updated progress. It then extracts and returns only the conversion progress from the tallied result.

## References
- `Progress` and `MedicalDataSource` from @metriport/core
- `Patient` from @metriport/core/domain/patient
- `tallyDocQueryProgress` and `ConvertResult` from "../../domain/medical/conversion-progress"

## Symbols

### `updateSourceConversionProgress`
#### Description
This function updates the conversion progress for a specific medical data source of a patient and returns the updated progress.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patient | Pick&lt;Patient, "id" \| "cxId" \| "data"&gt; | Patient object containing id, cxId, and data |
| convertResult | ConvertResult | Result of the conversion operation ("success" or "failed") |
| source | MedicalDataSource | The medical data source for which progress is being updated |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| progress | Progress \| undefined | Updated conversion progress for the specified source |

#### Internal Logic
1. Extract the patient's external data for the specified source.
2. Get the existing document query progress for the source.
3. Use `tallyDocQueryProgress` to calculate the updated progress.
4. Return only the conversion progress from the tallied result.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/core | Importing types and enums |
| @metriport/core/domain/patient | Importing Patient type |
| @metriport/core/external/index | Importing MedicalDataSource enum |
| ../../domain/medical/conversion-progress | Importing utility functions |

## Notes
- The function uses a combination of two different `Pick` types for the `patient` parameter, which might be confusing. It could be simplified to include all required properties in a single `Pick` type.
- The function returns `undefined` if there's no conversion progress available for the specified source.
- The function doesn't modify the patient object directly; it only calculates and returns the updated progress.