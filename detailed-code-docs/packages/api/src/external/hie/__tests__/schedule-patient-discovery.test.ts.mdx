---
title: "schedule-patient-discovery.test.ts"
---

## High-level description
This code implements unit tests for scheduling and resetting patient discovery requests in a medical data system. It tests the functionality of updating patient records with scheduled patient discovery information and resetting this information for different medical data sources.

## Code Structure
The main symbols in this code are test cases that interact with mocked versions of the `PatientModel`, `CQDirectoryEntryModel`, and various functions from external modules. These test cases verify the behavior of `schedulePatientDiscovery` and `resetScheduledPatientDiscovery` functions.

## Symbols

### `beforeEach`
#### Description
This function sets up the test environment before each test case. It mocks the database transaction, `PatientModel.findOne`, `PatientModel.update`, and `CQDirectoryEntryModel.findAll` methods.

### `afterEach`
#### Description
This function clears all mocks after each test case.

### `checkPatientUpdateWith`
#### Description
A helper function that checks if the `PatientModel.update` method was called with the expected scheduled patient discovery data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| scheduledPd | ScheduledPatientDiscovery \| undefined | The expected scheduled patient discovery data |

### `describe("update patient discovery schedule")`
#### Description
A test suite that contains test cases for updating patient discovery schedules.

### `it("update patient with no existing schedule")`
#### Description
Tests scheduling a patient discovery when there's no existing schedule.

### `it("update patient with existing schedule")`
#### Description
Tests scheduling a patient discovery when there's an existing schedule, verifying that it's overwritten.

### `describe("reset patient discovery schedule")`
#### Description
A test suite that contains test cases for resetting patient discovery schedules.

### `it("reset patient with no existing schedule")`
#### Description
Tests resetting a patient discovery schedule when there's no existing schedule.

### `it("reset patient with existing schedule")`
#### Description
Tests resetting a patient discovery schedule when there's an existing schedule, verifying that it's removed.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/core | Provides domain models and data source definitions |
| ../../../models/medical/patient | Provides the PatientModel |
| ../../carequality/models/cq-directory | Provides the CQDirectoryEntryModel |
| ../../../domain/medical/__tests__/patient | Provides test utilities for creating patient data |
| ../../../models/__tests__/transaction | Provides mock for database transactions |
| ../../commonwell/patient-shared | Provides types for CommonWell patient data |
| ../schedule-patient-discovery | Provides the function being tested |
| ../reset-scheduled-patient-discovery-request | Provides the function being tested |
| ../cross-hie-ids | Provides utility for getting CQ org IDs to deny on CW |

## Error Handling
The tests don't explicitly handle errors but use Jest's assertion functions to verify the expected behavior.