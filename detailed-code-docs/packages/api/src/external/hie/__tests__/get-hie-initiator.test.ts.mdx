---
title: "get-hie-initiator.test.ts"
---

## High-level description
This file contains unit tests for the functions `getHieInitiator`, `isHieEnabledToQuery`, and `getPatientsFacility` from the `get-hie-initiator.ts` file. These tests verify the behavior of these functions under various scenarios, including different organization types, facility configurations, and error conditions.

## Code Structure
The test file is organized into three main describe blocks, each focusing on one of the functions being tested. Within each block, there are multiple test cases that cover different scenarios and edge cases.

## Symbols

### `describe("getHieInitiator", ...)`
#### Description
This test suite verifies the behavior of the `getHieInitiator` function.

#### Internal Logic
- Tests that the function retrieves data from the database with expected parameters.
- Verifies that it returns the organization when the type is Provider.
- Checks that it returns the facility as initiator when it's a CI (Certified Implementer).

### `describe("isHieEnabledToQuery", ...)`
#### Description
This test suite checks the functionality of the `isHieEnabledToQuery` function.

#### Internal Logic
- Tests that it returns true when the facility is a CI and OBO (On Behalf Of) enabled.
- Verifies that it returns false when the facility is a CI but OBO is not enabled.
- Checks that it returns true when the facility is a CI and is non-OBO.

### `describe("getPatientsFacility", ...)`
#### Description
This test suite validates the behavior of the `getPatientsFacility` function.

#### Internal Logic
- Tests that it throws an error when no facility is provided and the patient has more than one facility.
- Verifies that it throws an error when no facility is provided and the patient has no facilities.
- Checks that it throws an error when a facility is provided but the patient is not associated with it.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @faker-js/faker | Used to generate fake data for testing |
| @metriport/core/domain/organization | Imports Organization and OrganizationBizType types |
| @metriport/core/domain/patient | Imports Patient type |
| @metriport/core/external/index | Imports MedicalDataSource enum |
| ../../../command/medical/patient/get-patient | Imports getPatientWithDependencies function |
| ../../../domain/medical/facility | Imports Facility and FacilityType types |
| ../../../domain/medical/__tests__/facility | Imports makeFacility helper function |
| ../../../domain/medical/__tests__/organization | Imports makeOrganization helper function |
| ../../../domain/medical/__tests__/patient | Imports makePatient helper function |
| ../get-hie-initiator | Imports functions being tested |

## Error Handling
The tests verify that the functions throw appropriate errors in specific scenarios, such as when a patient has multiple facilities but no facility ID is provided.

## TODOs
There are no explicit TODOs in this test file.