---
title: "set-doc-query-progress.test.ts"
---

## High-level description
This file contains unit tests for the functions `aggregateAndSetHIEProgresses`, `setHIEDocProgress`, and `aggregateStatus` from the `set-doc-query-progress.ts` file. These functions are responsible for managing and aggregating document query progress for different Health Information Exchanges (HIEs) in a patient's external data.

## Code Structure
The test file is organized into three main describe blocks, each focusing on a specific function:
1. `aggregateAndSetHIEProgresses`
2. `setHIEDocProgress`
3. `aggregateStatus`

Each describe block contains multiple test cases that cover different scenarios and edge cases for the respective functions.

## Symbols

### `aggregateAndSetHIEProgresses`
#### Description
Tests the function that aggregates and sets HIE progresses for document queries.

#### Internal Logic
- Tests various scenarios with different combinations of document query progress for CommonWell (CW) and Carequality (CQ) HIEs.
- Verifies the correct aggregation of download and convert progresses.
- Checks handling of empty sources and processing states.

### `setHIEDocProgress`
#### Description
Tests the function that sets document query progress for a specific HIE.

#### Internal Logic
- Tests scenarios for setting download and convert progress separately.
- Verifies the correct updating of existing progress data.
- Checks handling of different progress statuses (processing, completed, failed).

### `aggregateStatus`
#### Description
Tests the function that aggregates multiple document query statuses into a single status.

#### Internal Logic
- Tests various combinations of statuses to ensure the correct aggregated status is returned.
- Verifies the priority order of statuses (processing &gt; completed &gt; failed).

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/core/domain/document-query | Imports types and functions related to document query progress |
| @metriport/core/external/index | Imports MedicalDataSource enum |
| @metriport/core/domain//patient | Imports PatientExternalData type |
| ./doc-progress-tests | Imports helper functions for creating test progress data |

## Error Handling
The tests use Jest's expect assertions to verify the correct behavior of the functions under test. Any unexpected results will cause the tests to fail.

## Performance Considerations
These tests are designed to run quickly as part of a unit test suite. They don't involve any actual database operations or external service calls, focusing solely on the logic of the functions being tested.