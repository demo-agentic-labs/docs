---
title: "Overview"
---

## High-level description
This directory contains code for integrating various external services and systems with the Metriport API. It includes modules for interacting with AWS services, Canvas integration, Carequality, CommonWell, FHIR (Fast Healthcare Interoperability Resources), IHE (Integrating the Healthcare Enterprise) Gateway, OpenSearch, and other healthcare-related systems.

## What does it do?
The code in this directory performs several key functions:

1. AWS Integration: Interacts with various AWS services such as AppConfig, CloudWatch, Lambda, OpenSearch, S3, and SQS for feature flag management, metric reporting, document signing, and data storage.

2. Canvas Integration: Listens for Canvas integration events and creates notes with patient medical data in the Canvas system.

3. Carequality Integration: Manages patient discovery, document querying, and organization data within the Carequality network.

4. CommonWell Integration: Handles patient management, document querying, and API interactions with the CommonWell Health Alliance system.

5. CDA (Clinical Document Architecture) Generation: Converts patient data to CDA format for interoperability purposes.

6. FHIR Integration: Provides connectors for communicating with FHIR servers, managing FHIR resources, and converting between FHIR and other healthcare data formats.

7. FHIR to CDA Conversion: Implements conversion of FHIR data to CDA format, supporting both direct and AWS Lambda-based conversion methods.

8. Health Information Exchange (HIE) Operations: Manages patient discovery, document querying, and data retrieval across multiple HIEs, primarily focusing on CommonWell and Carequality.

9. IHE Gateway: Implements an IHE Gateway for handling outbound IHE transactions such as Patient Discovery, Document Query, and Document Retrieval.

10. OpenSearch Integration: Provides services for ingesting and querying file content using OpenSearch, with support for both direct and SQS-based implementations.

## Entry points
The main entry points for this directory vary depending on the specific integration or functionality:

1. AWS: `packages/api/src/external/aws/index.ts` provides access to various AWS service integrations.
2. Canvas: `packages/api/src/external/canvas/canvas-event-listener.ts` sets up the event listener for Canvas integration.
3. Carequality: `packages/api/src/external/carequality/patient.ts` contains core functionality for patient-related operations.
4. CommonWell: `packages/api/src/external/commonwell/api.ts` provides functions to create CommonWell API clients.
5. FHIR: `packages/api/src/external/fhir/connector/connector-factory.ts` creates FHIR server connectors.
6. FHIR to CDA Converter: `packages/api/src/external/fhir-to-cda-converter/converter-factory.ts` contains the factory function for creating converters.
7. HIE: `packages/api/src/external/hie/run-or-schedule-patient-discovery.ts` orchestrates the patient discovery process across HIEs.
8. IHE Gateway: `packages/api/src/external/ihe-gateway-v2/ihe-gateway-v2-factory.ts` provides the factory function for creating IHE Gateway instances.
9. OpenSearch: `packages/api/src/external/opensearch/file-search-connector-factory.ts` contains factory functions for creating OpenSearch services.

## Key Files
1. `aws/index.ts`: Exports AWS service integrations.
2. `canvas/canvas-event-listener.ts`: Implements Canvas integration event listener.
3. `carequality/patient.ts`: Core Carequality patient operations.
4. `commonwell/api.ts`: CommonWell API client creation.
5. `fhir/connector/connector-factory.ts`: FHIR server connector factory.
6. `fhir-to-cda-converter/converter-factory.ts`: FHIR to CDA converter factory.
7. `hie/run-or-schedule-patient-discovery.ts`: HIE patient discovery orchestration.
8. `ihe-gateway-v2/ihe-gateway-v2-factory.ts`: IHE Gateway factory.
9. `opensearch/file-search-connector-factory.ts`: OpenSearch service factories.

## Dependencies
The code in this directory relies on several external libraries and frameworks:

1. AWS SDK: For interacting with various AWS services.
2. @metriport/core: Provides core functionality and utilities used across different modules.
3. @metriport/commonwell-sdk: Offers functionality for CommonWell interactions.
4. @metriport/carequality-sdk: Provides types and utilities for Carequality interactions.
5. @medplum/fhirtypes: Offers FHIR type definitions.
6. axios: Used for making HTTP requests in various integrations.
7. dayjs: Utilized for date and time manipulation.
8. zod: Employed for schema validation in some modules.

## Configuration
The directory uses various configuration settings, typically accessed through a `Config` class or environment variables. Key configuration points include:

1. AWS region and service endpoints
2. API keys and certificates for various integrations
3. Feature flags for enabling/disabling specific functionalities
4. Environment-specific settings (e.g., production, staging, development)
5. URLs for external services and APIs

The `tsconfig.json` file in this directory configures TypeScript compiler options, extending from a parent configuration and applying stricter type checking for the `external` directory.

In conclusion, this `external` directory serves as a central hub for integrating various external services and systems with the Metriport API. It provides a wide range of functionalities for healthcare data interoperability, document management, and interaction with different health information exchange networks.