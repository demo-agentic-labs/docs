---
title: "patient-event-listener.ts"
---

## High-level description
This code defines a function that sets up an event listener for patient updates. When a patient is updated, it sets the CommonWell (CQ) link status of the patient to "unlinked". This functionality is marked for removal in a future update.

## Code Structure
The main function in this file sets up an event listener using the `patientEvents()` function imported from another module. When a patient update event is triggered, it calls the `setCQLinkStatus` function to update the patient's CQ link status.

## References
- `PatientEvents` and `patientEvents` from "../../../event/medical/patient-event"
- `setCQLinkStatus` from "./cq-link-status"

## Symbols

### Default Export Function
#### Description
This unnamed function sets up an event listener for patient updates and updates the CQ link status when a patient is updated.

#### Inputs
None directly, but it uses the `patientEvents()` function to access the event emitter.

#### Outputs
None directly, but it triggers a side effect of updating the patient's CQ link status.

#### Internal Logic
1. Listens for the `PatientEvents.UPDATED` event using `patientEvents().on()`.
2. When the event is triggered, it:
   - Sets the `cqLinkStatus` to "unlinked".
   - Logs a message about setting the CQ link status.
   - Calls `setCQLinkStatus` with the patient's `cxId`, `id`, and the new `cqLinkStatus`.

## Side Effects
- Updates the CQ link status of a patient in the database when a patient update event is triggered.
- Logs a message to the console about the CQ link status update.

## TODOs
There is a TODO comment (TODO 1543) indicating that this entire functionality should be removed when "EC" is removed, along with the respective fields from the database.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| PatientEvents, patientEvents | Imported from "../../../event/medical/patient-event" to handle patient-related events |
| setCQLinkStatus | Imported from "./cq-link-status" to update the CQ link status of a patient |

## Logging
The code uses `console.log` to output information about setting the CQ link status for a patient.

This code appears to be part of a larger system dealing with patient data and integration with CommonWell Health Alliance (CQ). It specifically handles updating the link status between the local patient record and the CommonWell system when a patient is updated. The "unlinked" status suggests that this code might be part of a process to manage the synchronization or disconnection of patient records between systems.