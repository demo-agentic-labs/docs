---
title: "Overview"
---

## High-level description
This directory contains modules for managing CommonWell (CW) patient data and interactions within a larger API system. It provides functionality for creating, updating, retrieving, and deleting CW patient data in a database, as well as managing patient discovery processes and facility/organization synchronization with CommonWell.

## What does it do?
The code in this directory handles several key operations related to CommonWell integration:

1. Patient Data Management: It allows the system to create, update, retrieve, and delete CommonWell patient data in the database, including CW links and link demographics history.

2. Facility and Organization Synchronization: It provides functions to create or update facilities and organizations in the CommonWell system, ensuring that the local database and CommonWell are in sync.

3. Patient Discovery: It manages the process of running or scheduling patient discovery in CommonWell, based on the current status of the patient and various conditions.

4. CommonWell Integration: It serves as an interface between the local system and CommonWell, handling data transformations and API interactions necessary for maintaining consistency between the two systems.

These operations are crucial for maintaining accurate and up-to-date CommonWell patient information and ensuring proper integration with the CommonWell Health Alliance system.

## Key Files

1. `create-or-update-cw-facility.ts`:
   - Contains the `createOrUpdateFacilityInCw` function.
   - Handles the creation or update of facilities in CommonWell.

2. `create-or-update-cw-organization.ts`:
   - Defines `createOrUpdateCWOrganization` and `getAndUpdateCWOrgAndMetriportOrg` functions.
   - Manages the creation, update, and synchronization of organizations between the local system and CommonWell.

3. `cw-patient-data/` (directory):
   - Contains modules for CRUD operations on CW patient data.
   - Includes functions for creating, retrieving, updating, and deleting CW patient data in the database.

4. `run-or-schedule-patient-discovery.ts`:
   - Defines the `runOrScheduleCwPatientDiscovery` function.
   - Manages the process of running or scheduling patient discovery in CommonWell.

## Dependencies
The code relies on several external libraries and internal modules:

1. Sequelize: Used for database operations and transaction management.
2. Lodash: Utilized for utility functions.
3. @metriport/core: Provides types and utility functions.
4. Internal models and types: Uses various models and types defined elsewhere in the project.

## Configuration
While not explicitly mentioned in all files, the code likely relies on database configuration settings and CommonWell API configurations defined elsewhere in the project. This would include connection details, model definitions, and any environment-specific settings for database interactions and API calls.

The code uses transactional approaches for data consistency, which may have performance implications in high-concurrency scenarios. Proper database indexing and optimization would be crucial for maintaining good performance, especially as the dataset grows.

Error handling is implemented to varying degrees across the modules, with some using try-catch blocks and others delegating error handling to underlying functions. A more comprehensive error handling strategy might be beneficial for production use, especially for logging and monitoring purposes.

Overall, this directory provides a robust set of functions for managing CommonWell integrations, forming a crucial part of the API's functionality in handling healthcare information and maintaining synchronization with the CommonWell Health Alliance system.