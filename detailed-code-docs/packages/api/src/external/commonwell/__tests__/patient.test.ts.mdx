---
title: "patient.test.ts"
---

## High-level description
This code contains unit tests for the `validateCWEnabled` function in the CommonWell patient module. It tests various scenarios to ensure the function correctly determines whether CommonWell functionality should be enabled for a patient based on their gender and other configuration settings.

## Code Structure
The main structure is a Jest test suite for the `validateCWEnabled` function. It includes multiple test cases that mock different configurations and patient data to verify the function's behavior under various conditions.

## Symbols

### `validateCWEnabled`
#### Description
This function determines whether CommonWell functionality should be enabled for a given patient. It checks various conditions including patient gender, sandbox environment, and configuration settings.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patient | Patient | The patient object to validate |
| facilityId | string | The ID of the facility |
| forceCW | boolean | Optional flag to force CommonWell enablement |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | Promise&lt;boolean&gt; | A promise that resolves to true if CommonWell is enabled, false otherwise |

#### Internal Logic
1. Checks if CommonWell is globally enabled
2. Checks if CommonWell is enabled for the specific customer
3. Checks if the facility is enabled to query CommonWell
4. Considers the patient's gender
5. Takes into account whether it's a sandbox environment or if CommonWell is forced

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @faker-js/faker | Generates fake data for testing |
| jest | Testing framework |

## Error Handling
The tests mock various functions to simulate different scenarios, including error cases. However, the actual error handling logic is not visible in this test file.

## Test Cases
1. Returns true for patients with gender "F", "M", or "O"
2. Returns false for patients with gender "U"
3. Returns false when forceCW is true and patient has gender "U"
4. Tests behavior in sandbox and non-sandbox environments

## Configuration
The tests use Jest's mocking capabilities to simulate different configuration settings:
- `isCommonwellEnabled`
- `isCWEnabledForCx`
- `isFacilityEnabledToQueryCW`
- `Config.isSandbox`

These mocks allow the tests to control the environment and configuration for each test case.

___

This test file ensures that the `validateCWEnabled` function correctly handles various scenarios and configurations, providing confidence in its behavior across different use cases.