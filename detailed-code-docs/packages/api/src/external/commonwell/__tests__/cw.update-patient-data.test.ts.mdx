---
title: "cw.update-patient-data.test.ts"
---

## High-level description
This file contains unit tests for the `createOrUpdateCwPatientData` function, which is responsible for updating CommonWell patient data. The tests focus on verifying the correct behavior when updating patient data with new links and link demographics history.

## Code Structure
The test file is structured using Jest testing framework. It includes setup and teardown functions (`beforeEach` and `afterEach`), mock implementations for database operations, and two test cases for different scenarios of updating patient data.

## Symbols

### `checkPatientUpdateWith`
#### Description
A helper function to check if the patient update was called with the expected new links and link demographics history.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| newLinks | CwLink[] | Array of new CommonWell links |
| newLinksDemographicsHistory | LinkDemographicsHistory | Object containing new link demographics history |

#### Internal Logic
The function uses Jest's `expect` to check if the `cqPatientModel_update` mock function was called with the correct parameters, including the new links and link demographics history.

### `describe("update cq data")`
#### Description
A test suite containing two test cases for updating CommonWell patient data.

#### Internal Logic
1. "update patient with no link demographics":
   - Arranges: Creates a mock patient data with no existing links
   - Acts: Calls `createOrUpdateCwPatientData` with new links and demographics
   - Asserts: Checks if the update was called with the new data

2. "update patient with existing initial link demographics":
   - Arranges: Creates a mock patient data with existing links and demographics
   - Acts: Calls `createOrUpdateCwPatientData` with new links and demographics
   - Asserts: Checks if the update was called with a combination of existing and new data

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/core/domain/patient-demographics | Importing types for patient demographics |
| ../models/cw-patient-data | Importing the CommonWell patient data model |
| ../command/cw-patient-data/create-cw-data | Importing the function being tested |

## Error Handling
The tests do not explicitly handle errors. They rely on Jest's built-in error handling for failed assertions.

## Performance Considerations
These are unit tests, so performance is not a primary concern. However, the use of mocks for database operations ensures that the tests run quickly without actual database interactions.