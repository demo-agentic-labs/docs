---
title: "Overview"
---

## High-level description
This directory contains code for integrating with the CommonWell Health Alliance system within the Metriport API. It includes functionality for managing patient data, handling document queries, performing patient discovery, and interacting with the CommonWell API. The code also provides utilities for data conversion, error handling, and configuration management specific to CommonWell integration.

## What does it do?
The code in this directory performs several key functions:

1. Patient Management: It provides functionality to create, update, retrieve, and delete patient records in CommonWell, as well as manage patient links and demographics.

2. Document Querying: It implements document querying capabilities, allowing retrieval of medical documents from CommonWell-connected systems.

3. Patient Discovery: It handles patient discovery processes, including scheduling and running discovery operations across different healthcare organizations.

4. API Integration: It provides an interface for interacting with the CommonWell API, including authentication and request handling.

5. Data Conversion: It includes utilities for converting between Metriport's internal data formats and CommonWell's required formats.

6. Error Handling: It implements error categorization and handling specific to CommonWell operations.

7. Configuration Management: It manages CommonWell-specific configurations and settings.

8. Proxy Implementation: It includes a FHIR proxy for handling CommonWell document queries.

9. Sandbox Environment: It provides mock implementations for testing and development purposes.

## Entry points
The main entry points for this module are:

1. `api.ts`: Provides functions to create instances of the CommonWell API client and management API client.

2. `patient.ts`: Contains the primary functions for patient-related operations in CommonWell.

3. `events.ts`: Initializes CommonWell events, specifically for the CQ Bridge patient event listener.

4. `cw-fhir-proxy.ts` in the `proxy` subdirectory: Sets up the router for handling CommonWell Document Query requests.

## Key Files

1. `api.ts`: Defines functions for creating CommonWell API clients and handling certificates.

2. `patient.ts`: Implements core functionality for patient management in CommonWell.

3. `document/document-query.ts`: Handles document querying and processing.

4. `patient-conversion.ts`: Provides utilities for converting patient data between Metriport and CommonWell formats.

5. `error-categories.ts`: Defines error categories and handling for CommonWell operations.

6. `organization.ts`: Manages organization-related operations in CommonWell.

7. `sandbox-payloads.ts`: Provides mock data and functions for testing and development.

8. `proxy/cw-fhir-proxy.ts`: Implements a FHIR proxy for CommonWell document queries.

## Dependencies
The code relies on several external libraries and internal modules:

1. @metriport/commonwell-sdk: Provides the CommonWell API client and related types.
2. @metriport/core: Offers core domain models and utilities.
3. @metriport/shared: Provides shared utilities across the Metriport system.
4. express and express-promise-router: Used for routing in the FHIR proxy.
5. sequelize: Used for database operations.
6. dayjs: Utilized for date and time manipulation.
7. zod: Employed for schema validation.

## Configuration
The code uses various configuration settings, primarily related to CommonWell access and API interactions. These configurations are typically retrieved from environment variables or other configuration sources. Key configuration points include:

1. CommonWell API credentials and endpoints
2. Facility and organization IDs
3. Patient discovery and document query settings
4. FHIR server URL for the proxy

The configuration is managed through a `Config` class, which provides access to these settings throughout the module.

In conclusion, this directory contains critical functionality for integrating the Metriport API with the CommonWell Health Alliance system. It provides a comprehensive set of tools for managing patient data, document queries, and system interactions, while also offering flexibility for testing and development through sandbox implementations.

Have fun!