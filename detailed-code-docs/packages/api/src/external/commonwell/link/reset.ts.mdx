---
title: "reset.ts"
---

## High-level description
This code implements functionality for resetting a patient's link in the CommonWell Health Alliance system. It handles the process of removing the existing link between a patient and a person in CommonWell, updating the patient's data in the local system, and managing related configurations and feature flags.

## Code Structure
The main function `reset` orchestrates the process of resetting a patient's CommonWell link. It relies on several helper functions and external modules to perform various tasks such as checking feature flags, retrieving patient data, interacting with the CommonWell API, and updating patient records.

## References
- `@metriport/commonwell-sdk`: Used for CommonWell API interactions
- `@metriport/core`: Utilized for various utility functions and domain-specific operations
- Other local modules: Used for patient data retrieval, CommonWell API initialization, and patient data updates

## Symbols

### `reset`
#### Description
Resets a patient's link in the CommonWell system by removing the existing person link and updating the patient's data.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patientId | string | The ID of the patient |
| cxId | string | The customer ID |
| facilityId | string | The ID of the facility |

#### Internal Logic
1. Checks if CommonWell is enabled for the customer
2. Retrieves the patient data
3. Gets the CommonWell initiator information
4. Validates the patient's external data
5. Initializes the CommonWell API
6. Resets the patient link in CommonWell
7. Updates the patient's CommonWell IDs and status in the local system

#### Error Handling
Catches and logs errors during the reset process, including CommonWell API errors. Throws a `CommonwellError` with additional context information.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/commonwell-sdk | Provides CommonWell API functionality |
| @metriport/core | Offers utility functions and domain-specific operations |

## Configuration
The code relies on feature flags and configurations, particularly for determining if CommonWell is enabled for a specific customer.

## Error Handling
The code implements error handling by catching exceptions, logging error messages, and throwing a `CommonwellError` with additional context information.

## Logging
The code uses a logging utility (`out`) to log information and errors during the reset process.

## TODOs
None present in the code.