---
title: "shared.ts"
---

## High-level description
This code defines functions and types related to accessing and managing patient data in CommonWell, a health information exchange platform. It provides functionality to create, update, and retrieve CommonWell access for patients, as well as handle patient discovery and document querying processes.

## Code Structure
The main function `getCWAccessForPatient` retrieves CommonWell access information for a given patient. It uses helper functions like `getCWData`, `getCwInitiator`, and `makeCommonWellAPI` to set up the necessary data and API client. The `CWAccess` type defines the structure of the access information returned.

## Symbols

### `CWAccess`
#### Description
A type that represents the CommonWell access information for a patient. It can either contain the access details or an error message.

#### Inputs
N/A (Type definition)

#### Outputs
N/A (Type definition)

### `getCWAccessForPatient`
#### Description
Retrieves CommonWell access information for a given patient.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| patient | Patient | The patient object for which to retrieve CommonWell access |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| CWAccess | Promise&lt;CWAccess&gt; | A promise that resolves to the CommonWell access information |

#### Internal Logic
1. Retrieves the facility ID from the patient object
2. Checks for CommonWell data in the patient's external data
3. Gets the CommonWell initiator information
4. Creates a CommonWell API client
5. Constructs and returns the CWAccess object

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/commonwell-sdk | Provides CommonWell API client and related types |
| @metriport/core/domain/oid | Provides OID-related utility functions |
| @metriport/core/domain/patient | Provides Patient type definition |

## Error Handling
The function returns an error object as part of the `CWAccess` type if there are issues with retrieving the facility ID or CommonWell data.

## Logging
The code uses `console.log` for logging error messages when the facility ID or CommonWell data is missing.

This code serves as a crucial part of the CommonWell integration, providing a standardized way to access CommonWell services for a given patient. It handles the necessary setup and data retrieval to interact with the CommonWell API securely and efficiently.