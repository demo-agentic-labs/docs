---
title: "Overview"
---

## High-level description
This directory contains code for managing patient data and interactions with the CommonWell Health Alliance, a health information exchange platform. The code provides functionality for creating, updating, retrieving, and managing patient records in CommonWell, as well as handling patient discovery, linking patients to persons, and managing patient data across different healthcare organizations.

## What does it do?
The code in this directory performs several key functions related to patient data management and integration with CommonWell:

1. Patient Duplicate Management: It provides functionality to find and manage duplicate patient records within CommonWell.

2. Patient Record Creation and Updates: The code allows for creating new patient records in CommonWell and updating existing ones.

3. Patient Discovery: It implements patient discovery processes to find matching patient records across different healthcare organizations.

4. Data Consolidation: The code offers functionality to consolidate patient data from various sources, including CommonWell and Carequality.

5. Enhanced Coverage: It includes processes to enhance patient coverage by linking records across different health information exchanges.

6. API Endpoints: The code defines several internal API endpoints for managing patient data, handling duplicates, and interacting with external health information systems.

7. CommonWell Access Management: It provides functions to retrieve and manage CommonWell access information for patients.

## Entry points
The main entry points for this directory are:

1. `find-patient-duplicates.ts`: This file defines an Express router that handles various patient-related API endpoints, including finding duplicates, managing links, and enhancing coverage.

2. `patch-patient-duplicates.ts`: This file contains functions for patching duplicated persons in CommonWell for a given patient, including linking patients to chosen persons and unenrolling other persons if necessary.

3. `recreate-patients-at-hies.ts`: This file provides functions for creating, updating, and managing patient records in CommonWell, including patient discovery and linking patients to persons.

4. `shared.ts`: This file contains shared utilities and types used across the other files, particularly for managing CommonWell access for patients.

The data flow typically starts with an API request to one of the endpoints defined in `find-patient-duplicates.ts`. These endpoints then use functions from the other files to perform specific operations, such as patching duplicates or recreating patient records at HIEs.

## Key Files

### find-patient-duplicates.ts
This file defines the main router for handling internal patient-related API endpoints. It includes functionality for managing patient data, links, duplicates, enhanced coverage, and consolidated data across different health information exchanges.

### patch-patient-duplicates.ts
This file contains the `patchDuplicatedPersonsForPatient` function, which is responsible for patching duplicated persons in CommonWell for a given patient. It handles the process of linking patients to chosen persons and unenrolling other persons if necessary.

### recreate-patients-at-hies.ts
This file provides functions for creating (`create`), updating (`update`), retrieving (`get`), and removing (`remove`) patient records in CommonWell. These functions handle the complexities of interacting with the CommonWell API and managing patient data across different healthcare organizations.

### shared.ts
This file contains shared utilities, particularly the `getCWAccessForPatient` function, which retrieves CommonWell access information for a given patient. It also defines the `CWAccess` type, which represents the structure of CommonWell access information.

## Dependencies
The code in this directory relies on several external libraries and internal modules:

1. @metriport/commonwell-sdk: Used for interacting with the CommonWell API.
2. @metriport/core: Provides core domain models and utilities.
3. @metriport/shared: Offers shared utilities and schemas.
4. express-promise-router: Used for creating Express routers.
5. zod: Employed for schema validation.

These dependencies are crucial for the functionality of the code, providing necessary tools for API interactions, data validation, and routing.

## Configuration
The code uses various configuration settings, primarily related to CommonWell access and API interactions. These configurations are typically retrieved from environment variables or other configuration sources. Key configuration points include:

1. CommonWell API credentials and endpoints
2. Facility and organization IDs
3. Patient discovery and document query settings

The `getCWAccessForPatient` function in `shared.ts` is responsible for retrieving and setting up the necessary CommonWell access information for each patient interaction.

In conclusion, this directory contains critical functionality for managing patient data and interactions with CommonWell, providing a comprehensive set of tools for healthcare data integration and management. The code handles complex processes such as patient discovery, data consolidation, and duplicate management, while also offering a set of internal API endpoints for these operations.