---
title: "connector-direct.ts"
---

## High-level description
This code defines a `FhirToCdaConverterDirect` class that implements the `FhirToCdaConverter` interface. It provides functionality to convert FHIR (Fast Healthcare Interoperability Resources) bundles to CDA (Clinical Document Architecture) format, with options for splitting compositions and handling organization data.

## Code Structure
The `FhirToCdaConverterDirect` class implements the `FhirToCdaConverter` interface, providing a `requestConvert` method that processes the conversion request.

## References
- `@metriport/core/fhir-to-cda/composition-splitter`: `splitBundleByCompositions` function
- `@metriport/core/fhir-to-cda/fhir-to-cda`: `convertFhirBundleToCda` function
- `../../command/medical/organization/get-organization`: `getOrganizationOrFail` function
- `./connector`: `FhirToCdaConverter` interface and `FhirToCdaConverterRequest` type

## Symbols

### FhirToCdaConverterDirect
#### Description
A class that implements the `FhirToCdaConverter` interface, providing direct conversion of FHIR bundles to CDA format.

#### Inputs
None (for the class itself)

#### Outputs
None (for the class itself)

### requestConvert
#### Description
An asynchronous method that processes the conversion request, optionally splitting compositions and converting FHIR bundles to CDA format.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cxId | string | Customer ID |
| bundle | object | FHIR bundle to be converted |
| splitCompositions | boolean | Flag to determine if compositions should be split |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | string[] | Array of converted CDA documents |

#### Internal Logic
1. Retrieve the organization data using `getOrganizationOrFail`
2. If `splitCompositions` is true, split the bundle using `splitBundleByCompositions`
3. Convert the FHIR bundle(s) to CDA format using `convertFhirBundleToCda`
4. Return the array of converted CDA documents

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/core/fhir-to-cda/composition-splitter | Provides the `splitBundleByCompositions` function |
| @metriport/core/fhir-to-cda/fhir-to-cda | Provides the `convertFhirBundleToCda` function |

## Error Handling
The code does not implement explicit error handling. Errors from the called functions (e.g., `getOrganizationOrFail`, `splitBundleByCompositions`, `convertFhirBundleToCda`) will propagate up the call stack.