---
title: "Overview"
---

## High-level description
This directory contains end-to-end (E2E) tests for the Metriport Medical API (MAPI). It includes test suites for various components of the API, such as patient management, facility management, organization management, consolidated medical records, document queries, and API settings. The tests are designed to verify the functionality, data integrity, and integration of different aspects of the medical API.

## What does it do?
The E2E tests in this directory perform comprehensive testing of the Metriport Medical API, ensuring that:

1. Patient data can be created, retrieved, updated, and deleted correctly.
2. Facility information can be managed and validated.
3. Organization data can be retrieved and updated.
4. Consolidated medical records can be generated, validated, and converted to different formats (JSON, HTML, PDF).
5. Document queries can be triggered and processed successfully.
6. API settings, particularly webhook configurations, can be managed and tested.
7. Webhook functionality is properly implemented and can handle various types of requests.

These tests interact with both the Metriport Medical API and a FHIR server to ensure data consistency and proper integration between systems. They also set up a local webhook server for testing webhook interactions.

## Entry points
The main entry point for the E2E tests is the `mapi.test.e2e.ts` file, which orchestrates the execution of various test suites. It imports and runs the following test functions:

1. `runSettingsTests`
2. `runOrganizationTests`
3. `runFacilityTestsPart1` and `runFacilityTestsPart2`
4. `runPatientTestsPart1` and `runPatientTestsPart2`
5. `runConsolidatedTests`
6. `runDocumentQueryTests`

These functions are defined in separate files within the `parts` subdirectory and encapsulate the test suites for their respective components.

## Key Files
1. `mapi.test.e2e.ts`: The main orchestrator for running all E2E tests.
2. `init.ts`: Contains functions for initializing and tearing down the E2E test environment, particularly the webhook server.
3. `shared.ts`: Defines shared types, constants, and API client instances used across the E2E tests.
4. `parts/patient.test.part.ts`: Tests for patient-related operations.
5. `parts/facility.test.part.ts`: Tests for facility management.
6. `parts/organization.test.part.ts`: Tests for organization-related operations.
7. `parts/consolidated.test.part.ts`: Tests for consolidated medical records.
8. `parts/document-query.test.part.ts`: Tests for document query functionality.
9. `parts/settings.test.part.ts`: Tests for API settings, particularly webhook configurations.
10. `webhook/webhook-handler.ts`: Implements the main logic for processing incoming webhook requests.
11. `webhook/webhook-server.ts`: Sets up a local webhook server for testing purposes.

## Dependencies
The E2E tests rely on several external libraries and frameworks:

1. Jest: The testing framework used for writing and running the tests.
2. @faker-js/faker: Used for generating realistic test data.
3. @medplum/core and @medplum/fhirtypes: Provide FHIR-related functionality and types.
4. @metriport/api-sdk: The SDK for interacting with the Metriport Medical API.
5. @metriport/core and @metriport/shared: Provide core functionality and shared utilities.
6. dayjs: Used for date and time manipulation.
7. axios: Used for making HTTP requests in some tests.
8. Express.js: Used for creating the local webhook server.
9. ngrok: Exposes the local webhook server to the internet for testing purposes.
10. uuid: Used for UUID validation in webhook request metadata.

## Configuration
The E2E tests use various configuration settings and environment variables, including:

1. API endpoints and authentication tokens for the Metriport Medical API and FHIR server.
2. Test data for patients, facilities, and organizations.
3. Webhook URLs and configurations for testing webhook functionality.
4. File paths for template files used in consolidated record tests.
5. Environment variables for ngrok configuration (NGROK_AUTH_TOKEN, NGROK_DOMAIN).
6. PORT variable for specifying the local webhook server port.

These configurations are managed through a combination of environment variables, configuration files, and test context objects passed to the test functions.

In summary, this directory contains a comprehensive suite of E2E tests that verify the functionality, data integrity, and integration of various components of the Metriport Medical API. It includes tests for core API operations, webhook handling, and integration with FHIR standards, ensuring that the API meets the required standards and specifications for healthcare data management.