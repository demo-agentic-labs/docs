---
title: "Overview"
---

## High-level description
This directory contains a set of files that implement a webhook handling system for a medical API. The system is designed to receive, process, and respond to various types of webhook requests, including consolidated data, document conversion, document download, and bulk download URLs. It also includes functionality for testing and debugging webhook interactions.

## What does it do?
The webhook handling system performs the following main functions:

1. Receives incoming webhook requests from external sources.
2. Verifies the authenticity of the requests using signature validation.
3. Parses and routes the requests to appropriate handlers based on their type.
4. Processes different types of webhook requests, such as consolidated data, document conversion, and document downloads.
5. Provides a local server for testing webhook functionality, which can be exposed to the internet using ngrok.
6. Offers utility functions for managing webhook keys, retrieving processed requests, and resetting data for testing purposes.

## Entry points
The main entry point for the webhook handling system is the `handleRequest` function in the `webhook-handler.ts` file. This function is responsible for processing incoming webhook requests, verifying their signatures, and routing them to the appropriate handlers.

The `webhook-server.ts` file serves as the entry point for setting up a local webhook server for testing purposes. It initializes an Express.js server, exposes it to the internet using ngrok, and provides functions for managing the server lifecycle.

## Key Files
1. `webhook-handler.ts`: Contains the main logic for processing incoming webhook requests, including signature verification and routing to specific handlers.

2. `webhook-server.ts`: Sets up a local webhook server for testing purposes, using Express.js and ngrok to expose the server to the internet.

3. `consolidated.ts`: Implements handling for consolidated webhook requests, providing functions to store, retrieve, and reset consolidated data.

4. `settings.ts`: Handles "ping" webhook requests and provides functions for managing ping data for testing purposes.

5. `shared.ts`: Contains a utility function for checking the metadata of webhook requests, ensuring they conform to the expected structure.

## Dependencies
The webhook handling system relies on several external libraries and frameworks:

1. Express.js (version not specified): Used for creating the local webhook server and handling HTTP requests.
2. ngrok (version not specified): Exposes the local webhook server to the internet for testing purposes.
3. @metriport/api-sdk (version not specified): Provides the MetriportMedicalApi client for interacting with the Metriport API.
4. @metriport/shared (version not specified): Contains shared types and utility functions used across the system.
5. dayjs (version not specified): Used for date and time manipulation in webhook request validation.
6. uuid (version not specified): Used for UUID validation in webhook request metadata.

## Configuration
The webhook handling system uses environment variables for configuration, particularly in the `webhook-server.ts` file:

1. `NGROK_AUTH_TOKEN`: Authentication token for ngrok service.
2. `NGROK_DOMAIN`: Optional custom domain for ngrok tunneling.
3. `PORT`: The port number on which the local webhook server listens (defaults to 3000 if not specified).

These environment variables can be set in a `.env` file or through the system's environment.

The system also uses a webhook key for signature validation, which can be set and retrieved using the `storeWebhookKey` function in `webhook-handler.ts`.

In summary, this webhook handling system provides a comprehensive solution for receiving, validating, and processing various types of webhook requests in a medical API context, with additional features for testing and debugging webhook interactions.