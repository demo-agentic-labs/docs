---
title: "Overview"
---

## High-level description
This directory contains end-to-end (E2E) tests and test setup files for the Metriport Medical API (MAPI). It includes comprehensive test suites for various components of the API, such as patient management, facility management, organization management, consolidated medical records, document queries, and API settings. The tests are designed to verify the functionality, data integrity, and integration of different aspects of the medical API with both the Metriport Medical API and a FHIR server.

## What does it do?
The code in this directory performs the following functions:

1. Sets up the testing environment by loading environment variables and creating necessary directories.
2. Defines and runs end-to-end tests for various components of the Metriport Medical API, including:
   - Patient data management (creation, retrieval, updating, and deletion)
   - Facility information management and validation
   - Organization data retrieval and updating
   - Consolidated medical records generation, validation, and format conversion
   - Document query triggering and processing
   - API settings management, particularly webhook configurations
   - Webhook functionality testing
3. Interacts with both the Metriport Medical API and a FHIR server to ensure data consistency and proper integration.
4. Sets up a local webhook server for testing webhook interactions, simulating real-world scenarios.
5. Provides shared utilities and configurations for the tests.
6. Includes a placeholder for global teardown logic.

## Entry points
The main entry point for the E2E tests is the `mapi.test.e2e.ts` file, which orchestrates the execution of various test suites. It imports and runs test functions for different components of the API, such as settings, organization, facility, patient, consolidated records, and document queries.

## Key Files
1. `mapi.test.e2e.ts`: The main orchestrator for running all E2E tests.
2. `init.ts`: Contains functions for initializing and tearing down the E2E test environment.
3. `shared.ts`: Defines shared types, constants, and API client instances used across the E2E tests.
4. `env-setup.ts`: Sets up the environment for running tests, including loading environment variables and initializing test directories.
5. `tear-down.ts`: A placeholder for global teardown logic.
6. Various test files in the `parts` subdirectory for different API components (e.g., `patient.test.part.ts`, `facility.test.part.ts`, etc.).
7. Webhook-related files in the `webhook` subdirectory for handling and testing webhook functionality.

## Dependencies
The E2E tests rely on several external libraries and frameworks, including:

1. Jest: The testing framework used for writing and running the tests.
2. @faker-js/faker: Used for generating realistic test data.
3. @medplum/core and @medplum/fhirtypes: Provide FHIR-related functionality and types.
4. @metriport/api-sdk: The SDK for interacting with the Metriport Medical API.
5. @metriport/core and @metriport/shared: Provide core functionality and shared utilities.
6. dayjs: Used for date and time manipulation.
7. axios: Used for making HTTP requests in some tests.
8. Express.js: Used for creating the local webhook server.
9. ngrok: Exposes the local webhook server to the internet for testing purposes.
10. dotenv: Loads environment variables from `.env` files.
11. jest-extended: Provides custom Jest matchers for more expressive assertions.

## Configuration
The E2E tests use various configuration settings and environment variables, including:

1. API endpoints and authentication tokens for the Metriport Medical API and FHIR server.
2. Test data for patients, facilities, and organizations.
3. Webhook URLs and configurations for testing webhook functionality.
4. File paths for template files used in consolidated record tests.
5. Environment variables for ngrok configuration (NGROK_AUTH_TOKEN, NGROK_DOMAIN).
6. PORT variable for specifying the local webhook server port.
7. TEST_API_KEY: The API key used for authentication in test requests.
8. API_URL: The base URL for the API being tested.

These configurations are managed through a combination of environment variables, configuration files, and test context objects passed to the test functions. The `env-setup.ts` file is responsible for loading environment variables from `.env` and `.env.test` files, as well as setting up the test results folder and extending Jest's `expect` function with custom matchers.

In summary, this directory contains a comprehensive suite of E2E tests that verify the functionality, data integrity, and integration of various components of the Metriport Medical API. It includes tests for core API operations, webhook handling, and integration with FHIR standards, ensuring that the API meets the required standards and specifications for healthcare data management. The tests are designed to be thorough and cover a wide range of scenarios, providing confidence in the API's reliability and correctness.