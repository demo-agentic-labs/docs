---
title: "external.ts"
---

## High-level description
This code defines a function `mapDocRefToMetriport` that maps a document reference from an external source to a Metriport ID. It uses the `getOrCreateDocRefMapping` function to either retrieve an existing mapping or create a new one if it doesn't exist.

## Symbols

### `mapDocRefToMetriport`
#### Description
This function takes information about a document reference from an external source and maps it to a Metriport ID. It uses the `getOrCreateDocRefMapping` function to handle the mapping process.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cxId | string | Customer ID |
| patientId | string | Patient ID |
| requestId | string | Request ID |
| documentId | string | External document ID |
| source | MedicalDataSource | Source of the medical data |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| object | \{ originalId: string; metriportId: string \} | An object containing the original document ID and the mapped Metriport ID |

#### Internal Logic
1. Creates a `docRef` object with the input parameters.
2. Calls `getOrCreateDocRefMapping` with the `docRef` object to get or create a mapping.
3. Returns an object with the original document ID and the Metriport ID from the mapping.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @metriport/core/external/index | Imports the `MedicalDataSource` type |
| ../command/medical/docref-mapping/get-docref-mapping | Imports the `getOrCreateDocRefMapping` function |

## References
This code is referenced by and used in other parts of the system, particularly in document querying and processing functions. For example, it's used in the `addMetriportDocRefId` function in the `document-query.ts` file to add Metriport document reference IDs to documents retrieved from external sources.

The `mapDocRefToMetriport` function plays a crucial role in maintaining a mapping between external document references and Metriport's internal document IDs, which is essential for document management and retrieval across different medical data sources.
