---
title: "filter-map-utils.ts"
---

## High-level description
This file defines a utility function `filterTruthy` that is used to filter out falsy values (undefined or null) from arrays. It's designed to be used with JavaScript's `flatMap()` method to create a new array with only truthy values.

## Symbols

### `filterTruthy&lt;T&gt;`
#### Description
This is a generic function that takes an input of type `T | undefined | null` and returns either the input value if it's truthy, or an empty array if it's falsy.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| o | T \| undefined \| null | The input value to be filtered |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | T \| [] | The input value if truthy, or an empty array if falsy |

#### Internal Logic
The function uses a simple ternary operator to check if the input `o` is truthy. If it is, it returns the input value. If it's falsy (undefined or null), it returns an empty array.

## Usage Example
The file includes a comment with an example of how to use the `filterTruthy` function:

```javascript
const arr = [1, null, 3, undefined, 5];
const filtered = arr.flatMap(filterTruthy);
// filtered = [1, 3, 5]
```

This example demonstrates how `filterTruthy` can be used with `flatMap()` to remove null and undefined values from an array.

## References
The `filterTruthy` function is used in several other files in the project:

1. In `packages/api/src/routes/medical/schemas/fhir.ts`, it's used to filter a list of resources.
2. In `packages/api/src/external/commonwell/link/get.ts`, it's used multiple times to filter various arrays of CommonWell data.
3. In `packages/api/src/external/commonwell/link/shared.ts`, it's used to filter person links and network links.
4. In `packages/api/src/external/commonwell/admin/find-patient-duplicates.ts`, it's used to filter person IDs and persons.

These usages demonstrate that `filterTruthy` is a widely used utility function across the project, particularly in dealing with CommonWell API responses and data processing.

## Dependencies
This file has no external dependencies. It's a self-contained utility function.

The `filterTruthy` function is a simple yet powerful utility that helps in cleaning up arrays by removing falsy values, which is a common operation in JavaScript/TypeScript programming, especially when dealing with API responses or data processing.