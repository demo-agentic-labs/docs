---
title: "util.ts"
---

## High-level description
This file contains utility functions and constants used throughout the Metriport API. It includes functions for date manipulation, data conversion, error handling, logging, and other common operations. The `Util` class serves as a central repository for these utility methods.

## Code Structure
The main symbol in this code is the `Util` class, which contains static methods for various utility operations. Other symbols include interfaces and standalone functions that are used in conjunction with the `Util` class methods.

## Symbols

### `Util`
#### Description
A static class that provides utility methods for various operations used throughout the Metriport API.

#### Internal Logic
- Contains methods for date manipulation, data conversion, logging, and other common operations.
- Utilizes external libraries like `dayjs` and `convert-units` for specific functionalities.

### `MinMaxItem`
#### Description
An interface that represents the minimum and maximum values of a set of numbers.

#### Properties
| Name | Type | Description |
|:-----|:-----|:------------|
| min_item | number | The minimum value |
| max_item | number | The maximum value |

### `isTokenExpired`
#### Description
Checks if a token has expired based on its expiration time.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| expires_at | number | The expiration timestamp of the token |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | boolean | True if the token has expired, false otherwise |

### `md5`
#### Description
Generates an MD5 hash of the input string.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| value | string | The input string to hash |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | string | The MD5 hash of the input string |

### `curSecSinceEpoch`
#### Description
Returns the current number of seconds since the Unix epoch.

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | number | The current number of seconds since the Unix epoch |

### `getMinMaxItem`
#### Description
Finds the minimum and maximum values in an array of numbers.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| arr | number[] | An array of numbers |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | MinMaxItem | An object containing the minimum and maximum values |

### `getAvgOfArr`
#### Description
Calculates the average of an array of numbers.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| arr | number[] | An array of numbers |
| fixed | number | (Optional) The number of decimal places to round to |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | number | The average of the input array |

### `getAvgOfSamplesArr`
#### Description
Calculates the average value from an array of Sample objects.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| arr | Sample[] | An array of Sample objects |
| fixed | number | (Optional) The number of decimal places to round to |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | number | The average value from the Sample objects |

### `getMinMaxSamplesItem`
#### Description
Finds the minimum and maximum values from an array of Sample objects.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| arr | Sample[] | An array of Sample objects |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | MinMaxItem | An object containing the minimum and maximum values |

### `addDataToObject`
#### Description
Creates an object with a single key-value pair if the value is truthy.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| key | string | The key for the object |
| value | unknown | The value to be added |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | object | An object with the key-value pair, or undefined if the value is falsy |

### `sleep`
#### Description
Creates a Promise that resolves after a specified time.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| timeInMs | number | The time to sleep in milliseconds |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | Promise&lt;void&gt; | A Promise that resolves after the specified time |

### `sleepRandom`
#### Description
Sleeps for a random duration within a specified range.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| max | number | The maximum sleep time in milliseconds |
| multiplierMin | number | (Optional) The minimum multiplier for the random duration |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | Promise&lt;void&gt; | A Promise that resolves after the random sleep duration |

### `kilojoulesToKilocalories`
#### Description
Converts kilojoules to kilocalories.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| kilojoules | number | The value in kilojoules |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | number | The equivalent value in kilocalories |

### `optional`
#### Description
Converts a value to undefined if it's null, or returns it if present.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| v | T | The input value of any type |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | NonNullable&lt;T&gt; \| undefined | The input value or undefined |

### `oneOf`
#### Description
Returns the first non-null and non-undefined item in the array, or undefined.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| ...values | T[] | An array of values |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | NonNullable&lt;T&gt; \| undefined | The first non-null and non-undefined value, or undefined |

### `streamToString`
#### Description
Converts a stream to a string and returns its contents and size.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| stream | Stream | The input stream |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| - | Promise&lt;\{ contents: string; size: number \}&gt; | A Promise resolving to an object containing the stream contents and size |

## Dependencies
- dayjs
- convert-units
- crypto
- lodash
- stream

## Error Handling
The code includes basic error handling, such as checking for null or undefined values in some functions. However, most error handling is left to the calling code.

## Performance Considerations
- The `md5` function uses the built-in `crypto` module, which is generally efficient for hashing operations.
- The `getAvgOfArr` and `getAvgOfSamplesArr` functions use `lodash`'s `mean` function, which is optimized for performance.
- The `streamToString` function uses a buffer to efficiently convert streams to strings.

## Logging
The code includes a `log` and `debug` function for logging purposes, which can be used throughout the application for consistent logging.
