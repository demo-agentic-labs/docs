---
title: "2023-12-12_00_create-patient-discovery.ts"
---

## High-level description
This code defines a database migration script using Sequelize.js. It creates a new table named "patient_discovery_result" to store data related to patient discovery requests, including request ID, patient ID, status, data, and creation timestamp.

## Symbols

### `tableName`
#### Description
A constant variable that stores the name of the table to be created in the database.

#### Inputs
N/A

#### Outputs
N/A

#### Internal Logic
The variable is assigned the string literal "patient_discovery_result", representing the desired table name.

### `up`
#### Description
An asynchronous function representing the "up" migration, responsible for creating the "patient_discovery_result" table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| context | Object | An object containing the Sequelize queryInterface object. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise&lt;void&gt; | Promise | A promise that resolves when the table creation is complete. |

#### Internal Logic
1. Starts a database transaction using `queryInterface.sequelize.transaction`.
2. Uses `queryInterface.createTable` to create the "patient_discovery_result" table with the defined columns:
    - `id`: A string representing the primary key.
    - `requestId`: A UUID representing the associated request ID.
    - `patientId`: A UUID representing the associated patient ID.
    - `status`: A string representing the status of the discovery result.
    - `data`: A JSONB object to store additional data.
    - `createdAt`: A timestamp representing the creation time, defaulting to the current timestamp.
3. The table creation is executed within the transaction to ensure atomicity.

### `down`
#### Description
An asynchronous function representing the "down" migration, responsible for reverting the changes made by the "up" migration, which in this case means dropping the "patient_discovery_result" table.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| context | Object | An object containing the Sequelize queryInterface object. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise&lt;void&gt; | Promise | A promise that resolves when the table deletion is complete. |

#### Internal Logic
1. Starts a database transaction using `queryInterface.sequelize.transaction`.
2. Uses `queryInterface.dropTable` to delete the "patient_discovery_result" table.
3. The table deletion is executed within the transaction to ensure atomicity.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| sequelize | Provides the ORM and migration functionalities. |
| DataTypes | Used for defining data types for the table columns. |
| literal | Used for creating SQL literals within the migration script. |

