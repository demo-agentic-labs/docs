---
title: "2024-05-31_00_alter-webhook-add-statusDetail.ts"
---

## High-level description
This code defines a database migration script that alters the existing "webhook_request" table. The migration adds new columns for storing detailed webhook request information, such as status details, request URL, HTTP status, and duration. It also modifies the existing "type" column to be non-nullable.

## Symbols

### `up`
#### Description
This function defines the steps to apply the migration to the database. It uses a transaction to ensure all changes are applied atomically.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| context | object | An object containing the queryInterface, which provides methods for interacting with the database schema. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise&lt;void&gt; | Promise | A promise that resolves when the migration is complete. |

#### Internal Logic
1. **Begin Transaction:** Starts a database transaction to ensure atomicity.
2. **Change 'type' Column:** Modifies the existing "type" column in the "webhook_request" table to have a data type of STRING and be non-nullable.
3. **Add 'status_detail' Column:** Adds a new "status_detail" column to the table with a data type of STRING and allows null values.
4. **Add 'request_url' Column:** Adds a new "request_url" column to the table with a data type of STRING and allows null values.
5. **Add 'http_status' Column:** Adds a new "http_status" column to the table with a data type of INTEGER and allows null values.
6. **Add 'duration_millis' Column:** Adds a new "duration_millis" column to the table with a data type of INTEGER and allows null values.
7. **Commit Transaction:** Commits the transaction, applying all changes to the database.

### `down`
#### Description
This function defines the steps to revert the migration, effectively undoing the changes made by the "up" function. It also uses a transaction for atomicity.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| context | object | An object containing the queryInterface, which provides methods for interacting with the database schema. |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| Promise&lt;void&gt; | Promise | A promise that resolves when the migration rollback is complete. |

#### Internal Logic
1. **Begin Transaction:** Starts a database transaction.
2. **Remove 'duration_millis' Column:** Removes the "duration_millis" column from the "webhook_request" table.
3. **Remove 'http_status' Column:** Removes the "http_status" column from the table.
4. **Remove 'request_url' Column:** Removes the "request_url" column from the table.
5. **Remove 'status_detail' Column:** Removes the "status_detail" column from the table.
6. **Revert 'type' Column:** Reverts the "type" column back to its previous state, allowing null values.
7. **Commit Transaction:** Commits the transaction, reverting the database changes.
