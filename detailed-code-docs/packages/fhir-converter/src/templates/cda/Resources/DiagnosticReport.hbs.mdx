---
title: "DiagnosticReport.hbs"
---

## High-level description
This Handlebars template file defines the structure for creating a FHIR DiagnosticReport resource. It transforms data from a CDA (Clinical Document Architecture) format into a FHIR-compliant JSON representation of a diagnostic report.

## Code Structure
The template uses Handlebars syntax to dynamically generate the JSON structure. It includes various helper functions and partials to populate different sections of the DiagnosticReport resource.

## Symbols

### DiagnosticReport Template
#### Description
This is the main template for creating a FHIR DiagnosticReport resource. It defines the structure and populates it with data from the CDA input.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| diagReport | Object | The diagnostic report data from the CDA document |
| ID | String | A unique identifier for the resource |
| categoryCode | Object | The category code for the diagnostic report |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| JSON | Object | A FHIR-compliant DiagnosticReport resource |

#### Internal Logic
1. Creates a unique fullUrl for the resource using the provided ID.
2. Sets the resourceType to "DiagnosticReport".
3. Populates the identifier array using the `DataType/Identifier.hbs` partial.
4. Sets the status using the `ValueSet/DiagnosticReportStatus.hbs` partial.
5. Sets the code using the `DataType/CodeableConcept.hbs` partial.
6. Sets the category using the `DataType/CodeableConcept.hbs` partial.
7. Sets the effectivePeriod using the `DataType/Period.hbs` partial.
8. Conditionally adds presentedForm using the `buildPresentedForm` helper function.
9. Defines the request method and URL for the resource.

### Helper Functions
#### buildPresentedForm
This helper function is used to construct the presentedForm array for the DiagnosticReport. It takes two parameters: `diagReport.text._b64` and `diagReport.component`.

### Partials
The template uses several partials to populate specific sections:
- `DataType/Identifier.hbs`
- `ValueSet/DiagnosticReportStatus.hbs`
- `DataType/CodeableConcept.hbs`
- `DataType/Period.hbs`

These partials are likely defined in separate files and are used to maintain consistency and reusability across different templates.

## Dependencies
The template relies on Handlebars.js for templating functionality.

## Configuration
The template uses several configuration options through Handlebars helpers and partials. These are likely defined elsewhere in the project.

## Error Handling
There is no explicit error handling in this template. Error handling is likely managed by the Handlebars engine and the surrounding application code.

## Notes
1. The template includes a copyright notice at the beginning, indicating it's based on work by Microsoft but modified by Metriport Inc.
2. The template uses conditional statements and loops to handle optional and repeating elements in the FHIR structure.
3. The `canBeUnknown=true` parameter in the code section suggests that the code can be set to an "unknown" value if not provided.
4. The related code snippet for the Period model is not directly used in this template but may be relevant for understanding the structure of the `effectivePeriod` field.