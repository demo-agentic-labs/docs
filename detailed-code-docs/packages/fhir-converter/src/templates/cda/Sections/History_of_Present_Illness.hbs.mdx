---
title: "History_of_Present_Illness.hbs"
---

## High-level description
This Handlebars template is designed to convert Clinical Document Architecture (CDA) data related to the History of Present Illness section into FHIR (Fast Healthcare Interoperability Resources) format. It specifically targets the CDA template with the identifier '1.3.6.1.4.1.19376.1.5.3.1.3.4' and generates corresponding FHIR DiagnosticReport resources along with associated references.

## Code Structure
The template is structured as a series of nested conditional blocks and loops that process the CDA data. It generates FHIR resources for DiagnosticReport, Patient, Encounter, Practitioner, and Organization, creating appropriate references between them.

## Symbols

### Main Conditional Block
#### Description
The main conditional block checks if the CDA message contains the specific template ID for the History of Present Illness section.

#### Internal Logic
1. Checks for the presence of the template ID '1.3.6.1.4.1.19376.1.5.3.1.3.4' in the message.
2. If present, it processes the section data to create FHIR resources.

### DiagnosticReport Generation
#### Description
Generates a DiagnosticReport resource for each entry in the CDA section.

#### Internal Logic
1. Iterates over each entry in the CDA section.
2. Calls the DiagnosticReport partial template to create the resource.
3. Generates a unique ID for the DiagnosticReport.

### Patient Reference
#### Description
Creates a reference to the Patient resource for the DiagnosticReport.

#### Internal Logic
1. Calls a utility template to generate a patient ID.
2. Creates a reference to the Patient resource using the generated ID.

### Encounter Reference
#### Description
Conditionally creates a reference to an Encounter resource for the DiagnosticReport.

#### Internal Logic
1. Checks if an encompassing encounter ID exists.
2. If present, creates a reference to the Encounter resource.

### Practitioner and Organization References
#### Description
Generates Practitioner and Organization resources and their references for the DiagnosticReport.

#### Internal Logic
1. Checks if author information is present in the CDA data.
2. If a practitioner is present:
   - Generates a Practitioner resource.
   - Creates a reference to the Practitioner for the DiagnosticReport.
3. If an organization is present:
   - Generates an Organization resource.
   - Creates a reference to the Organization for the DiagnosticReport.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| Handlebars | Template engine used for generating the FHIR resources |

## TODOs
- The comment "TODO need to add references, author, etc" suggests that additional references or author information may need to be added in future updates.

This template is part of a larger system for converting CDA documents to FHIR resources, focusing specifically on the History of Present Illness section. It demonstrates the complexity of healthcare data transformation, handling various entities like patients, practitioners, organizations, and encounters while maintaining their relationships in the FHIR format.