---
title: "util.ts"
---

## High-level description
This code provides utility functions for environment variable management, certificate content extraction, and array operations. It is designed to support CommonWell certification runner operations by providing reusable helper functions.

## Symbols

### `getEnv`
#### Description
Retrieves the value of an environment variable.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | string | The name of the environment variable |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| value | string \| undefined | The value of the environment variable, or undefined if not set |

### `getEnvOrFail`
#### Description
Retrieves the value of an environment variable, throwing an error if it's not set or empty.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| name | string | The name of the environment variable |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| value | string | The value of the environment variable |

#### Internal Logic
1. Calls `getEnv` to retrieve the value
2. Checks if the value is falsy or empty (after trimming)
3. Throws an error if the value is not valid

### `getCertificateContent`
#### Description
Extracts the content of a certificate from a string containing the full certificate (including BEGIN and END tags).

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| cert | string | The full certificate string |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| content | string \| undefined | The extracted certificate content, or undefined if not found |

#### Internal Logic
1. Uses a regular expression to match the content between BEGIN and END tags
2. Removes any line breaks from the extracted content

### `filterTruthy`
#### Description
Filters out falsy values from an input, returning either the input value or an empty array.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| o | T \| undefined \| null | The input value |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| result | T \| [] | The input value if truthy, or an empty array |

### `firstElementOrFail`
#### Description
Returns the first element of an array, throwing an error if the array is empty or undefined.

#### Inputs
| Name | Type | Description |
|:-----|:-----|:------------|
| arr | T[] \| undefined | The input array |
| fieldName | string \| undefined | Optional name of the field for error message |

#### Outputs
| Name | Type | Description |
|:-----|:-----|:------------|
| element | T | The first element of the array |

#### Internal Logic
1. Checks if the array exists and has at least one element
2. Returns the first element if it exists
3. Throws an error with a custom message if the array is empty or undefined

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| dotenv | For loading environment variables from a .env file |

Note: The `dotenv` package is used to load environment variables, which is crucial for the `getEnv` and `getEnvOrFail` functions.

This utility file provides essential functions for environment variable management, certificate handling, and array operations, which are likely used throughout the CommonWell certification runner application. The functions are designed to be reusable and to provide clear error messages when operations fail, enhancing the robustness of the application.