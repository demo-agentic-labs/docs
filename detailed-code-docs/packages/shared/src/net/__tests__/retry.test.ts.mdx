---
title: "retry.test.ts"
---

## High-level description
This file contains unit tests for the network retry functionality in the Metriport application. It tests the `executeWithNetworkRetries` function and related utility functions, focusing on various network error scenarios and retry behaviors.

## Code Structure
The test suite is organized into three main describe blocks:
1. "executeWithNetworkRetries": Tests the main retry function with various error scenarios.
2. "getHttpCodeFromError": Tests the utility function for extracting HTTP codes from errors.
3. "getHttpStatusFromError": Tests the utility function for extracting HTTP status codes from errors.

## Symbols

### `describe("net retry", () =&gt; {...})`
#### Description
This is the main test suite for the network retry functionality.

### `describe("executeWithNetworkRetries", () =&gt; {...})`
#### Description
Tests the `executeWithNetworkRetries` function with various scenarios.

#### Internal Logic
- Sets up a mock function (`fn`) for each test.
- Tests different error types (ECONNREFUSED, ECONNRESET, ETIMEDOUT, etc.) and their retry behavior.
- Checks retry behavior with different configurations (e.g., `retryOnTimeout`, custom `httpCodesToRetry`).
- Tests the special case of 429 Too Many Requests status code.

### `describe("getHttpCodeFromError", () =&gt; {...})`
#### Description
Tests the `getHttpCodeFromError` utility function.

#### Internal Logic
- Tests with non-Axios errors, Axios errors, and nested errors.
- Verifies correct extraction of HTTP codes from different error types.

### `describe("getHttpStatusFromError", () =&gt; {...})`
#### Description
Tests the `getHttpStatusFromError` utility function.

#### Internal Logic
- Tests with non-Axios errors, Axios errors, and nested errors.
- Verifies correct extraction of HTTP status codes from different error types.

## Dependencies
| Dependency | Purpose |
|:-----------|:--------|
| @faker-js/faker | Generating fake data for tests |
| axios | Creating and handling Axios errors |
| ../../common/retry | Importing retry-related functions |
| ../../error/metriport-error | Using MetriportError for error handling |
| ../retry | Importing the functions being tested |
| ./axios | Utility functions for creating Axios errors and responses |

## Error Handling
The tests focus on various error scenarios, including network errors (ECONNREFUSED, ECONNRESET), timeout errors, and HTTP status errors. They verify that the retry mechanism behaves correctly for each type of error.

## Performance Considerations
The tests use small delays (1ms) and a limited number of retry attempts (2) to keep test execution time low while still verifying the retry logic.

## TODOs
None present in the code.